{"version":3,"file":"static/chunks/381.20fb38dae05a8711.js","mappings":"sjBAEA,Y,2tBAOO,MATJ,a,6PASUA,I,mIACDC,QAAUC,SAASC,cAAc,OAEzC,EAAOC,SAAqB,IAAIC,EAAAA,SAAS,CACrCC,WAAY,MAGhB,EAAOC,YAAc,IAAIC,EAAAA,YAEzB,EAAiBC,SAAW,IAAIC,EAAAA,SA0C5B,EAAKT,QAAQU,MAAMC,MAAQ,OAC3B,EAAKX,QAAQU,MAAME,OAAS,OAC5B,EAAKZ,QAAQU,MAAMG,SAAW,SAE9B,EAAKV,SAASW,QAAQC,WAAa,gFACnC,EAAKZ,SAASW,QAAQE,cAAgB,EACtC,EAAKb,SAASW,QAAQG,YAAc,MACpC,EAAKd,SAASe,UAAU,EAAKZ,aAC7B,EAAKH,SAASe,UAAU,EAAKV,U,cA3DxBT,EAAW,U,OA8DpB,EAAOoB,aAAP,SAAoBC,GAChBA,EAAUC,YAAYC,KAAKtB,SACtBsB,KAAKnB,SAASH,UACVsB,KAAKtB,QAAQuB,YAClBD,KAAKnB,SAASqB,KAAKF,KAAKtB,SACxBsB,KAAKnB,SAASe,UAAU,IAAIO,EAAAA,YAE5BH,KAAKnB,SAASW,QAAQY,aAAc,EACpCJ,KAAKK,QAIb,EAAOA,IAAP,W,IAII,EAHAL,KAAKd,SAASmB,MAEd,IAAuB,EAAAL,KAAKnB,SAApByB,EAAe,EAAfA,KAAMC,EAAS,EAATA,KACF,QAAZ,EAAAP,KAAKQ,eAAO,IAAZ,KAAcC,OAAOH,EAAMC,I,SAjEpBG,IAAAA,S,IAAX,WAAsB,OAAOV,KAAKQ,S,IAClC,SAAkBG,G,IAIV,EAKJ,GARIX,KAAKQ,UAELR,KAAKY,UACsB,QAA3B,EAAAZ,KAAKa,8BAAsB,IAA3B,KAA6BC,SAGjCd,KAAKQ,QAAUG,EAEXA,EAAO,C,WACPX,KAAKnB,SAASkC,QACdf,KAAKnB,SAASmC,QAEdhB,KAAKa,uBAAyB,IAAII,EAAAA,GAGlCN,EAAMO,OAAOC,OAAO,IAAIC,EAAAA,GAA2B,CAC/CC,MAAO,SAACC,GACJ,EAAKzC,SAASwC,MAAMC,MAExB,CACAC,OAAQvB,KAAKa,uBAAuBU,SAGxC,IAAMC,EAAUb,EAAMc,MAAMC,YAC5B1B,KAAK2B,cAAc3B,KAAKnB,SAAS+C,QAAOC,SAAAA,GACpC,IAAMC,GAASC,EAAAA,EAAAA,IAAWF,GAC1BL,EAAQH,MAAMS,OAGlB9B,KAAKK,Y,6BArDd,CAS8B2B,EAAAA","sources":["webpack://_N_E/./src/components/terminal.tsx"],"sourcesContent":["// cspell: ignore scrollback\n\nimport { AbortController, AdbSubprocessProtocol, encodeUtf8, WritableStream } from \"@yume-chan/adb\";\nimport { AutoDisposable } from \"@yume-chan/event\";\nimport { Terminal } from 'xterm';\nimport { FitAddon } from 'xterm-addon-fit';\nimport { SearchAddon } from 'xterm-addon-search';\nimport { WebglAddon } from 'xterm-addon-webgl';\n\nexport class AdbTerminal extends AutoDisposable {\n    private element = document.createElement('div');\n\n    public terminal: Terminal = new Terminal({\n        scrollback: 9000,\n    });\n\n    public searchAddon = new SearchAddon();\n\n    private readonly fitAddon = new FitAddon();\n\n    private _socket: AdbSubprocessProtocol | undefined;\n    private _socketAbortController: AbortController | undefined;\n    public get socket() { return this._socket; }\n    public set socket(value) {\n        if (this._socket) {\n            // Remove event listeners\n            this.dispose();\n            this._socketAbortController?.abort();\n        }\n\n        this._socket = value;\n\n        if (value) {\n            this.terminal.clear();\n            this.terminal.reset();\n\n            this._socketAbortController = new AbortController();\n\n            // pty mode only has one stream\n            value.stdout.pipeTo(new WritableStream<Uint8Array>({\n                write: (chunk) => {\n                    this.terminal.write(chunk);\n                },\n            }), {\n                signal: this._socketAbortController.signal,\n            });\n\n            const _writer = value.stdin.getWriter();\n            this.addDisposable(this.terminal.onData(data => {\n                const buffer = encodeUtf8(data);\n                _writer.write(buffer);\n            }));\n\n            this.fit();\n        }\n    }\n\n    public constructor() {\n        super();\n\n        this.element.style.width = '100%';\n        this.element.style.height = '100%';\n        this.element.style.overflow = 'hidden';\n\n        this.terminal.options.fontFamily = '\"Cascadia Code\", Consolas, monospace, \"Source Han Sans SC\", \"Microsoft YaHei\"';\n        this.terminal.options.letterSpacing = 1;\n        this.terminal.options.cursorStyle = 'bar';\n        this.terminal.loadAddon(this.searchAddon);\n        this.terminal.loadAddon(this.fitAddon);\n    }\n\n    public setContainer(container: HTMLDivElement) {\n        container.appendChild(this.element);\n        if (!this.terminal.element) {\n            void this.element.offsetWidth;\n            this.terminal.open(this.element);\n            this.terminal.loadAddon(new WebglAddon());\n            // WebGL renderer ignores `cursorBlink` set before it initialized\n            this.terminal.options.cursorBlink = true;\n            this.fit();\n        }\n    }\n\n    public fit() {\n        this.fitAddon.fit();\n        // Resize remote terminal\n        const { rows, cols } = this.terminal;\n        this._socket?.resize(rows, cols);\n    }\n}\n"],"names":["AdbTerminal","element","document","createElement","terminal","Terminal","scrollback","searchAddon","SearchAddon","fitAddon","FitAddon","style","width","height","overflow","options","fontFamily","letterSpacing","cursorStyle","loadAddon","setContainer","container","appendChild","this","offsetWidth","open","WebglAddon","cursorBlink","fit","rows","cols","_socket","resize","socket","value","dispose","_socketAbortController","abort","clear","reset","AbortController","stdout","pipeTo","WritableStream","write","chunk","signal","_writer","stdin","getWriter","addDisposable","onData","data","buffer","encodeUtf8","AutoDisposable"],"sourceRoot":""}