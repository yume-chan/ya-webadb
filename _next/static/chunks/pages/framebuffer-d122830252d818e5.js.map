{"version":3,"file":"static/chunks/pages/framebuffer-d122830252d818e5.js","mappings":"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","sources":["webpack://_N_E/?99e2","webpack://_N_E/./src/pages/framebuffer.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/framebuffer\",\n      function () {\n        return require(\"private-next-pages/framebuffer.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/framebuffer\"])\n      });\n    }\n  ","import { ICommandBarItemProps, Stack } from \"@fluentui/react\";\nimport { AdbFrameBuffer, AdbFrameBufferV2 } from \"@yume-chan/adb\";\nimport { action, autorun, computed, makeAutoObservable } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { CommandBar, DemoModePanel, DeviceView } from \"../components\";\nimport { GLOBAL_STATE } from \"../state\";\nimport { Icons, RouteStackProps } from \"../utils\";\n\nclass FrameBufferState {\n    width = 0;\n    height = 0;\n    imageData: ImageData | undefined = undefined;\n    demoModeVisible = false;\n\n    constructor() {\n        makeAutoObservable(this, {\n            toggleDemoModeVisible: action.bound,\n        });\n    }\n\n    setImage(image: AdbFrameBuffer) {\n        this.width = image.width;\n        this.height = image.height;\n        this.imageData = new ImageData(\n            new Uint8ClampedArray(image.data),\n            image.width,\n            image.height\n        );\n    }\n\n    toggleDemoModeVisible() {\n        this.demoModeVisible = !this.demoModeVisible;\n    }\n}\n\nconst state = new FrameBufferState();\n\nconst FrameBuffer: NextPage = (): JSX.Element | null => {\n    const canvasRef = useRef<HTMLCanvasElement | null>(null);\n\n    const capture = useCallback(async () => {\n        if (!GLOBAL_STATE.adb) {\n            return;\n        }\n\n        try {\n            const start = Date.now();\n            const framebuffer = await GLOBAL_STATE.adb.framebuffer();\n            console.log(\n                \"Framebuffer speed\",\n                (\n                    (((AdbFrameBufferV2.size + framebuffer.size) /\n                        (Date.now() - start)) *\n                        1000) /\n                    1024 /\n                    1024\n                ).toFixed(2),\n                \"MB/s\"\n            );\n            state.setImage(framebuffer);\n        } catch (e: any) {\n            GLOBAL_STATE.showErrorDialog(e);\n        }\n    }, []);\n\n    useEffect(() => {\n        return autorun(() => {\n            const canvas = canvasRef.current;\n            if (canvas && state.imageData) {\n                canvas.width = state.width;\n                canvas.height = state.height;\n                const context = canvas.getContext(\"2d\")!;\n                context.putImageData(state.imageData, 0, 0);\n            }\n        });\n    }, []);\n\n    const commandBarItems = computed(() => [\n        {\n            key: \"start\",\n            disabled: !GLOBAL_STATE.adb,\n            iconProps: {\n                iconName: Icons.Camera,\n                style: { height: 20, fontSize: 20, lineHeight: 1.5 },\n            },\n            text: \"Capture\",\n            onClick: capture,\n        },\n        {\n            key: \"Save\",\n            disabled: !state.imageData,\n            iconProps: {\n                iconName: Icons.Save,\n                style: { height: 20, fontSize: 20, lineHeight: 1.5 },\n            },\n            text: \"Save\",\n            onClick: () => {\n                const canvas = canvasRef.current;\n                if (!canvas) {\n                    return;\n                }\n\n                const url = canvas.toDataURL();\n                const a = document.createElement(\"a\");\n                a.href = url;\n                a.download = `Screenshot of ${GLOBAL_STATE.device!.name}.png`;\n                a.click();\n            },\n        },\n    ]);\n\n    const commandBarFarItems = computed((): ICommandBarItemProps[] => [\n        {\n            key: \"DemoMode\",\n            iconProps: {\n                iconName: Icons.Wand,\n                style: { height: 20, fontSize: 20, lineHeight: 1.5 },\n            },\n            checked: state.demoModeVisible,\n            text: \"Demo Mode\",\n            onClick: state.toggleDemoModeVisible,\n        },\n        {\n            key: \"info\",\n            iconProps: {\n                iconName: Icons.Info,\n                style: { height: 20, fontSize: 20, lineHeight: 1.5 },\n            },\n            iconOnly: true,\n            tooltipHostProps: {\n                content:\n                    \"Use ADB FrameBuffer command to capture a full-size, high-resolution screenshot.\",\n                calloutProps: {\n                    calloutMaxWidth: 250,\n                },\n            },\n        },\n    ]);\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Screen Capture - Tango</title>\n            </Head>\n\n            <CommandBar\n                items={commandBarItems.get()}\n                farItems={commandBarFarItems.get()}\n            />\n            <Stack horizontal grow styles={{ root: { height: 0 } }}>\n                <DeviceView width={state.width} height={state.height}>\n                    <canvas ref={canvasRef} style={{ display: \"block\" }} />\n                </DeviceView>\n\n                <DemoModePanel\n                    style={{\n                        display: state.demoModeVisible ? \"block\" : \"none\",\n                    }}\n                />\n            </Stack>\n        </Stack>\n    );\n};\n\nexport default observer(FrameBuffer);\n"],"names":["window","__NEXT_P","push","__webpack_require__","state","setImage","image","width","height","imageData","ImageData","Uint8ClampedArray","data","toggleDemoModeVisible","demoModeVisible","constructor","undefined","makeAutoObservable","action","bound","__webpack_exports__","observer","canvasRef","useRef","capture","useCallback","GLOBAL_STATE","adb","start","Date","now","framebuffer","console","log","AdbFrameBufferV2","size","toFixed","e","showErrorDialog","useEffect","autorun","canvas","current","context","getContext","putImageData","commandBarItems","computed","key","disabled","iconProps","iconName","Icons","Camera","style","fontSize","lineHeight","text","onClick","Save","url","toDataURL","a","document","createElement","href","download","concat","device","name","click","commandBarFarItems","Wand","checked","Info","iconOnly","tooltipHostProps","content","calloutProps","calloutMaxWidth","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsxs","Stack","RouteStackProps","jsx","Head","title","CommandBar","items","get","farItems","horizontal","grow","styles","root","DeviceView","ref","display","DemoModePanel"],"sourceRoot":""}