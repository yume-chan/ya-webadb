{"version":3,"file":"static/chunks/pages/reverse-efffc52d530f9311.js","mappings":"kFACA,CAAAA,OAAAC,QAAA,CAAAD,OAAAC,QAAA,MAAAC,IAAA,EACA,WACA,WACA,OAAeC,EAAQ,KACvB,EACA,4GCCA,IAAMC,EAAQC,CAAAA,EAAAA,EAAAA,EAAAA,EAAmB,CAC7BC,IAAK,EAAE,GAGXC,CAAAA,EAAAA,EAAAA,EAAAA,EACI,IAAMC,EAAAA,CAAAA,CAAAA,MAAmB,CACzB,MAAOC,GAAW,CACTA,IAIL,MAAMA,EAAOC,OAAO,CAACC,MAAM,CAAC,YAAYC,KAAK,CAAC,IAAM,CAAC,GACrD,MAAMH,EAAOC,OAAO,CAACG,GAAG,CAAC,WAAY,WAAY,IAC7CC,CAAAA,EAAAA,EAAAA,CAAAA,EAAY,IAAM,CACdV,EAAME,GAAG,CAACJ,IAAI,CAAC,mBAAkCa,MAAA,CAAfC,EAAOC,OAAO,EACpD,GACAD,EAAOE,QAAQ,CAACC,MAAM,CAClB,IAAIC,EAAAA,EAAcA,CAAC,CACfC,MAAO,GAAW,CACdP,CAAAA,EAAAA,EAAAA,CAAAA,EAAY,IAAM,CACdV,EAAME,GAAG,CAACJ,IAAI,CACV,aAAgCoB,MAAAA,CAAnBN,EAAOC,OAAO,CAAC,MAE1BF,MAAA,CAF8BO,CAAAA,EAAAA,EAAAA,EAAAA,EAC5BC,IAGZ,EACJ,CACJ,IAIG,KAEf,EACA,CAAEC,gBAAiB,EAAK,GAG5B,IAAMC,EAA8B,IAE5B,GAAAC,EAAAC,GAAA,EAACC,MAAAA,UACIxB,EAAME,GAAG,CAACuB,GAAG,CAAC,CAACC,EAAMC,IAClB,GAAAL,EAAAC,GAAA,EAACC,MAAAA,UAAiBE,GAARC,KAM1BC,CAAAA,EAAA,QAAeC,CAAAA,EAAAA,EAAAA,EAAAA,EAASR","sources":["webpack://_N_E/?98f1","webpack://_N_E/./src/pages/reverse.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/reverse\",\n      function () {\n        return require(\"private-next-pages/reverse.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/reverse\"])\n      });\n    }\n  ","import { decodeUtf8 } from \"@yume-chan/adb\";\nimport { WritableStream } from \"@yume-chan/stream-extra\";\nimport { makeAutoObservable, reaction, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport { GLOBAL_STATE } from \"../state\";\n\nconst state = makeAutoObservable({\n    log: [] as string[],\n});\n\nreaction(\n    () => GLOBAL_STATE.device,\n    async (device) => {\n        if (!device) {\n            return;\n        }\n\n        await device.reverse.remove(\"tcp:3000\").catch(() => {});\n        await device.reverse.add(\"tcp:3000\", \"tcp:1234\", (socket) => {\n            runInAction(() => {\n                state.log.push(`received stream ${socket.localId}`);\n            });\n            socket.readable.pipeTo(\n                new WritableStream({\n                    write: (chunk) => {\n                        runInAction(() => {\n                            state.log.push(\n                                `data from ${socket.localId}: ${decodeUtf8(\n                                    chunk\n                                )}`\n                            );\n                        });\n                    },\n                })\n            );\n\n            // Return true to accept the connection.\n            return true;\n        });\n    },\n    { fireImmediately: true }\n);\n\nconst ReverseTesterPage: NextPage = () => {\n    return (\n        <div>\n            {state.log.map((line, index) => (\n                <div key={index}>{line}</div>\n            ))}\n        </div>\n    );\n};\n\nexport default observer(ReverseTesterPage);\n"],"names":["window","__NEXT_P","push","__webpack_require__","state","makeAutoObservable","log","reaction","GLOBAL_STATE","device","reverse","remove","catch","add","runInAction","concat","socket","localId","readable","pipeTo","WritableStream","write","decodeUtf8","chunk","fireImmediately","ReverseTesterPage","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsx","div","map","line","index","__webpack_exports__","observer"],"sourceRoot":""}