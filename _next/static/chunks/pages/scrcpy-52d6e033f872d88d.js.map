{"version":3,"file":"static/chunks/pages/scrcpy-52d6e033f872d88d.js","mappings":"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","sources":["webpack://_N_E/?5356","webpack://_N_E/./src/pages/scrcpy.tsx","webpack://_N_E/../../common/temp/node_modules/.pnpm/@fluentui+react@8.68.0_12a6012245369fd5be825566be975ff0/node_modules/@fluentui/react/lib/components/src/components/Layer/LayerHost.tsx","webpack://_N_E/../../libraries/scrcpy/bin/version.js","webpack://_N_E/../../libraries/scrcpy/src/message.ts","webpack://_N_E/../../libraries/scrcpy/src/client.ts","webpack://_N_E/../../libraries/scrcpy/src/codec.ts","webpack://_N_E/../../libraries/scrcpy/src/decoder/tinyh264/wrapper.ts","webpack://_N_E/../../libraries/scrcpy/src/decoder/tinyh264/index.ts","webpack://_N_E/../../libraries/scrcpy/src/decoder/web-codecs/index.ts","webpack://_N_E/../../libraries/scrcpy/src/utils.ts","webpack://_N_E/../../libraries/scrcpy/src/connection.ts","webpack://_N_E/../../libraries/scrcpy/src/options/common.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/sps.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_18.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_21.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_23.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_24.ts","webpack://_N_E/../../libraries/scrcpy/src/push-server.ts"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/scrcpy\",\n      function () {\n        return require(\"private-next-pages/scrcpy.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/scrcpy\"])\n      });\n    }\n  ","import { CommandBar, Dialog, Dropdown, ICommandBarItemProps, Icon, IconButton, IDropdownOption, LayerHost, Position, ProgressIndicator, SpinButton, Stack, TextField, Toggle, TooltipHost } from \"@fluentui/react\";\nimport { useId } from \"@fluentui/react-hooks\";\nimport { makeStyles } from \"@griffel/react\";\nimport { action, autorun, makeAutoObservable, observable, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { CSSProperties, ReactNode, useEffect, useState } from \"react\";\n\nimport { ADB_SYNC_MAX_PACKET_SIZE, ChunkStream, InspectStream, ReadableStream, WritableStream } from '@yume-chan/adb';\nimport { EventEmitter } from \"@yume-chan/event\";\nimport { AndroidKeyCode, AndroidKeyEventAction, AndroidMotionEventAction, CodecOptions, DEFAULT_SERVER_PATH, pushServer, ScrcpyClient, ScrcpyLogLevel, ScrcpyOptions1_24, ScrcpyVideoOrientation, TinyH264Decoder, WebCodecsDecoder, type H264Decoder, type H264DecoderConstructor, type VideoStreamPacket } from \"@yume-chan/scrcpy\";\nimport SCRCPY_SERVER_VERSION from '@yume-chan/scrcpy/bin/version';\n\nimport { DemoModePanel, DeviceView, DeviceViewRef, ExternalLink } from \"../components\";\nimport { GlobalState } from \"../state\";\nimport { CommonStackTokens, formatSpeed, Icons, ProgressStream, RouteStackProps } from \"../utils\";\n\nconst SERVER_URL = new URL('@yume-chan/scrcpy/bin/scrcpy-server?url', import.meta.url).toString();\n\nclass FetchWithProgress {\n    public readonly promise: Promise<Uint8Array>;\n\n    private _downloaded = 0;\n    public get downloaded() { return this._downloaded; }\n\n    private _total = 0;\n    public get total() { return this._total; }\n\n    private progressEvent = new EventEmitter<[download: number, total: number]>();\n    public get onProgress() { return this.progressEvent.event; }\n\n    public constructor(url: string) {\n        this.promise = this.fetch(url);\n    }\n\n    private async fetch(url: string) {\n        const response = await window.fetch(url);\n        this._total = Number.parseInt(response.headers.get('Content-Length') ?? '0', 10);\n        this.progressEvent.fire([this._downloaded, this._total]);\n\n        const reader = response.body!.getReader();\n        const chunks: Uint8Array[] = [];\n        while (true) {\n            const result = await reader.read();\n            if (result.done) {\n                break;\n            }\n            chunks.push(result.value);\n            this._downloaded += result.value.byteLength;\n            this.progressEvent.fire([this._downloaded, this._total]);\n        }\n\n        this._total = chunks.reduce((result, item) => result + item.byteLength, 0);\n        const result = new Uint8Array(this._total);\n        let position = 0;\n        for (const chunk of chunks) {\n            result.set(chunk, position);\n            position += chunk.byteLength;\n        }\n        return result;\n    }\n}\n\nlet cachedValue: FetchWithProgress | undefined;\nfunction fetchServer(onProgress?: (e: [downloaded: number, total: number]) => void) {\n    if (!cachedValue) {\n        cachedValue = new FetchWithProgress(SERVER_URL);\n        cachedValue.promise.catch((e) => {\n            cachedValue = undefined;\n        });\n    }\n\n    if (onProgress) {\n        cachedValue.onProgress(onProgress);\n        onProgress([cachedValue.downloaded, cachedValue.total]);\n    }\n\n    return cachedValue.promise;\n}\n\nfunction clamp(value: number, min: number, max: number): number {\n    if (value < min) {\n        return min;\n    }\n\n    if (value > max) {\n        return max;\n    }\n\n    return value;\n}\n\ninterface DecoderDefinition {\n    key: string;\n    name: string;\n    Constructor: H264DecoderConstructor;\n}\n\ninterface Settings {\n    maxSize: number;\n    bitRate: number;\n    tunnelForward?: boolean;\n    encoderName?: string;\n    decoder?: string;\n    ignoreDecoderCodecArgs?: boolean;\n    lockVideoOrientation?: ScrcpyVideoOrientation;\n    displayId?: number;\n    crop: string;\n}\n\ninterface SettingDefinitionBase {\n    key: keyof Settings;\n    type: string;\n    label: string;\n    labelExtra?: JSX.Element;\n    description?: string;\n}\n\ninterface TextSettingDefinition extends SettingDefinitionBase {\n    type: 'text';\n    placeholder?: string;\n}\n\ninterface DropdownSettingDefinition extends SettingDefinitionBase {\n    type: 'dropdown';\n    placeholder?: string;\n    options: IDropdownOption[];\n}\n\ninterface ToggleSettingDefinition extends SettingDefinitionBase {\n    type: 'toggle',\n}\n\ninterface NumberSettingDefinition extends SettingDefinitionBase {\n    type: 'number',\n    min?: number;\n    max?: number;\n    step?: number;\n}\n\ntype SettingDefinition =\n    TextSettingDefinition |\n    DropdownSettingDefinition |\n    ToggleSettingDefinition |\n    NumberSettingDefinition;\n\ninterface SettingItemProps {\n    definition: SettingDefinition;\n    settings: any;\n    onChange: (key: keyof Settings, value: any) => void;\n}\n\nconst useClasses = makeStyles({\n    labelRight: {\n        marginLeft: '4px',\n    },\n    video: {\n        transformOrigin: 'center center',\n    },\n});\n\nconst SettingItem = observer(function SettingItem({\n    definition,\n    settings,\n    onChange,\n}: SettingItemProps) {\n    const classes = useClasses();\n\n    let label: JSX.Element = (\n        <Stack horizontal verticalAlign=\"center\">\n            <span>{definition.label}</span>\n            {!!definition.description && (\n                <TooltipHost content={definition.description}>\n                    <Icon className={classes.labelRight} iconName={Icons.Info} />\n                </TooltipHost>\n            )}\n            {definition.labelExtra}\n        </Stack>\n    );\n\n    switch (definition.type) {\n        case 'text':\n            return (\n                <TextField\n                    label={label as any}\n                    placeholder={definition.placeholder}\n                    value={settings[definition.key]}\n                    onChange={(e, value) => onChange(definition.key, value)}\n                />\n            );\n        case 'dropdown':\n            return (\n                <Dropdown\n                    label={label as any}\n                    options={definition.options}\n                    placeholder={definition.placeholder}\n                    selectedKey={settings[definition.key]}\n                    onChange={(e, option) => onChange(definition.key, option!.key)}\n                />\n            );\n        case 'toggle':\n            return (\n                <Toggle\n                    label={label}\n                    checked={settings[definition.key]}\n                    onChange={(e, checked) => onChange(definition.key, checked)}\n                />\n            );\n        case 'number':\n            return (\n                <SpinButton\n                    label={definition.label}\n                    labelPosition={Position.top}\n                    min={definition.min}\n                    max={definition.max}\n                    step={definition.step}\n                    value={settings[definition.key].toString()}\n                    onChange={(e, value) => onChange(definition.key, Number.parseInt(value!, 10))}\n                />\n            );\n    }\n});\n\nclass ScrcpyPageState {\n    running = false;\n\n    deviceView: DeviceViewRef | null = null;\n    rendererContainer: HTMLDivElement | null = null;\n\n    logVisible = false;\n    log: string[] = [];\n    settingsVisible = false;\n    demoModeVisible = false;\n    navigationBarVisible = true;\n\n    width = 0;\n    height = 0;\n    rotate = 0;\n\n    get rotatedWidth() { return state.rotate & 1 ? state.height : state.width; }\n    get rotatedHeight() { return state.rotate & 1 ? state.width : state.height; }\n\n    client: ScrcpyClient | undefined = undefined;\n\n    async pushServer() {\n        const serverBuffer = await fetchServer();\n\n        await new ReadableStream<Uint8Array>({\n            start(controller) {\n                controller.enqueue(serverBuffer);\n                controller.close();\n            },\n        })\n            .pipeTo(pushServer(GlobalState.device!));\n    }\n\n    encoders: string[] = [];\n    updateEncoders = async () => {\n        try {\n            await this.pushServer();\n\n            const encoders = await ScrcpyClient.getEncoders(\n                GlobalState.device!,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                new ScrcpyOptions1_24({\n                    logLevel: ScrcpyLogLevel.Debug,\n                    tunnelForward: this.settings.tunnelForward,\n                })\n            );\n\n            runInAction(() => {\n                this.encoders = encoders;\n                if (!this.settings.encoderName ||\n                    !this.encoders.includes(this.settings.encoderName)) {\n                    this.settings.encoderName = this.encoders[0];\n                }\n            });\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        }\n    };\n\n    decoders: DecoderDefinition[] = [{\n        key: 'tinyh264',\n        name: 'TinyH264 (Software)',\n        Constructor: TinyH264Decoder,\n    }];\n    decoder: H264Decoder | undefined = undefined;\n    fpsCounterIntervalId: any = undefined;\n    fps = 0;\n\n    displays: number[] = [];\n    updateDisplays = async () => {\n        try {\n            await this.pushServer();\n\n            const displays = await ScrcpyClient.getDisplays(\n                GlobalState.device!,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                new ScrcpyOptions1_24({\n                    logLevel: ScrcpyLogLevel.Debug,\n                    tunnelForward: this.settings.tunnelForward,\n                })\n            );\n\n            runInAction(() => {\n                this.displays = displays;\n                if (!this.settings.displayId ||\n                    !this.displays.includes(this.settings.displayId)) {\n                    this.settings.displayId = this.displays[0];\n                }\n            });\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        }\n    };\n\n    connecting = false;\n    serverTotalSize = 0;\n    serverDownloadedSize = 0;\n    debouncedServerDownloadedSize = 0;\n    serverDownloadSpeed = 0;\n    serverUploadedSize = 0;\n    debouncedServerUploadedSize = 0;\n    serverUploadSpeed = 0;\n\n    get commandBarItems() {\n        const result: ICommandBarItemProps[] = [];\n\n        if (!this.running) {\n            result.push({\n                key: 'start',\n                disabled: !GlobalState.device,\n                iconProps: { iconName: Icons.Play },\n                text: 'Start',\n                onClick: this.start as VoidFunction,\n            });\n        } else {\n            result.push({\n                key: 'stop',\n                iconProps: { iconName: Icons.Stop },\n                text: 'Stop',\n                onClick: this.stop as VoidFunction,\n            });\n        }\n\n        result.push({\n            key: 'fullscreen',\n            disabled: !this.running,\n            iconProps: { iconName: Icons.FullScreenMaximize },\n            iconOnly: true,\n            text: 'Fullscreen',\n            onClick: () => { this.deviceView?.enterFullscreen(); },\n        });\n\n        result.push({\n            key: 'rotateDevice',\n            disabled: !this.running,\n            iconProps: { iconName: Icons.Orientation },\n            iconOnly: true,\n            text: 'Rotate Device',\n            onClick: () => { this.client!.rotateDevice(); },\n        });\n\n        result.push({\n            key: 'rotateVideoLeft',\n            disabled: !this.running,\n            iconProps: { iconName: Icons.RotateLeft },\n            iconOnly: true,\n            text: 'Rotate Video Left',\n            onClick: () => {\n                this.rotate -= 1;\n                if (this.rotate < 0) {\n                    this.rotate = 3;\n                }\n            }\n        });\n\n        result.push({\n            key: 'rotateVideoRight',\n            disabled: !this.running,\n            iconProps: { iconName: Icons.RotateRight },\n            iconOnly: true,\n            text: 'Rotate Video Right',\n            onClick: () => {\n                this.rotate = (this.rotate + 1) & 3;\n            },\n        });\n\n        if (this.running) {\n            result.push({\n                key: 'fps',\n                text: `FPS: ${this.fps}`,\n                disabled: true,\n            });\n        }\n\n        return result;\n    }\n\n    get commandBarFarItems(): ICommandBarItemProps[] {\n        return [\n            {\n                key: 'NavigationBar',\n                iconProps: { iconName: Icons.PanelBottom },\n                checked: this.navigationBarVisible,\n                text: 'Navigation Bar',\n                iconOnly: true,\n                onClick: action(() => {\n                    this.navigationBarVisible = !this.navigationBarVisible;\n                }),\n            },\n            {\n                key: 'Log',\n                iconProps: { iconName: Icons.TextGrammarError },\n                checked: this.logVisible,\n                text: 'Log',\n                iconOnly: true,\n                onClick: action(() => {\n                    this.logVisible = !this.logVisible;\n                }),\n            },\n            {\n                key: 'Settings',\n                iconProps: { iconName: Icons.Settings },\n                checked: this.settingsVisible,\n                text: 'Settings',\n                iconOnly: true,\n                onClick: action(() => {\n                    this.settingsVisible = !this.settingsVisible;\n                }),\n            },\n            {\n                key: 'DemoMode',\n                iconProps: { iconName: Icons.Wand },\n                checked: this.demoModeVisible,\n                text: 'Demo Mode',\n                iconOnly: true,\n                onClick: action(() => {\n                    this.demoModeVisible = !this.demoModeVisible;\n                }),\n            },\n            {\n                key: 'info',\n                iconProps: { iconName: Icons.Info },\n                iconOnly: true,\n                tooltipHostProps: {\n                    content: (\n                        <>\n                            <p>\n                                <ExternalLink href=\"https://github.com/Genymobile/scrcpy\" spaceAfter>Scrcpy</ExternalLink>\n                                developed by Genymobile can display the screen with low latency (1~2 frames) and control the device, all without root access.\n                            </p>\n                            <p>\n                                This is a TypeScript implementation of the client part. Paired with official pre-built server binary.\n                            </p>\n                        </>\n                    ),\n                    calloutProps: {\n                        calloutMaxWidth: 300,\n                    }\n                },\n            }\n        ];\n    }\n\n    settings: Settings = {\n        maxSize: 1080,\n        bitRate: 4_000_000,\n        lockVideoOrientation: ScrcpyVideoOrientation.Unlocked,\n        displayId: 0,\n        crop: '',\n    };\n\n    get settingDefinitions() {\n        const result: SettingDefinition[] = [];\n\n        result.push({\n            key: 'encoderName',\n            type: 'dropdown',\n            label: 'Encoder',\n            placeholder: 'Press refresh to update available encoders',\n            labelExtra: (\n                <IconButton\n                    iconProps={{ iconName: Icons.ArrowClockwise }}\n                    disabled={!GlobalState.device}\n                    text=\"Refresh\"\n                    onClick={this.updateEncoders}\n                />\n            ),\n            options: this.encoders.map(item => ({\n                key: item,\n                text: item,\n            })),\n        });\n\n        if (this.decoders.length > 1) {\n            result.push({\n                key: 'decoder',\n                type: 'dropdown',\n                label: 'Decoder',\n                options: this.decoders.map(item => ({\n                    key: item.key,\n                    text: item.name,\n                    data: item,\n                })),\n            });\n        }\n\n        result.push({\n            key: 'ignoreDecoderCodecArgs',\n            type: 'toggle',\n            label: `Ignore decoder's codec arguments`,\n            description: `Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used.`,\n        });\n\n        result.push({\n            key: 'maxSize',\n            type: 'number',\n            label: 'Max Resolution (longer side, 0 = unlimited)',\n            min: 0,\n            max: 2560,\n            step: 50,\n        });\n\n        result.push({\n            key: 'bitRate',\n            type: 'number',\n            label: 'Max Bit Rate',\n            min: 100,\n            max: 100_000_000,\n            step: 100,\n        });\n\n        result.push({\n            key: 'tunnelForward',\n            type: 'toggle',\n            label: 'Use forward connection',\n            description: 'Android before version 9 has a bug that prevents reverse tunneling when using ADB over WiFi.'\n        });\n\n        result.push({\n            key: 'lockVideoOrientation',\n            type: 'dropdown',\n            label: 'Lock Video Orientation',\n            options: [\n                {\n                    key: ScrcpyVideoOrientation.Unlocked,\n                    text: 'Unlocked',\n                },\n                {\n                    key: ScrcpyVideoOrientation.Initial,\n                    text: 'Current',\n                },\n                {\n                    key: ScrcpyVideoOrientation.Portrait,\n                    text: 'Portrait',\n                },\n                {\n                    key: ScrcpyVideoOrientation.Landscape,\n                    text: 'Landscape',\n                },\n                {\n                    key: ScrcpyVideoOrientation.PortraitFlipped,\n                    text: 'Portrait (Flipped)',\n                },\n                {\n                    key: ScrcpyVideoOrientation.LandscapeFlipped,\n                    text: 'Landscape (Flipped)',\n                },\n            ],\n        });\n\n        result.push({\n            key: 'displayId',\n            type: 'dropdown',\n            label: 'Display',\n            placeholder: 'Press refresh to update available displays',\n            labelExtra: (\n                <IconButton\n                    iconProps={{ iconName: Icons.ArrowClockwise }}\n                    disabled={!GlobalState.device}\n                    text=\"Refresh\"\n                    onClick={this.updateDisplays}\n                />\n            ),\n            options: this.displays.map(item => ({\n                key: item,\n                text: item.toString(),\n            })),\n        });\n\n        result.push({\n            key: 'crop',\n            type: 'text',\n            label: 'Crop',\n            placeholder: 'W:H:X:Y',\n        });\n\n        return result;\n    }\n\n    constructor() {\n        makeAutoObservable(this, {\n            decoders: observable.shallow,\n            settings: observable.deep,\n            start: false,\n            stop: action.bound,\n            dispose: action.bound,\n            handleDeviceViewRef: action.bound,\n            handleRendererContainerRef: action.bound,\n            handleBackPointerDown: false,\n            handleBackPointerUp: false,\n            handleHomePointerDown: false,\n            handleHomePointerUp: false,\n            handleAppSwitchPointerDown: false,\n            handleAppSwitchPointerUp: false,\n            calculatePointerPosition: false,\n            injectTouch: false,\n            handlePointerDown: false,\n            handlePointerMove: false,\n            handlePointerUp: false,\n            handleWheel: false,\n            handleContextMenu: false,\n            handleKeyDown: false,\n        });\n\n        autorun(() => {\n            if (GlobalState.device) {\n                runInAction(() => {\n                    this.encoders = [];\n                    this.settings.encoderName = undefined;\n\n                    this.displays = [];\n                    this.settings.displayId = undefined;\n                });\n            } else {\n                this.dispose();\n            }\n        });\n\n        autorun(() => {\n            if (this.rendererContainer && this.decoder) {\n                while (this.rendererContainer.firstChild) {\n                    this.rendererContainer.firstChild.remove();\n                }\n                this.rendererContainer.appendChild(this.decoder.renderer);\n            }\n        });\n\n        autorun(() => {\n            this.settings.decoder = this.decoders[0].key;\n        });\n\n        if (typeof window !== 'undefined' && typeof window.VideoDecoder === 'function') {\n            setTimeout(action(() => {\n                this.decoders.unshift({\n                    key: 'webcodecs',\n                    name: 'WebCodecs',\n                    Constructor: WebCodecsDecoder,\n                });\n            }), 0);\n        }\n    }\n\n    start = async () => {\n        if (!GlobalState.device) {\n            return;\n        }\n\n        try {\n            if (!this.settings.decoder) {\n                throw new Error('No available decoder');\n            }\n\n            runInAction(() => {\n                this.serverTotalSize = 0;\n                this.serverDownloadedSize = 0;\n                this.debouncedServerDownloadedSize = 0;\n                this.serverUploadedSize = 0;\n                this.debouncedServerUploadedSize = 0;\n                this.connecting = true;\n            });\n\n            let intervalId = setInterval(action(() => {\n                this.serverDownloadSpeed = this.serverDownloadedSize - this.debouncedServerDownloadedSize;\n                this.debouncedServerDownloadedSize = this.serverDownloadedSize;\n            }), 1000);\n\n            let serverBuffer: Uint8Array;\n\n            try {\n                serverBuffer = await fetchServer(action(([downloaded, total]) => {\n                    this.serverDownloadedSize = downloaded;\n                    this.serverTotalSize = total;\n                }));\n                runInAction(() => {\n                    this.serverDownloadSpeed = this.serverDownloadedSize - this.debouncedServerDownloadedSize;\n                    this.debouncedServerDownloadedSize = this.serverDownloadedSize;\n                });\n            } finally {\n                clearInterval(intervalId);\n            }\n\n            intervalId = setInterval(action(() => {\n                this.serverUploadSpeed = this.serverUploadedSize - this.debouncedServerUploadedSize;\n                this.debouncedServerUploadedSize = this.serverUploadedSize;\n            }), 1000);\n\n            try {\n                await new ReadableStream<Uint8Array>({\n                    start(controller) {\n                        controller.enqueue(serverBuffer);\n                        controller.close();\n                    },\n                })\n                    .pipeThrough(new ChunkStream(ADB_SYNC_MAX_PACKET_SIZE))\n                    .pipeThrough(new ProgressStream(action((progress) => {\n                        this.serverUploadedSize = progress;\n                    })))\n                    .pipeTo(pushServer(GlobalState.device));\n\n                runInAction(() => {\n                    this.serverUploadSpeed = this.serverUploadedSize - this.debouncedServerUploadedSize;\n                    this.debouncedServerUploadedSize = this.serverUploadedSize;\n                });\n            } finally {\n                clearInterval(intervalId);\n            }\n\n            const decoderDefinition = this.decoders.find(x => x.key === this.settings.decoder) ?? this.decoders[0];\n            const decoder = new decoderDefinition.Constructor();\n\n            runInAction(() => {\n                this.decoder = decoder;\n\n                let lastFrameCount = 0;\n                this.fpsCounterIntervalId = setInterval(action(() => {\n                    this.fps = decoder.frameRendered - lastFrameCount;\n                    lastFrameCount = decoder.frameRendered;\n                }), 1000);\n            });\n\n            const options = new ScrcpyOptions1_24({\n                logLevel: ScrcpyLogLevel.Debug,\n                ...this.settings,\n                sendDeviceMeta: false,\n                sendDummyByte: false,\n                codecOptions: !this.settings.ignoreDecoderCodecArgs\n                    ? new CodecOptions({\n                        profile: decoder.maxProfile,\n                        level: decoder.maxLevel,\n                    })\n                    : undefined,\n            });\n\n            runInAction(() => {\n                this.log = [];\n                this.log.push(`[client] Server version: ${SCRCPY_SERVER_VERSION}`);\n                this.log.push(`[client] Server arguments: ${options.formatServerArguments().join(' ')}`);\n            });\n\n            const client = await ScrcpyClient.start(\n                GlobalState.device,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                options\n            );\n\n            client.stdout.pipeTo(new WritableStream<string>({\n                write: action((line) => {\n                    this.log.push(line);\n                }),\n            }));\n\n            client.videoStream\n                .pipeThrough(new InspectStream(action((packet: VideoStreamPacket) => {\n                    if (packet.type === 'configuration') {\n                        const { croppedWidth, croppedHeight, } = packet.data;\n                        this.log.push(`[client] Video size changed: ${croppedWidth}x${croppedHeight}`);\n\n                        this.width = croppedWidth;\n                        this.height = croppedHeight;\n                    }\n                })))\n                .pipeTo(decoder.writable)\n                .catch(() => { });\n\n            client.exit.then(this.dispose);\n\n            client.onClipboardChange(content => {\n                window.navigator.clipboard.writeText(content);\n            });\n\n            runInAction(() => {\n                this.client = client;\n                this.running = true;\n            });\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        } finally {\n            runInAction(() => {\n                this.connecting = false;\n            });\n        }\n    };\n\n    async stop() {\n        // Request to close client first\n        await this.client?.close();\n        this.dispose();\n    }\n\n    dispose() {\n        // Otherwise some packets may still arrive at decoder\n        this.decoder?.dispose();\n        this.decoder = undefined;\n\n        this.fps = 0;\n        clearTimeout(this.fpsCounterIntervalId);\n\n        this.client = undefined;\n        this.running = false;\n    }\n\n    handleDeviceViewRef(element: DeviceViewRef | null) {\n        this.deviceView = element;\n    }\n\n    handleRendererContainerRef(element: HTMLDivElement | null) {\n        this.rendererContainer = element;\n        this.rendererContainer?.addEventListener('wheel', this.handleWheel, { passive: false });\n    };\n\n    handleBackPointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n        e.currentTarget.setPointerCapture(e.pointerId);\n\n        this.client.pressBackOrTurnOnScreen(AndroidKeyEventAction.Down);\n    };\n\n    handleBackPointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n\n        this.client.pressBackOrTurnOnScreen(AndroidKeyEventAction.Up);\n    };\n\n    handleHomePointerDown = async (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n        e.currentTarget.setPointerCapture(e.pointerId);\n\n        await this.client.injectKeyCode({\n            action: AndroidKeyEventAction.Down,\n            keyCode: AndroidKeyCode.Home,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    handleHomePointerUp = async (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n\n        await this.client.injectKeyCode({\n            action: AndroidKeyEventAction.Up,\n            keyCode: AndroidKeyCode.Home,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    handleAppSwitchPointerDown = async (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n        e.currentTarget.setPointerCapture(e.pointerId);\n\n        await this.client.injectKeyCode({\n            action: AndroidKeyEventAction.Down,\n            keyCode: AndroidKeyCode.AppSwitch,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    handleAppSwitchPointerUp = async (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n\n        await this.client.injectKeyCode({\n            action: AndroidKeyEventAction.Up,\n            keyCode: AndroidKeyCode.AppSwitch,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    calculatePointerPosition(clientX: number, clientY: number) {\n        const viewRect = this.rendererContainer!.getBoundingClientRect();\n        let pointerViewX = clamp((clientX - viewRect.x) / viewRect.width, 0, 1);\n        let pointerViewY = clamp((clientY - viewRect.y) / viewRect.height, 0, 1);\n\n        if (this.rotate & 1) {\n            ([pointerViewX, pointerViewY] = [pointerViewY, pointerViewX]);\n        }\n        switch (this.rotate) {\n            case 1:\n                pointerViewY = 1 - pointerViewY;\n                break;\n            case 2:\n                pointerViewX = 1 - pointerViewX;\n                pointerViewY = 1 - pointerViewY;\n                break;\n            case 3:\n                pointerViewX = 1 - pointerViewX;\n                break;\n        }\n\n        return {\n            x: pointerViewX * this.width,\n            y: pointerViewY * this.height,\n        };\n    }\n\n    injectTouch = (\n        action: AndroidMotionEventAction,\n        e: React.PointerEvent<HTMLDivElement>\n    ) => {\n        if (!this.client) {\n            return;\n        }\n\n        const { x, y } = this.calculatePointerPosition(e.clientX, e.clientY);\n        this.client.injectTouch({\n            action,\n            pointerId: e.pointerType === \"mouse\" ? BigInt(-1) : BigInt(e.pointerId),\n            pointerX: x,\n            pointerY: y,\n            pressure: e.pressure * 65535,\n            buttons: e.buttons,\n        });\n    };\n\n    handlePointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\n        this.rendererContainer!.focus();\n        e.preventDefault();\n        e.currentTarget.setPointerCapture(e.pointerId);\n        this.injectTouch(AndroidMotionEventAction.Down, e);\n    };\n\n    handlePointerMove = (e: React.PointerEvent<HTMLDivElement>) => {\n        this.injectTouch(\n            e.buttons === 0 ? AndroidMotionEventAction.HoverMove : AndroidMotionEventAction.Move,\n            e\n        );\n    };\n\n    handlePointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\n        this.injectTouch(AndroidMotionEventAction.Up, e);\n    };\n\n    handleWheel = (e: WheelEvent) => {\n        if (!this.client) {\n            return;\n        }\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        const { x, y } = this.calculatePointerPosition(e.clientX, e.clientY);\n        this.client.injectScroll({\n            pointerX: x,\n            pointerY: y,\n            scrollX: -Math.sign(e.deltaX),\n            scrollY: -Math.sign(e.deltaY),\n            buttons: 0,\n        });\n    };\n\n    handleContextMenu = (e: React.MouseEvent<HTMLDivElement>) => {\n        e.preventDefault();\n    };\n\n    handleKeyDown = async (e: React.KeyboardEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        const { key, code } = e;\n        if (key.match(/^[!-`{-~]$/i)) {\n            this.client!.injectText(key);\n            return;\n        }\n\n        const keyCode = ({\n            Backspace: AndroidKeyCode.Delete,\n            Space: AndroidKeyCode.Space,\n            Enter: AndroidKeyCode.Enter,\n        } as Record<string, AndroidKeyCode | undefined>)[code];\n\n        if (keyCode) {\n            await this.client.injectKeyCode({\n                action: AndroidKeyEventAction.Down,\n                keyCode,\n                metaState: 0,\n                repeat: 0,\n            });\n            await this.client.injectKeyCode({\n                action: AndroidKeyEventAction.Up,\n                keyCode,\n                metaState: 0,\n                repeat: 0,\n            });\n        }\n    };\n}\n\nconst state = new ScrcpyPageState();\nconsole.log(state);\n\nconst ConnectionDialog = observer(() => {\n    const layerHostId = useId('layerHost');\n\n    const [isClient, setIsClient] = useState(false);\n\n    useEffect(() => {\n        setIsClient(true);\n    }, []);\n\n    if (!isClient) {\n        return null;\n    }\n\n    return (\n        <>\n            <LayerHost id={layerHostId} style={{ position: 'absolute', top: 0, bottom: 0, left: 0, right: 0, margin: 0, pointerEvents: 'none' }} />\n\n            <Dialog\n                hidden={!state.connecting}\n                modalProps={{ layerProps: { hostId: layerHostId } }}\n                dialogContentProps={{ title: 'Connecting...' }}\n            >\n                <Stack tokens={CommonStackTokens}>\n                    <ProgressIndicator\n                        label=\"1. Downloading scrcpy server...\"\n                        percentComplete={state.serverTotalSize ? state.serverDownloadedSize / state.serverTotalSize : undefined}\n                        description={formatSpeed(state.debouncedServerDownloadedSize, state.serverTotalSize, state.serverDownloadSpeed)}\n                    />\n\n                    <ProgressIndicator\n                        label=\"2. Pushing scrcpy server to device...\"\n                        progressHidden={state.serverTotalSize === 0 || state.serverDownloadedSize !== state.serverTotalSize}\n                        percentComplete={state.serverUploadedSize / state.serverTotalSize}\n                        description={formatSpeed(state.debouncedServerUploadedSize, state.serverTotalSize, state.serverUploadSpeed)}\n                    />\n\n                    <ProgressIndicator\n                        label=\"3. Starting scrcpy server on device...\"\n                        progressHidden={state.serverTotalSize === 0 || state.serverUploadedSize !== state.serverTotalSize}\n                    />\n                </Stack>\n            </Dialog>\n        </>\n    );\n});\n\nconst NavigationBar = observer(function NavigationBar({\n    className,\n    style,\n    children\n}: {\n    className: string;\n    style: CSSProperties;\n    children: ReactNode;\n    }) {\n    if (!state.navigationBarVisible) {\n        return (\n            <div className={className} style={style}>{children}</div>\n        );\n    }\n\n    return (\n        <Stack className={className} verticalFill horizontalAlign=\"center\" style={{ height: '40px', background: '#999', ...style }}>\n            {children}\n            <Stack verticalFill horizontal style={{ width: '100%', maxWidth: 300 }} horizontalAlign=\"space-evenly\" verticalAlign=\"center\">\n                <IconButton\n                    iconProps={{ iconName: Icons.Play }}\n                    style={{ transform: 'rotate(180deg)', color: 'white' }}\n                    onPointerDown={state.handleBackPointerDown}\n                    onPointerUp={state.handleBackPointerUp}\n                />\n                <IconButton\n                    iconProps={{ iconName: Icons.Circle }}\n                    style={{ color: 'white' }}\n                    onPointerDown={state.handleHomePointerDown}\n                    onPointerUp={state.handleHomePointerUp}\n                />\n                <IconButton\n                    iconProps={{ iconName: Icons.Stop }}\n                    style={{ color: 'white' }}\n                    onPointerDown={state.handleAppSwitchPointerDown}\n                    onPointerUp={state.handleAppSwitchPointerUp}\n                />\n            </Stack>\n        </Stack>\n    );\n});\n\nconst Scrcpy: NextPage = () => {\n    const classes = useClasses();\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Scrcpy - Android Web Toolbox</title>\n            </Head>\n\n            <CommandBar items={state.commandBarItems} farItems={state.commandBarFarItems} />\n\n            <Stack horizontal grow styles={{ root: { height: 0 } }}>\n                <DeviceView\n                    ref={state.handleDeviceViewRef}\n                    width={state.rotatedWidth}\n                    height={state.rotatedHeight}\n                    BottomElement={NavigationBar}\n                >\n                    <div\n                        ref={state.handleRendererContainerRef}\n                        tabIndex={-1}\n                        className={classes.video}\n                        style={{\n                            width: state.width,\n                            height: state.height,\n                            transform: `translate(${(state.rotatedWidth - state.width) / 2}px, ${(state.rotatedHeight - state.height) / 2}px) rotate(${state.rotate * 90}deg)`\n                        }}\n                        onPointerDown={state.handlePointerDown}\n                        onPointerMove={state.handlePointerMove}\n                        onPointerUp={state.handlePointerUp}\n                        onPointerCancel={state.handlePointerUp}\n                        onKeyDown={state.handleKeyDown}\n                        onContextMenu={state.handleContextMenu}\n                    />\n                </DeviceView>\n\n                <div style={{\n                    padding: 12,\n                    overflow: 'hidden auto',\n                    display: state.logVisible ? 'block' : 'none',\n                    width: 500,\n                    fontFamily: 'monospace',\n                    overflowY: 'auto',\n                    whiteSpace: 'pre-wrap',\n                    wordWrap: 'break-word',\n                }}>\n                    {state.log.map((line, index) => (\n                        <div key={index}>\n                            {line}\n                        </div>\n                    ))}\n                </div>\n\n                <div style={{ padding: 12, overflow: 'hidden auto', display: state.settingsVisible ? 'block' : 'none', width: 300 }}>\n                    <div>Changes will take effect on next connection</div>\n\n                    {state.settingDefinitions.map(definition => (\n                        <SettingItem\n                            key={definition.key}\n                            definition={definition}\n                            settings={state.settings}\n                            onChange={action((key, value) => (state.settings as any)[key] = value)}\n                        />\n                    ))}\n                </div>\n\n                <DemoModePanel\n                    style={{ display: state.demoModeVisible ? 'block' : 'none' }}\n                />\n\n                <ConnectionDialog />\n            </Stack>\n        </Stack>\n    );\n};\n\nexport default observer(Scrcpy);\n","import * as React from 'react';\nimport { useUnmount } from '@fluentui/react-hooks';\nimport { css, getId } from '../../Utilities';\nimport { notifyHostChanged, registerLayerHost, unregisterLayerHost } from './Layer.notification';\nimport type { ILayerHost, ILayerHostProps } from './LayerHost.types';\n\nexport const LayerHost: React.FunctionComponent<ILayerHostProps> = props => {\n  const { className } = props;\n\n  const [layerHostId] = React.useState(() => getId());\n\n  const { id: hostId = layerHostId } = props;\n\n  const layerHostRef = React.useRef<ILayerHost>({\n    hostId,\n    rootRef: React.useRef<HTMLDivElement | null>(null),\n    notifyLayersChanged: () => {\n      // Nothing, since the default implementation of Layer Host does not need to react to layer changes.\n    },\n  });\n\n  React.useImperativeHandle(props.componentRef, () => layerHostRef.current);\n\n  React.useEffect(() => {\n    registerLayerHost(hostId, layerHostRef.current);\n    notifyHostChanged(hostId);\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- should only run on first render\n  }, []);\n\n  useUnmount(() => {\n    unregisterLayerHost(hostId, layerHostRef.current);\n    notifyHostChanged(hostId);\n  });\n\n  return <div {...props} className={css('ms-LayerHost', className)} ref={layerHostRef.current.rootRef} />;\n};\n","export default '1.24';","import Struct, { placeholder } from '@yume-chan/struct';\n\n// https://github.com/Genymobile/scrcpy/blob/fa5b2a29e983a46b49531def9cf3d80c40c3de37/app/src/control_msg.h#L23\n// For their message bodies, see https://github.com/Genymobile/scrcpy/blob/5c62f3419d252d10cd8c9cbb7c918b358b81f2d0/app/src/control_msg.c#L92\nexport enum ScrcpyControlMessageType {\n    InjectKeycode,\n    InjectText,\n    InjectTouch,\n    InjectScroll,\n    BackOrScreenOn,\n    ExpandNotificationPanel,\n    ExpandSettingPanel,\n    CollapseNotificationPanel,\n    GetClipboard,\n    SetClipboard,\n    SetScreenPowerMode,\n    RotateDevice,\n}\n\n// https://developer.android.com/reference/android/view/MotionEvent#constants_1\nexport enum AndroidMotionEventAction {\n    Down,\n    Up,\n    Move,\n    Cancel,\n    Outside,\n    PointerDown,\n    PointerUp,\n    HoverMove,\n    Scroll,\n    HoverEnter,\n    HoverExit,\n    ButtonPress,\n    ButtonRelease,\n}\n\nexport const ScrcpySimpleControlMessage =\n    new Struct()\n        .uint8('type');\n\nexport const ScrcpyInjectTouchControlMessage =\n    new Struct()\n        .fields(ScrcpySimpleControlMessage)\n        .uint8('action', placeholder<AndroidMotionEventAction>())\n        .uint64('pointerId')\n        .uint32('pointerX')\n        .uint32('pointerY')\n        .uint16('screenWidth')\n        .uint16('screenHeight')\n        .uint16('pressure')\n        .uint32('buttons');\n\nexport type ScrcpyInjectTouchControlMessage = typeof ScrcpyInjectTouchControlMessage['TInit'];\n\nexport const ScrcpyInjectTextControlMessage =\n    new Struct()\n        .fields(ScrcpySimpleControlMessage)\n        .uint32('length')\n        .string('text', { lengthField: 'length' });\n\nexport type ScrcpyInjectTextControlMessage =\n    typeof ScrcpyInjectTextControlMessage['TInit'];\n\nexport enum AndroidKeyEventAction {\n    Down = 0,\n    Up = 1,\n}\n\nexport enum AndroidKeyCode {\n    Home = 3,\n    Back = 4,\n    A = 29,\n    B,\n    C,\n    D,\n    E,\n    F,\n    G,\n    H,\n    I,\n    J,\n    K,\n    L,\n    M,\n    N,\n    O,\n    P,\n    Q,\n    R,\n    S,\n    T,\n    U,\n    V,\n    W,\n    X,\n    Y,\n    Z,\n    Space = 62,\n    Enter = 66,\n    Delete = 67,\n    AppSwitch = 187,\n}\n\nexport const ScrcpyInjectKeyCodeControlMessage =\n    new Struct()\n        .fields(ScrcpySimpleControlMessage)\n        .uint8('action', placeholder<AndroidKeyEventAction>())\n        .uint32('keyCode')\n        .uint32('repeat')\n        .uint32('metaState');\n\nexport type ScrcpyInjectKeyCodeControlMessage =\n    typeof ScrcpyInjectKeyCodeControlMessage['TInit'];\n","import { AbortController, AdbBufferedStream, AdbSubprocessNoneProtocol, DecodeUtf8Stream, InspectStream, ReadableStream, TransformStream, WritableStream, type Adb, type AdbSocket, type AdbSubprocessProtocol, type WritableStreamDefaultWriter } from '@yume-chan/adb';\nimport { EventEmitter } from '@yume-chan/event';\nimport Struct from '@yume-chan/struct';\nimport { AndroidMotionEventAction, ScrcpyControlMessageType, ScrcpyInjectKeyCodeControlMessage, ScrcpyInjectTextControlMessage, ScrcpyInjectTouchControlMessage, ScrcpySimpleControlMessage, type AndroidKeyEventAction } from './message.js';\nimport type { ScrcpyInjectScrollControlMessage1_22, ScrcpyOptions, VideoStreamPacket } from \"./options/index.js\";\n\nfunction* splitLines(text: string): Generator<string, void, void> {\n    let start = 0;\n\n    while (true) {\n        const index = text.indexOf('\\n', start);\n        if (index === -1) {\n            return;\n        }\n\n        const line = text.substring(start, index);\n        yield line;\n\n        start = index + 1;\n    }\n}\n\nclass SplitLinesStream extends TransformStream<string, string>{\n    constructor() {\n        super({\n            transform(chunk, controller) {\n                for (const line of splitLines(chunk)) {\n                    if (line === '') {\n                        continue;\n                    }\n                    controller.enqueue(line);\n                }\n            },\n        });\n    }\n}\n\nclass ArrayToStream<T> extends ReadableStream<T>{\n    private array!: T[];\n    private index = 0;\n\n    constructor(array: T[]) {\n        super({\n            start: async () => {\n                await Promise.resolve();\n                this.array = array;\n            },\n            pull: (controller) => {\n                if (this.index < this.array.length) {\n                    controller.enqueue(this.array[this.index]!);\n                    this.index += 1;\n                } else {\n                    controller.close();\n                }\n            },\n        });\n    }\n}\n\nclass ConcatStream<T> extends ReadableStream<T>{\n    private streams!: ReadableStream<T>[];\n    private index = 0;\n    private reader!: ReadableStreamDefaultReader<T>;\n\n    constructor(...streams: ReadableStream<T>[]) {\n        super({\n            start: async (controller) => {\n                await Promise.resolve();\n\n                this.streams = streams;\n                this.advance(controller);\n            },\n            pull: async (controller) => {\n                const result = await this.reader.read();\n                if (!result.done) {\n                    controller.enqueue(result.value);\n                    return;\n                }\n                this.advance(controller);\n            }\n        });\n    }\n\n    private advance(controller: ReadableStreamDefaultController<T>) {\n        if (this.index < this.streams.length) {\n            this.reader = this.streams[this.index]!.getReader();\n            this.index += 1;\n        } else {\n            controller.close();\n        }\n    }\n}\n\nconst ClipboardMessage =\n    new Struct()\n        .uint32('length')\n        .string('content', { lengthField: 'length' });\n\nexport class ScrcpyClient {\n    /**\n     * This method will modify the given `options`,\n     * so don't reuse it elsewhere.\n     */\n    public static async getEncoders(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: ScrcpyOptions<any>\n    ): Promise<string[]> {\n        // Provide an invalid encoder name\n        // So the server will return all available encoders\n        options.value.encoderName = '_';\n        // Disable control for faster connection in 1.22+\n        options.value.control = false;\n        options.value.sendDeviceMeta = false;\n        options.value.sendDummyByte = false;\n\n        // Scrcpy server will open connections, before initializing encoder\n        // Thus although an invalid encoder name is given, the start process will success\n        const client = await ScrcpyClient.start(adb, path, version, options);\n\n        const encoderNameRegex = options.getOutputEncoderNameRegex();\n        const encoders: string[] = [];\n        await client.stdout.pipeTo(new WritableStream({\n            write(line) {\n                const match = line.match(encoderNameRegex);\n                if (match) {\n                    encoders.push(match[1]!);\n                }\n            },\n        }));\n\n        return encoders;\n    }\n\n    /**\n     * This method will modify the given `options`,\n     * so don't reuse it elsewhere.\n     */\n    public static async getDisplays(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: ScrcpyOptions<any>\n    ): Promise<number[]> {\n        // Similar to `getEncoders`, pass an invalid option and parse the output\n        options.value.displayId = -1;\n\n        options.value.control = false;\n        options.value.sendDeviceMeta = false;\n        options.value.sendDummyByte = false;\n\n        try {\n            // Server will exit before opening connections when an invalid display id was given.\n            await ScrcpyClient.start(adb, path, version, options);\n        } catch (e) {\n            if (e instanceof Error) {\n                const output = (e as any).output as string[];\n\n                const displayIdRegex = /\\s+scrcpy --display (\\d+)/;\n                const displays: number[] = [];\n                for (const line of output) {\n                    const match = line.match(displayIdRegex);\n                    if (match) {\n                        displays.push(Number.parseInt(match[1]!, 10));\n                    }\n                }\n                return displays;\n            }\n        }\n\n        throw new Error('failed to get displays');\n    }\n\n    public static async start(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: ScrcpyOptions<any>\n    ) {\n        const connection = options.createConnection(adb);\n        let process: AdbSubprocessProtocol | undefined;\n\n        try {\n            await connection.initialize();\n\n            process = await adb.subprocess.spawn(\n                [\n                    // cspell: disable-next-line\n                    `CLASSPATH=${path}`,\n                    'app_process',\n                    /* unused */ '/',\n                    'com.genymobile.scrcpy.Server',\n                    version,\n                    ...options.formatServerArguments(),\n                ],\n                {\n                    // Scrcpy server doesn't split stdout and stderr,\n                    // so disable Shell Protocol to simplify processing\n                    protocols: [AdbSubprocessNoneProtocol],\n                }\n            );\n\n            const stdout = process.stdout\n                .pipeThrough(new DecodeUtf8Stream())\n                .pipeThrough(new SplitLinesStream());\n\n            // Read stdout, otherwise `process.exit` won't resolve.\n            const output: string[] = [];\n            const abortController = new AbortController();\n            const pipe = stdout\n                .pipeTo(new WritableStream({\n                    write(chunk) {\n                        output.push(chunk);\n                    }\n                }), {\n                    signal: abortController.signal,\n                    preventCancel: true,\n                })\n                .catch(() => { });\n\n            const result = await Promise.race([\n                process.exit,\n                connection.getStreams(),\n            ]);\n\n            if (typeof result === 'number') {\n                const error = new Error('scrcpy server exited prematurely');\n                (error as any).output = output;\n                throw error;\n            }\n\n            abortController.abort();\n            await pipe;\n\n            const [videoStream, controlStream] = result;\n            return new ScrcpyClient(\n                adb,\n                options,\n                process,\n                new ConcatStream(\n                    new ArrayToStream(output),\n                    stdout,\n                ),\n                videoStream,\n                controlStream\n            );\n        } catch (e) {\n            await process?.kill();\n            throw e;\n        } finally {\n            connection.dispose();\n        }\n    }\n\n    private _adb: Adb;\n    public get adb() { return this._adb; }\n\n    private options: ScrcpyOptions<any>;\n    private process: AdbSubprocessProtocol;\n\n    private _stdout: ReadableStream<string>;\n    public get stdout() { return this._stdout; }\n\n    public get exit() { return this.process.exit; }\n\n    private _screenWidth: number | undefined;\n    public get screenWidth() { return this._screenWidth; }\n\n    private _screenHeight: number | undefined;\n    public get screenHeight() { return this._screenHeight; }\n\n    private _videoStream: ReadableStream<VideoStreamPacket>;\n    public get videoStream() { return this._videoStream; }\n\n    private _controlStreamWriter: WritableStreamDefaultWriter<Uint8Array> | undefined;\n\n    private readonly clipboardChangeEvent = new EventEmitter<string>();\n    public get onClipboardChange() { return this.clipboardChangeEvent.event; }\n\n    private lastTouchMessage = 0;\n\n    public constructor(\n        adb: Adb,\n        options: ScrcpyOptions<any>,\n        process: AdbSubprocessProtocol,\n        stdout: ReadableStream<string>,\n        videoStream: AdbSocket,\n        controlStream: AdbSocket | undefined,\n    ) {\n        this._adb = adb;\n        this.options = options;\n        this.process = process;\n\n        this._stdout = stdout;\n\n        this._videoStream = videoStream.readable\n            .pipeThrough(options.createVideoStreamTransformer())\n            .pipeThrough(new InspectStream(packet => {\n                if (packet.type === 'configuration') {\n                    this._screenWidth = packet.data.croppedWidth;\n                    this._screenHeight = packet.data.croppedHeight;\n                }\n            }));\n\n        if (controlStream) {\n            const buffered = new AdbBufferedStream(controlStream);\n            this._controlStreamWriter = controlStream.writable.getWriter();\n            (async () => {\n                try {\n                    while (true) {\n                        const type = await buffered.read(1);\n                        switch (type[0]) {\n                            case 0:\n                                const { content } = await ClipboardMessage.deserialize(buffered);\n                                this.clipboardChangeEvent.fire(content!);\n                                break;\n                            default:\n                                throw new Error('unknown control message type');\n                        }\n                    }\n                } catch {\n                    // TODO: Scrcpy: handle error\n                }\n            })();\n        }\n    }\n\n    private checkControlStream(caller: string) {\n        if (!this._controlStreamWriter) {\n            throw new Error(`${caller} called with control disabled`);\n        }\n\n        return this._controlStreamWriter;\n    }\n\n    private getControlMessageTypeValue(type: ScrcpyControlMessageType) {\n        const list = this.options.getControlMessageTypes();\n        const index = list.indexOf(type);\n        if (index === -1) {\n            throw new Error('Not supported');\n        }\n        return index;\n    }\n\n    public async injectKeyCode(message: Omit<ScrcpyInjectKeyCodeControlMessage, 'type'>) {\n        const controlStream = this.checkControlStream('injectKeyCode');\n\n        await controlStream.write(ScrcpyInjectKeyCodeControlMessage.serialize({\n            ...message,\n            type: this.getControlMessageTypeValue(ScrcpyControlMessageType.InjectKeycode),\n        }));\n    }\n\n    public async injectText(text: string) {\n        const controlStream = this.checkControlStream('injectText');\n\n        await controlStream.write(ScrcpyInjectTextControlMessage.serialize({\n            type: this.getControlMessageTypeValue(ScrcpyControlMessageType.InjectText),\n            text,\n        }));\n    }\n\n    public async injectTouch(message: Omit<ScrcpyInjectTouchControlMessage, 'type' | 'screenWidth' | 'screenHeight'>) {\n        const controlStream = this.checkControlStream('injectTouch');\n\n        if (!this.screenWidth || !this.screenHeight) {\n            return;\n        }\n\n        // ADB streams are actually pretty low-bandwidth and laggy\n        // Re-sample move events to avoid flooding the connection\n\n        // TODO: Scrcpy: investigate how to throttle touch events\n        // because 60FPS may still be too high\n        const now = Date.now();\n        if (now - this.lastTouchMessage < 16 &&\n            [AndroidMotionEventAction.Move, AndroidMotionEventAction.HoverMove].includes(message.action)) {\n            return;\n        }\n\n        this.lastTouchMessage = now;\n        await controlStream.write(ScrcpyInjectTouchControlMessage.serialize({\n            ...message,\n            type: this.getControlMessageTypeValue(ScrcpyControlMessageType.InjectTouch),\n            screenWidth: this.screenWidth,\n            screenHeight: this.screenHeight,\n        }));\n    }\n\n    public async injectScroll(message: Omit<ScrcpyInjectScrollControlMessage1_22, 'type' | 'screenWidth' | 'screenHeight'>) {\n        const controlStream = this.checkControlStream('injectScroll');\n\n        if (!this.screenWidth || !this.screenHeight) {\n            return;\n        }\n\n        const buffer = this.options!.serializeInjectScrollControlMessage({\n            ...message,\n            type: this.getControlMessageTypeValue(ScrcpyControlMessageType.InjectScroll),\n            screenWidth: this.screenWidth,\n            screenHeight: this.screenHeight,\n        });\n        await controlStream.write(buffer);\n    }\n\n    public async pressBackOrTurnOnScreen(action: AndroidKeyEventAction) {\n        const controlStream = this.checkControlStream('pressBackOrTurnOnScreen');\n\n        const buffer = this.options!.serializeBackOrScreenOnControlMessage({\n            type: this.getControlMessageTypeValue(ScrcpyControlMessageType.BackOrScreenOn),\n            action,\n        });\n        if (buffer) {\n            await controlStream.write(buffer);\n        }\n    }\n\n    private async sendSimpleControlMessage(type: ScrcpyControlMessageType, name: string) {\n        const controlStream = this.checkControlStream(name);\n        const buffer = ScrcpySimpleControlMessage.serialize({\n            type: this.getControlMessageTypeValue(type),\n        });\n        await controlStream.write(buffer);\n    }\n\n    public async rotateDevice() {\n        await this.sendSimpleControlMessage(ScrcpyControlMessageType.RotateDevice, 'rotateDevice');\n    }\n\n    public async close() {\n        // No need to close streams. Kill the process will destroy them from the other side.\n        await this.process?.kill();\n    }\n}\n","// From https://developer.android.com/reference/android/media/MediaCodecInfo.CodecProfileLevel\nexport enum AndroidCodecProfile {\n    Baseline = 0x01,\n    Main = 0x02,\n    Extended = 0x04,\n    High = 0x08,\n    High10 = 0x10,\n    High422 = 0x20,\n    High444 = 0x40,\n    ConstrainedBaseline = 0x10000,\n    ConstrainedHigh = 0x80000,\n}\n\nexport enum AndroidCodecLevel {\n    Level1 = 0x01,\n    Level1b = 0x02,\n    Level11 = 0x04,\n    Level12 = 0x08,\n    Level13 = 0x10,\n    Level2 = 0x20,\n    Level21 = 0x40,\n    Level22 = 0x80,\n    Level3 = 0x100,\n    Level31 = 0x200,\n    Level32 = 0x400,\n    Level4 = 0x800,\n    Level41 = 0x1000,\n    Level42 = 0x2000,\n    Level5 = 0x4000,\n    Level51 = 0x8000,\n    Level52 = 0x10000,\n    Level6 = 0x20000,\n    Level61 = 0x40000,\n    Level62 = 0x80000,\n}\n","import { PromiseResolver } from '@yume-chan/async';\nimport { AutoDisposable, EventEmitter } from '@yume-chan/event';\n\nlet worker: Worker | undefined;\nlet workerReady = false;\nconst pendingResolvers: PromiseResolver<TinyH264Wrapper>[] = [];\nlet streamId = 0;\n\nexport interface PictureReadyEventArgs {\n    renderStateId: number;\n\n    width: number;\n\n    height: number;\n\n    data: ArrayBuffer;\n}\n\nconst pictureReadyEvent = new EventEmitter<PictureReadyEventArgs>();\n\nexport class TinyH264Wrapper extends AutoDisposable {\n    public readonly streamId: number;\n\n    private readonly pictureReadyEvent = new EventEmitter<PictureReadyEventArgs>();\n    public get onPictureReady() { return this.pictureReadyEvent.event; }\n\n    public constructor(streamId: number) {\n        super();\n\n        this.streamId = streamId;\n        this.addDisposable(pictureReadyEvent.event(this.handlePictureReady, this));\n    }\n\n    private handlePictureReady(e: PictureReadyEventArgs) {\n        if (e.renderStateId === this.streamId) {\n            this.pictureReadyEvent.fire(e);\n        }\n    }\n\n    public feed(data: ArrayBuffer) {\n        worker!.postMessage({\n            type: 'decode',\n            data: data,\n            offset: 0,\n            length: data.byteLength,\n            renderStateId: this.streamId,\n        }, [data]);\n    }\n\n    public override dispose() {\n        super.dispose();\n        worker!.postMessage({\n            type: 'release',\n            renderStateId: this.streamId,\n        });\n    }\n}\n\nexport function createTinyH264Wrapper(): Promise<TinyH264Wrapper> {\n    if (!worker) {\n        worker = new Worker(new URL('./worker.js', import.meta.url));\n        worker.addEventListener('message', (e) => {\n            const { data } = e;\n            switch (data.type) {\n                case 'decoderReady':\n                    workerReady = true;\n                    for (const resolver of pendingResolvers) {\n                        resolver.resolve(new TinyH264Wrapper(streamId));\n                        streamId += 1;\n                    }\n                    pendingResolvers.length = 0;\n                    break;\n                case 'pictureReady':\n                    pictureReadyEvent.fire(data);\n                    break;\n            }\n        });\n    }\n\n    if (!workerReady) {\n        const resolver = new PromiseResolver<TinyH264Wrapper>();\n        pendingResolvers.push(resolver);\n        return resolver.promise;\n    }\n\n    const decoder = new TinyH264Wrapper(streamId);\n    streamId += 1;\n    return Promise.resolve(decoder);\n}\n","import { WritableStream } from \"@yume-chan/adb\";\nimport { PromiseResolver } from \"@yume-chan/async\";\nimport { AndroidCodecLevel, AndroidCodecProfile } from \"../../codec.js\";\nimport type { VideoStreamPacket } from \"../../options/index.js\";\nimport type { H264Configuration, H264Decoder } from \"../types.js\";\nimport { createTinyH264Wrapper, type TinyH264Wrapper } from \"./wrapper.js\";\n\nlet cachedInitializePromise: Promise<{ YuvBuffer: typeof import('yuv-buffer'), YuvCanvas: typeof import('yuv-canvas').default; }> | undefined;\nfunction initialize() {\n    if (!cachedInitializePromise) {\n        cachedInitializePromise = Promise.all(\n            [import('yuv-buffer'), import('yuv-canvas')]\n        ).then(([YuvBuffer, { default: YuvCanvas }]) => ({\n            YuvBuffer, YuvCanvas\n        }));\n    }\n\n    return cachedInitializePromise;\n}\n\nexport class TinyH264Decoder implements H264Decoder {\n    public readonly maxProfile = AndroidCodecProfile.Baseline;\n\n    public readonly maxLevel = AndroidCodecLevel.Level4;\n\n    private _renderer: HTMLCanvasElement;\n    public get renderer() { return this._renderer; }\n\n    private _frameRendered = 0;\n    public get frameRendered() { return this._frameRendered; }\n\n    private _writable: WritableStream<VideoStreamPacket>;\n    public get writable() { return this._writable; }\n\n    private _yuvCanvas: import('yuv-canvas').default | undefined;\n    private _initializer: PromiseResolver<TinyH264Wrapper> | undefined;\n\n    public constructor() {\n        initialize();\n\n        this._renderer = document.createElement('canvas');\n\n        this._writable = new WritableStream<VideoStreamPacket>({\n            write: async (packet) => {\n                switch (packet.type) {\n                    case 'configuration':\n                        this.configure(packet.data);\n                        break;\n                    case 'frame':\n                        if (!this._initializer) {\n                            throw new Error('Decoder not initialized');\n                        }\n\n                        const wrapper = await this._initializer.promise;\n                        wrapper.feed(packet.data.slice().buffer);\n                        break;\n                }\n            }\n        });\n    }\n\n    private async configure(config: H264Configuration) {\n        this.dispose();\n\n        this._initializer = new PromiseResolver<TinyH264Wrapper>();\n        const { YuvBuffer, YuvCanvas } = await initialize();\n\n        if (!this._yuvCanvas) {\n            this._yuvCanvas = YuvCanvas.attach(this._renderer);;\n        }\n\n        const { encodedWidth, encodedHeight } = config;\n        const chromaWidth = encodedWidth / 2;\n        const chromaHeight = encodedHeight / 2;\n\n        this._renderer.width = config.croppedWidth;\n        this._renderer.height = config.croppedHeight;\n        const format = YuvBuffer.format({\n            width: encodedWidth,\n            height: encodedHeight,\n            chromaWidth,\n            chromaHeight,\n            cropLeft: config.cropLeft,\n            cropTop: config.cropTop,\n            cropWidth: config.croppedWidth,\n            cropHeight: config.croppedHeight,\n            displayWidth: config.croppedWidth,\n            displayHeight: config.croppedHeight,\n        });\n\n        const wrapper = await createTinyH264Wrapper();\n        this._initializer.resolve(wrapper);\n\n        const uPlaneOffset = encodedWidth * encodedHeight;\n        const vPlaneOffset = uPlaneOffset + chromaWidth * chromaHeight;\n        wrapper.onPictureReady(({ data }) => {\n            this._frameRendered += 1;\n            const array = new Uint8Array(data);\n            const frame = YuvBuffer.frame(format,\n                YuvBuffer.lumaPlane(format, array, encodedWidth, 0),\n                YuvBuffer.chromaPlane(format, array, chromaWidth, uPlaneOffset),\n                YuvBuffer.chromaPlane(format, array, chromaWidth, vPlaneOffset)\n            );\n            this._yuvCanvas!.drawFrame(frame);\n        });\n    }\n\n    public dispose(): void {\n        this._initializer?.promise.then(wrapper => wrapper.dispose());\n        this._initializer = undefined;\n    }\n}\n","import { WritableStream } from '@yume-chan/adb';\nimport type { VideoStreamPacket } from \"../../options/index.js\";\nimport type { H264Configuration, H264Decoder } from \"../types.js\";\n\nfunction toHex(value: number) {\n    return value.toString(16).padStart(2, '0').toUpperCase();\n}\n\nexport class WebCodecsDecoder implements H264Decoder {\n    // Usually, browsers can decode most configurations,\n    // So let device choose best profile and level for itself.\n    public readonly maxProfile = undefined;\n    public readonly maxLevel = undefined;\n\n    private _writable: WritableStream<VideoStreamPacket>;\n    public get writable() { return this._writable; }\n\n    private _renderer: HTMLCanvasElement;\n    public get renderer() { return this._renderer; }\n\n    private _frameRendered = 0;\n    public get frameRendered() { return this._frameRendered; }\n\n    private context: CanvasRenderingContext2D;\n    private decoder: VideoDecoder;\n\n    // Limit FPS to system refresh rate\n    private lastFrame: VideoFrame | undefined;\n    private animationFrame: number = 0;\n\n    public constructor() {\n        this._renderer = document.createElement('canvas');\n\n        this.context = this._renderer.getContext('2d')!;\n        this.decoder = new VideoDecoder({\n            output: (frame) => {\n                if (this.lastFrame) {\n                    this.lastFrame.close();\n                }\n                this.lastFrame = frame;\n\n                if (!this.animationFrame) {\n                    // Start render loop on first frame\n                    this.render();\n                }\n            },\n            error() { },\n        });\n\n        this._writable = new WritableStream<VideoStreamPacket>({\n            write: async (packet) => {\n                switch (packet.type) {\n                    case 'configuration':\n                        this.configure(packet.data);\n                        break;\n                    case 'frame':\n                        this.decoder.decode(new EncodedVideoChunk({\n                            // Treat `undefined` as `key`, otherwise won't decode.\n                            type: packet.keyframe === false ? 'delta' : 'key',\n                            timestamp: 0,\n                            data: packet.data,\n                        }));\n                        break;\n                }\n            }\n        });\n    }\n\n    private render = () => {\n        if (this.lastFrame) {\n            this._frameRendered += 1;\n            this.context.drawImage(this.lastFrame, 0, 0);\n            this.lastFrame.close();\n            this.lastFrame = undefined;\n        }\n\n        this.animationFrame = requestAnimationFrame(this.render);\n    };\n\n    private configure(config: H264Configuration) {\n        const { profileIndex, constraintSet, levelIndex } = config;\n\n        this._renderer.width = config.croppedWidth;\n        this._renderer.height = config.croppedHeight;\n\n        // https://www.rfc-editor.org/rfc/rfc6381#section-3.3\n        // ISO Base Media File Format Name Space\n        const codec = `avc1.${[profileIndex, constraintSet, levelIndex].map(toHex).join('')}`;\n        this.decoder.configure({\n            codec: codec,\n            optimizeForLatency: true,\n        });\n    }\n\n    public dispose() {\n        cancelAnimationFrame(this.animationFrame);\n        this.decoder.close();\n    }\n}\n","export function delay(time: number): Promise<void> {\n    return new Promise(resolve => {\n        (globalThis as any).setTimeout(resolve, time);\n    });\n}\n","import type { Adb, AdbSocket } from \"@yume-chan/adb\";\nimport type { Disposable } from \"@yume-chan/event\";\nimport type { ValueOrPromise } from \"@yume-chan/struct\";\nimport { delay } from \"./utils.js\";\n\nexport interface ScrcpyClientConnectionOptions {\n    control: boolean;\n\n    /**\n     * Write a byte on start to detect connection issues\n     */\n    sendDummyByte: boolean;\n\n    /**\n     * Send device name and size\n     */\n    sendDeviceMeta: boolean;\n}\n\nexport abstract class ScrcpyClientConnection implements Disposable {\n    protected device: Adb;\n\n    protected options: ScrcpyClientConnectionOptions;\n\n    public constructor(device: Adb, options: ScrcpyClientConnectionOptions) {\n        this.device = device;\n        this.options = options;\n    }\n\n    public initialize(): ValueOrPromise<void> { }\n\n    public abstract getStreams(): ValueOrPromise<[videoSteam: AdbSocket, controlStream: AdbSocket | undefined]>;\n\n    public dispose(): void { }\n}\n\nexport class ScrcpyClientForwardConnection extends ScrcpyClientConnection {\n    private async connect(): Promise<AdbSocket> {\n        return await this.device.createSocket('localabstract:scrcpy');\n    }\n\n    private async connectAndRetry(): Promise<AdbSocket> {\n        for (let i = 0; i < 100; i++) {\n            try {\n                return await this.connect();\n            } catch (e) {\n                await delay(100);\n            }\n        }\n        throw new Error(`Can't connect to server after 100 retries`);\n    }\n\n    private async connectVideoStream(): Promise<AdbSocket> {\n        const stream = await this.connectAndRetry();\n        if (this.options.sendDummyByte) {\n            const reader = stream.readable.getReader();\n            const { done, value } = await reader.read();\n            // server will write a `0` to signal connection success\n            if (done || value.byteLength !== 1 || value[0] !== 0) {\n                throw new Error('Unexpected response from server');\n            }\n            reader.releaseLock();\n        }\n        return stream;\n    }\n\n    public async getStreams(): Promise<[videoSteam: AdbSocket, controlStream: AdbSocket | undefined]> {\n        const videoStream = await this.connectVideoStream();\n\n        let controlStream: AdbSocket | undefined;\n        if (this.options.control) {\n            controlStream = await this.connectAndRetry();\n        }\n\n        // Server only writes device meta after control socket is connected (if enabled)\n        if (this.options.sendDeviceMeta) {\n            const reader = videoStream.readable.getReader();\n            const { done, value } = await reader.read();\n            // 64 bytes device name + 2 bytes video width + 2 bytes video height\n            if (done || value.byteLength !== 64 + 2 + 2) {\n                throw new Error('Unexpected response from server');\n            }\n            reader.releaseLock();\n        }\n\n        return [videoStream, controlStream];\n    }\n}\n\nexport class ScrcpyClientReverseConnection extends ScrcpyClientConnection {\n    private streams!: ReadableStreamDefaultReader<AdbSocket>;\n\n    private address!: string;\n\n    public override async initialize(): Promise<void> {\n        try {\n            // try to unbind first\n            await this.device.reverse.remove('localabstract:scrcpy');\n        } catch {\n            // ignore error\n        }\n\n        const queue = new TransformStream<AdbSocket>();\n        this.streams = queue.readable.getReader();\n        const writer = queue.writable.getWriter();\n        this.address = await this.device.reverse.add(\n            'localabstract:scrcpy',\n            'tcp:27183',\n            socket => {\n                writer.write(socket);\n                return true;\n            },\n        );\n    }\n\n    private async accept(): Promise<AdbSocket> {\n        return (await this.streams.read()).value!;\n    }\n\n    public async getStreams(): Promise<[videoSteam: AdbSocket, controlStream: AdbSocket | undefined]> {\n        const videoStream = await this.accept();\n\n        let controlStream: AdbSocket | undefined;\n        if (this.options.control) {\n            controlStream = await this.accept();\n        }\n\n        // Server only writes device meta after control socket is connected (if enabled)\n        if (this.options.sendDeviceMeta) {\n            const reader = videoStream.readable.getReader();\n            const { done, value } = await reader.read();\n            // 64 bytes device name + 2 bytes video width + 2 bytes video height\n            if (done || value.byteLength !== 64 + 2 + 2) {\n                throw new Error('Unexpected response from server');\n            }\n            reader.releaseLock();\n        }\n\n        return [videoStream, controlStream];\n    }\n\n    public override dispose() {\n        // Don't await this!\n        // `reverse.remove`'s response will never arrive\n        // before we read all pending data from `videoStream`\n        this.device.reverse.remove(this.address);\n    }\n}\n","import type { Adb, TransformStream } from \"@yume-chan/adb\";\nimport type { ScrcpyClientConnection } from \"../connection.js\";\nimport type { H264Configuration } from \"../decoder/index.js\";\nimport type { ScrcpyControlMessageType } from \"../message.js\";\nimport type { ScrcpyBackOrScreenOnEvent1_18 } from \"./1_18.js\";\nimport type { ScrcpyInjectScrollControlMessage1_22 } from \"./1_22.js\";\n\nexport const DEFAULT_SERVER_PATH = '/data/local/tmp/scrcpy-server.jar';\n\nexport interface ScrcpyOptionValue {\n    toOptionValue(): string | undefined;\n}\n\nexport function isScrcpyOptionValue(value: any): value is ScrcpyOptionValue {\n    return typeof value === 'object' &&\n        value !== null &&\n        typeof value.toOptionValue === 'function';\n}\n\nexport function toScrcpyOptionValue<T>(value: any, empty: T): string | T {\n    if (isScrcpyOptionValue(value)) {\n        value = value.toOptionValue();\n    }\n\n    if (value === undefined) {\n        return empty;\n    }\n\n    return `${value}`;\n}\n\nexport interface VideoStreamConfigurationPacket {\n    type: 'configuration';\n    data: H264Configuration;\n}\n\nexport interface VideoStreamFramePacket {\n    type: 'frame';\n    keyframe?: boolean | undefined;\n    pts?: bigint | undefined;\n    data: Uint8Array;\n}\n\nexport type VideoStreamPacket = VideoStreamConfigurationPacket | VideoStreamFramePacket;\n\nexport interface ScrcpyOptions<T> {\n    value: Partial<T>;\n\n    formatServerArguments(): string[];\n\n    getOutputEncoderNameRegex(): RegExp;\n\n    createConnection(adb: Adb): ScrcpyClientConnection;\n\n    createVideoStreamTransformer(): TransformStream<Uint8Array, VideoStreamPacket>;\n\n    getControlMessageTypes(): ScrcpyControlMessageType[];\n\n    serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnEvent1_18,\n    ): Uint8Array | undefined;\n\n    serializeInjectScrollControlMessage(\n        message: ScrcpyInjectScrollControlMessage1_22,\n    ): Uint8Array;\n}\n","// cspell: ignore golomb\n// cspell: ignore qpprime\n\nclass BitReader {\n    private buffer: Uint8Array;\n\n    private bytePosition = 0;\n\n    private bitPosition = 0;\n\n    public constructor(buffer: Uint8Array) {\n        this.buffer = buffer;\n    }\n\n    public read(length: number): number {\n        let result = 0;\n        for (let i = 0; i < length; i += 1) {\n            result = (result << 1) | this.next();\n        }\n        return result;\n    }\n\n    public next(): number {\n        const value = (this.buffer[this.bytePosition]! >> (7 - this.bitPosition)) & 1;\n        this.bitPosition += 1;\n        if (this.bitPosition === 8) {\n            this.bytePosition += 1;\n            this.bitPosition = 0;\n        }\n        return value;\n    }\n\n    public decodeExponentialGolombNumber(): number {\n        let length = 0;\n        while (this.next() === 0) {\n            length += 1;\n        }\n        if (length === 0) {\n            return 0;\n        }\n        return (1 << length | this.read(length)) - 1;\n    }\n}\n\nfunction* iterateNalu(buffer: Uint8Array): Generator<Uint8Array> {\n    // -1 means we haven't found the first start code\n    let start = -1;\n    let writeIndex = 0;\n\n    // How many `0x00`s in a row we have counted\n    let zeroCount = 0;\n\n    let inEmulation = false;\n\n    for (const byte of buffer) {\n        buffer[writeIndex] = byte;\n        writeIndex += 1;\n\n        if (inEmulation) {\n            if (byte > 0x03) {\n                // `0x00000304` or larger are invalid\n                throw new Error('Invalid data');\n            }\n\n            inEmulation = false;\n            continue;\n        }\n\n        if (byte == 0x00) {\n            zeroCount += 1;\n            continue;\n        }\n\n        const lastZeroCount = zeroCount;\n        zeroCount = 0;\n\n        if (start === -1) {\n            // 0x000001 is the start code\n            // But it can be preceded by any number of zeros\n            // So 2 is the minimal\n            if (lastZeroCount >= 2 && byte === 0x01) {\n                // Found start of first NAL unit\n                writeIndex = 0;\n                start = 0;\n                continue;\n            }\n\n            // Not begin with start code\n            throw new Error('Invalid data');\n        }\n\n        if (lastZeroCount < 2) {\n            // zero or one `0x00`s are acceptable\n            continue;\n        }\n\n        if (byte === 0x01) {\n            // Remove all leading `0x00`s and this `0x01`\n            writeIndex -= lastZeroCount + 1;\n\n            // Found another NAL unit\n            yield buffer.subarray(start, writeIndex);\n\n            start = writeIndex;\n            continue;\n        }\n\n        if (lastZeroCount > 2) {\n            // Too much `0x00`s\n            throw new Error('Invalid data');\n        }\n\n        switch (byte) {\n            case 0x02:\n                // Didn't find why, but 7.4.1 NAL unit semantics forbids `0x000002` appearing in NAL units\n                throw new Error('Invalid data');\n            case 0x03:\n                // `0x000003` is the \"emulation_prevention_three_byte\"\n                // `0x00000300`, `0x00000301`, `0x00000302` and `0x00000303` represent\n                // `0x000000`, `0x000001`, `0x000002` and `0x000003` respectively\n\n                // Remove current byte\n                writeIndex -= 1;\n\n                inEmulation = true;\n                break;\n            default:\n                // `0x000004` or larger are ok\n                break;\n        }\n    }\n\n    if (inEmulation || zeroCount !== 0) {\n        throw new Error('Invalid data');\n    }\n\n    yield buffer.subarray(start, writeIndex);\n}\n\n// 7.3.2.1.1 Sequence parameter set data syntax\nexport function parse_sequence_parameter_set(buffer: ArrayBuffer) {\n    for (const nalu of iterateNalu(new Uint8Array(buffer))) {\n        const reader = new BitReader(nalu);\n        if (reader.next() !== 0) {\n            throw new Error('Invalid data');\n        }\n\n        const nal_ref_idc = reader.read(2);\n        const nal_unit_type = reader.read(5);\n\n        if (nal_unit_type !== 7) {\n            continue;\n        }\n\n        if (nal_ref_idc === 0) {\n            throw new Error('Invalid data');\n        }\n\n        const profile_idc = reader.read(8);\n        const constraint_set = reader.read(8);\n\n        const constraint_set_reader = new BitReader(new Uint8Array([constraint_set]));\n        const constraint_set0_flag = !!constraint_set_reader.next();\n        const constraint_set1_flag = !!constraint_set_reader.next();\n        const constraint_set2_flag = !!constraint_set_reader.next();\n        const constraint_set3_flag = !!constraint_set_reader.next();\n        const constraint_set4_flag = !!constraint_set_reader.next();\n        const constraint_set5_flag = !!constraint_set_reader.next();\n\n        // reserved_zero_2bits\n        if (constraint_set_reader.read(2) !== 0) {\n            throw new Error('Invalid data');\n        }\n\n        const level_idc = reader.read(8);\n        const seq_parameter_set_id = reader.decodeExponentialGolombNumber();\n\n        if (profile_idc === 100 || profile_idc === 110 ||\n            profile_idc === 122 || profile_idc === 244 || profile_idc === 44 ||\n            profile_idc === 83 || profile_idc === 86 || profile_idc === 118 ||\n            profile_idc === 128 || profile_idc === 138 || profile_idc === 139 ||\n            profile_idc === 134) {\n            const chroma_format_idc = reader.decodeExponentialGolombNumber();\n            if (chroma_format_idc === 3) {\n                // separate_colour_plane_flag\n                reader.next();\n            }\n\n            // bit_depth_luma_minus8\n            reader.decodeExponentialGolombNumber();\n            // bit_depth_chroma_minus8\n            reader.decodeExponentialGolombNumber();\n\n            // qpprime_y_zero_transform_bypass_flag\n            reader.next();\n\n            const seq_scaling_matrix_present_flag = !!reader.next();\n            if (seq_scaling_matrix_present_flag) {\n                const seq_scaling_list_present_flag: boolean[] = [];\n                for (let i = 0; i < ((chroma_format_idc !== 3) ? 8 : 12); i++) {\n                    seq_scaling_list_present_flag[i] = !!reader.next();\n                    if (seq_scaling_list_present_flag[i])\n                        if (i < 6) {\n                            // TODO\n                            // scaling_list( ScalingList4x4[ i ], 16,\n                            //               UseDefaultScalingMatrix4x4Flag[ i ])\n                        } else {\n                            // TODO\n                            // scaling_list( ScalingList8x8[ i  6 ], 64,\n                            //               UseDefaultScalingMatrix8x8Flag[ i  6 ] )\n                        }\n                }\n            }\n        }\n\n        // log2_max_frame_num_minus4\n        reader.decodeExponentialGolombNumber();\n        const pic_order_cnt_type = reader.decodeExponentialGolombNumber();\n        if (pic_order_cnt_type === 0) {\n            // log2_max_pic_order_cnt_lsb_minus4\n            reader.decodeExponentialGolombNumber();\n        } else if (pic_order_cnt_type === 1) {\n            // delta_pic_order_always_zero_flag\n            reader.next();\n            // offset_for_non_ref_pic\n            reader.decodeExponentialGolombNumber();\n            // offset_for_top_to_bottom_field\n            reader.decodeExponentialGolombNumber();\n            const num_ref_frames_in_pic_order_cnt_cycle = reader.decodeExponentialGolombNumber();\n            const offset_for_ref_frame: number[] = [];\n            for (let i = 0; i < num_ref_frames_in_pic_order_cnt_cycle; i++) {\n                offset_for_ref_frame[i] = reader.decodeExponentialGolombNumber();\n            }\n        }\n\n        // max_num_ref_frames\n        reader.decodeExponentialGolombNumber();\n        // gaps_in_frame_num_value_allowed_flag\n        reader.next();\n        const pic_width_in_mbs_minus1 = reader.decodeExponentialGolombNumber();\n        const pic_height_in_map_units_minus1 = reader.decodeExponentialGolombNumber();\n\n        const frame_mbs_only_flag = reader.next();\n        if (!frame_mbs_only_flag) {\n            // mb_adaptive_frame_field_flag\n            reader.next();\n        }\n\n        // direct_8x8_inference_flag\n        reader.next();\n\n        const frame_cropping_flag = !!reader.next();\n        let frame_crop_left_offset: number;\n        let frame_crop_right_offset: number;\n        let frame_crop_top_offset: number;\n        let frame_crop_bottom_offset: number;\n        if (frame_cropping_flag) {\n            frame_crop_left_offset = reader.decodeExponentialGolombNumber();\n            frame_crop_right_offset = reader.decodeExponentialGolombNumber();\n            frame_crop_top_offset = reader.decodeExponentialGolombNumber();\n            frame_crop_bottom_offset = reader.decodeExponentialGolombNumber();\n        } else {\n            frame_crop_left_offset = 0;\n            frame_crop_right_offset = 0;\n            frame_crop_top_offset = 0;\n            frame_crop_bottom_offset = 0;\n        }\n\n        const vui_parameters_present_flag = !!reader.next();\n        if (vui_parameters_present_flag) {\n            // TODO\n            // vui_parameters( )\n        }\n\n        return {\n            profile_idc,\n            constraint_set,\n            constraint_set0_flag,\n            constraint_set1_flag,\n            constraint_set2_flag,\n            constraint_set3_flag,\n            constraint_set4_flag,\n            constraint_set5_flag,\n            level_idc,\n            seq_parameter_set_id,\n            pic_width_in_mbs_minus1,\n            pic_height_in_map_units_minus1,\n            frame_mbs_only_flag,\n            frame_cropping_flag,\n            frame_crop_left_offset,\n            frame_crop_right_offset,\n            frame_crop_top_offset,\n            frame_crop_bottom_offset,\n        };\n    }\n\n    throw new Error('Invalid data');\n}\n\nexport type SequenceParameterSet = ReturnType<typeof parse_sequence_parameter_set>;\n","import { StructDeserializeStream, TransformStream, type Adb } from \"@yume-chan/adb\";\r\nimport Struct from \"@yume-chan/struct\";\r\nimport type { AndroidCodecLevel, AndroidCodecProfile } from \"../../codec.js\";\r\nimport { ScrcpyClientConnection, ScrcpyClientForwardConnection, ScrcpyClientReverseConnection, type ScrcpyClientConnectionOptions } from \"../../connection.js\";\r\nimport { AndroidKeyEventAction, ScrcpyControlMessageType, ScrcpySimpleControlMessage } from \"../../message.js\";\r\nimport type { ScrcpyBackOrScreenOnEvent1_18 } from \"../1_18.js\";\r\nimport type { ScrcpyInjectScrollControlMessage1_22 } from \"../1_22.js\";\r\nimport { toScrcpyOptionValue, type ScrcpyOptions, type ScrcpyOptionValue, type VideoStreamPacket } from \"../common.js\";\r\nimport { parse_sequence_parameter_set } from \"./sps.js\";\r\n\r\nexport enum ScrcpyLogLevel {\r\n    Verbose = 'verbose',\r\n    Debug = 'debug',\r\n    Info = 'info',\r\n    Warn = 'warn',\r\n    Error = 'error',\r\n}\r\n\r\nexport enum ScrcpyVideoOrientation {\r\n    Initial = -2,\r\n    Unlocked = -1,\r\n    Portrait = 0,\r\n    Landscape = 1,\r\n    PortraitFlipped = 2,\r\n    LandscapeFlipped = 3,\r\n}\r\n\r\nexport interface CodecOptionsInit {\r\n    profile: AndroidCodecProfile;\r\n    level: AndroidCodecLevel;\r\n\r\n    iFrameInterval: number;\r\n    repeatPreviousFrameAfter: number;\r\n    maxPtsGapToEncoder: number;\r\n}\r\n\r\nfunction toDashCase(input: string) {\r\n    return input.replace(/([A-Z])/g, '-$1').toLowerCase();\r\n}\r\n\r\nconst CODEC_OPTION_TYPES: Partial<Record<keyof CodecOptionsInit, 'long' | 'float' | 'string'>> = {\r\n    repeatPreviousFrameAfter: 'long',\r\n    maxPtsGapToEncoder: 'long',\r\n};\r\n\r\nexport class CodecOptions implements ScrcpyOptionValue {\r\n    public value: Partial<CodecOptionsInit>;\r\n\r\n    public constructor(value: Partial<CodecOptionsInit>) {\r\n        this.value = value;\r\n    }\r\n\r\n    public toOptionValue(): string | undefined {\r\n        const entries = Object.entries(this.value)\r\n            .filter(([key, value]) => value !== undefined);\r\n\r\n        if (entries.length === 0) {\r\n            return undefined;\r\n        }\r\n\r\n        return entries\r\n            .map(([key, value]) => {\r\n                const type = CODEC_OPTION_TYPES[key as keyof CodecOptionsInit];\r\n                return `${toDashCase(key)}${type ? `:${type}` : ''}=${value}`;\r\n            })\r\n            .join(',');\r\n    }\r\n}\r\n\r\nexport interface ScrcpyOptionsInit1_16 {\r\n    logLevel: ScrcpyLogLevel;\r\n\r\n    /**\r\n     * The maximum value of both width and height.\r\n     */\r\n    maxSize: number;\r\n\r\n    bitRate: number;\r\n\r\n    /**\r\n     * 0 for unlimited.\r\n     *\r\n     * @default 0\r\n     */\r\n    maxFps: number;\r\n\r\n    /**\r\n     * The orientation of the video stream.\r\n     *\r\n     * It will not keep the device screen in specific orientation,\r\n     * only the captured video will in this orientation.\r\n     */\r\n    lockVideoOrientation: ScrcpyVideoOrientation;\r\n\r\n    tunnelForward: boolean;\r\n\r\n    crop: string;\r\n\r\n    /**\r\n     * Send PTS so that the client may record properly\r\n     *\r\n     * Note: When `sendFrameMeta: false` is specified,\r\n     * `onChangeEncoding` event won't fire and `onVideoData` event doesn't\r\n     * merge sps/pps frame and first video frame. Which means you can't use\r\n     * the shipped decoders to render the video\r\n     * (You can still record the stream into a file).\r\n     *\r\n     * @default true\r\n     */\r\n    sendFrameMeta: boolean;\r\n\r\n    /**\r\n     * @default true\r\n     */\r\n    control: boolean;\r\n\r\n    displayId: number;\r\n\r\n    showTouches: boolean;\r\n\r\n    stayAwake: boolean;\r\n\r\n    codecOptions: CodecOptions;\r\n\r\n    encoderName: string;\r\n}\r\n\r\nexport const VideoPacket =\r\n    new Struct()\r\n        .uint64('pts')\r\n        .uint32('size')\r\n        .uint8Array('data', { lengthField: 'size' });\r\n\r\nexport const NO_PTS = BigInt(1) << BigInt(63);\r\n\r\nexport const ScrcpyBackOrScreenOnEvent1_16 =\r\n    ScrcpySimpleControlMessage;\r\n\r\nexport const ScrcpyInjectScrollControlMessage1_16 =\r\n    new Struct()\r\n        .fields(ScrcpySimpleControlMessage)\r\n        .uint32('pointerX')\r\n        .uint32('pointerY')\r\n        .uint16('screenWidth')\r\n        .uint16('screenHeight')\r\n        .int32('scrollX')\r\n        .int32('scrollY');\r\n\r\nexport class ScrcpyOptions1_16<T extends ScrcpyOptionsInit1_16 = ScrcpyOptionsInit1_16> implements ScrcpyOptions<T> {\r\n    public value: Partial<T>;\r\n\r\n    public constructor(value: Partial<ScrcpyOptionsInit1_16>) {\r\n        if (new.target === ScrcpyOptions1_16 &&\r\n            value.logLevel === ScrcpyLogLevel.Verbose) {\r\n            value.logLevel = ScrcpyLogLevel.Debug;\r\n        }\r\n\r\n        if (new.target === ScrcpyOptions1_16 &&\r\n            value.lockVideoOrientation === ScrcpyVideoOrientation.Initial) {\r\n            value.lockVideoOrientation = ScrcpyVideoOrientation.Unlocked;\r\n        }\r\n\r\n        this.value = value as Partial<T>;\r\n    }\r\n\r\n    protected getArgumentOrder(): (keyof T)[] {\r\n        return [\r\n            'logLevel',\r\n            'maxSize',\r\n            'bitRate',\r\n            'maxFps',\r\n            'lockVideoOrientation',\r\n            'tunnelForward',\r\n            'crop',\r\n            'sendFrameMeta',\r\n            'control',\r\n            'displayId',\r\n            'showTouches',\r\n            'stayAwake',\r\n            'codecOptions',\r\n            'encoderName',\r\n        ];\r\n    }\r\n\r\n    protected getDefaultValue(): T {\r\n        return {\r\n            logLevel: ScrcpyLogLevel.Debug,\r\n            maxSize: 0,\r\n            bitRate: 8_000_000,\r\n            maxFps: 0,\r\n            lockVideoOrientation: ScrcpyVideoOrientation.Unlocked,\r\n            tunnelForward: false,\r\n            crop: '-',\r\n            sendFrameMeta: true,\r\n            control: true,\r\n            displayId: 0,\r\n            showTouches: false,\r\n            stayAwake: false,\r\n            codecOptions: new CodecOptions({}),\r\n            encoderName: '-',\r\n        } as T;\r\n    }\r\n\r\n    public formatServerArguments(): string[] {\r\n        const defaults = this.getDefaultValue();\r\n        return this.getArgumentOrder()\r\n            .map(key => toScrcpyOptionValue(this.value[key] || defaults[key], '-'));\r\n    }\r\n\r\n    public createConnection(adb: Adb): ScrcpyClientConnection {\r\n        const options: ScrcpyClientConnectionOptions = {\r\n            // Old scrcpy connection always have control stream no matter what the option is\r\n            control: true,\r\n            sendDummyByte: true,\r\n            sendDeviceMeta: true,\r\n        };\r\n        if (this.value.tunnelForward) {\r\n            return new ScrcpyClientForwardConnection(adb, options);\r\n        } else {\r\n            return new ScrcpyClientReverseConnection(adb, options);\r\n        }\r\n    }\r\n\r\n    public getOutputEncoderNameRegex(): RegExp {\r\n        return /\\s+scrcpy --encoder-name '(.*?)'/;\r\n    }\r\n\r\n    public createVideoStreamTransformer(): TransformStream<Uint8Array, VideoStreamPacket> {\r\n        // Optimized path for video frames only\r\n        if (this.value.sendFrameMeta === false) {\r\n            return new TransformStream({\r\n                transform(chunk, controller) {\r\n                    controller.enqueue({\r\n                        type: 'frame',\r\n                        data: chunk,\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        let header: Uint8Array | undefined;\r\n\r\n        let deserializeStream = new StructDeserializeStream(VideoPacket);\r\n        return {\r\n            writable: deserializeStream.writable,\r\n            readable: deserializeStream.readable.pipeThrough(new TransformStream({\r\n                transform(packet, controller) {\r\n                    if (packet.pts === NO_PTS) {\r\n                        const sequenceParameterSet = parse_sequence_parameter_set(packet.data.slice().buffer);\r\n\r\n                        const {\r\n                            profile_idc: profileIndex,\r\n                            constraint_set: constraintSet,\r\n                            level_idc: levelIndex,\r\n                            pic_width_in_mbs_minus1,\r\n                            pic_height_in_map_units_minus1,\r\n                            frame_mbs_only_flag,\r\n                            frame_crop_left_offset,\r\n                            frame_crop_right_offset,\r\n                            frame_crop_top_offset,\r\n                            frame_crop_bottom_offset,\r\n                        } = sequenceParameterSet;\r\n\r\n                        const encodedWidth = (pic_width_in_mbs_minus1 + 1) * 16;\r\n                        const encodedHeight = (pic_height_in_map_units_minus1 + 1) * (2 - frame_mbs_only_flag) * 16;\r\n                        const cropLeft = frame_crop_left_offset * 2;\r\n                        const cropRight = frame_crop_right_offset * 2;\r\n                        const cropTop = frame_crop_top_offset * 2;\r\n                        const cropBottom = frame_crop_bottom_offset * 2;\r\n\r\n                        const croppedWidth = encodedWidth - cropLeft - cropRight;\r\n                        const croppedHeight = encodedHeight - cropTop - cropBottom;\r\n\r\n                        header = packet.data;\r\n                        controller.enqueue({\r\n                            type: 'configuration',\r\n                            data: {\r\n                                profileIndex,\r\n                                constraintSet,\r\n                                levelIndex,\r\n                                encodedWidth,\r\n                                encodedHeight,\r\n                                cropLeft,\r\n                                cropRight,\r\n                                cropTop,\r\n                                cropBottom,\r\n                                croppedWidth,\r\n                                croppedHeight,\r\n                            }\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    let frameData: Uint8Array;\r\n                    if (header) {\r\n                        frameData = new Uint8Array(header.byteLength + packet.data.byteLength);\r\n                        frameData.set(header);\r\n                        frameData.set(packet.data, header.byteLength);\r\n                        header = undefined;\r\n                    } else {\r\n                        frameData = packet.data;\r\n                    }\r\n\r\n                    controller.enqueue({\r\n                        type: 'frame',\r\n                        pts: packet.pts,\r\n                        data: frameData,\r\n                    });\r\n                }\r\n            }))\r\n        };\r\n    }\r\n\r\n    public getControlMessageTypes(): ScrcpyControlMessageType[] {\r\n        return [\r\n            /*  0 */ ScrcpyControlMessageType.InjectKeycode,\r\n            /*  1 */ ScrcpyControlMessageType.InjectText,\r\n            /*  2 */ ScrcpyControlMessageType.InjectTouch,\r\n            /*  3 */ ScrcpyControlMessageType.InjectScroll,\r\n            /*  4 */ ScrcpyControlMessageType.BackOrScreenOn,\r\n            /*  5 */ ScrcpyControlMessageType.ExpandNotificationPanel,\r\n            /*  6 */ ScrcpyControlMessageType.CollapseNotificationPanel,\r\n            /*  7 */ ScrcpyControlMessageType.GetClipboard,\r\n            /*  8 */ ScrcpyControlMessageType.SetClipboard,\r\n            /*  9 */ ScrcpyControlMessageType.SetScreenPowerMode,\r\n            /* 10 */ ScrcpyControlMessageType.RotateDevice,\r\n        ];\r\n    }\r\n\r\n    public serializeBackOrScreenOnControlMessage(\r\n        message: ScrcpyBackOrScreenOnEvent1_18,\r\n    ) {\r\n        if (message.action === AndroidKeyEventAction.Down) {\r\n            return ScrcpyBackOrScreenOnEvent1_16.serialize(message);\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    public serializeInjectScrollControlMessage(\r\n        message: ScrcpyInjectScrollControlMessage1_22,\r\n    ): Uint8Array {\r\n        return ScrcpyInjectScrollControlMessage1_16.serialize(message);\r\n    }\r\n}\r\n","import Struct, { placeholder } from \"@yume-chan/struct\";\nimport { AndroidKeyEventAction, ScrcpyControlMessageType } from \"../message.js\";\nimport { ScrcpyBackOrScreenOnEvent1_16, ScrcpyOptions1_16, type ScrcpyOptionsInit1_16 } from \"./1_16/index.js\";\n\nexport interface ScrcpyOptionsInit1_18 extends ScrcpyOptionsInit1_16 {\n    powerOffOnClose: boolean;\n}\n\nexport const ScrcpyBackOrScreenOnEvent1_18 =\n    new Struct()\n        .fields(ScrcpyBackOrScreenOnEvent1_16)\n        .uint8('action', placeholder<AndroidKeyEventAction>());\n\nexport type ScrcpyBackOrScreenOnEvent1_18 = typeof ScrcpyBackOrScreenOnEvent1_18[\"TInit\"];\n\nexport class ScrcpyOptions1_18<T extends ScrcpyOptionsInit1_18 = ScrcpyOptionsInit1_18> extends ScrcpyOptions1_16<T> {\n    constructor(value: Partial<ScrcpyOptionsInit1_18>) {\n        super(value);\n    }\n\n    protected override getArgumentOrder(): (keyof T)[] {\n        return super.getArgumentOrder().concat(['powerOffOnClose']);\n    }\n\n    protected override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            powerOffOnClose: false,\n        };\n    }\n\n    public override getOutputEncoderNameRegex(): RegExp {\n        return /\\s+scrcpy --encoder '(.*?)'/;\n    }\n\n    public override getControlMessageTypes(): ScrcpyControlMessageType[] {\n        /**\n         *  0 InjectKeycode\n         *  1 InjectText\n         *  2 InjectTouch\n         *  3 InjectScroll\n         *  4 BackOrScreenOn\n         *  5 ExpandNotificationPanel\n         *  6 ExpandSettingsPanel\n         *  7 CollapseNotificationPanel\n         *  8 GetClipboard\n         *  9 SetClipboard\n         * 10 SetScreenPowerMode\n         * 11 RotateDevice\n         */\n        const types = super.getControlMessageTypes();\n        types.splice(6, 0, ScrcpyControlMessageType.ExpandSettingPanel);\n        return types;\n    }\n\n    public override serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnEvent1_18,\n    ) {\n        return ScrcpyBackOrScreenOnEvent1_18.serialize(message);\n    }\n}\n","// cspell: ignore autosync\n\nimport { ScrcpyOptions1_18, type ScrcpyOptionsInit1_18 } from './1_18.js';\nimport { toScrcpyOptionValue } from \"./common.js\";\n\nexport interface ScrcpyOptionsInit1_21 extends ScrcpyOptionsInit1_18 {\n    clipboardAutosync?: boolean;\n}\n\nfunction toSnakeCase(input: string): string {\n    return input.replace(/([A-Z])/g, '_$1').toLowerCase();\n}\n\nexport class ScrcpyOptions1_21<T extends ScrcpyOptionsInit1_21 = ScrcpyOptionsInit1_21> extends ScrcpyOptions1_18<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_21>) {\n        super(init);\n    }\n\n    protected override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            clipboardAutosync: true,\n        };\n    }\n\n    public override formatServerArguments(): string[] {\n        // 1.21 changed the format of arguments\n        // So `getArgumentOrder()` is no longer needed\n        return Object.entries(this.value)\n            .map(([key, value]) => [key, toScrcpyOptionValue(value, undefined)] as const)\n            .filter((pair): pair is [string, string] => pair[1] !== undefined)\n            .map(([key, value]) => `${toSnakeCase(key)}=${value}`);\n    }\n}\n","import type { Adb } from \"@yume-chan/adb\";\nimport Struct from \"@yume-chan/struct\";\nimport { ScrcpyClientForwardConnection, ScrcpyClientReverseConnection, type ScrcpyClientConnection } from \"../connection.js\";\nimport { ScrcpyInjectScrollControlMessage1_16 } from \"./1_16/index.js\";\nimport { ScrcpyOptions1_21, type ScrcpyOptionsInit1_21 } from \"./1_21.js\";\n\nexport interface ScrcpyOptionsInit1_22 extends ScrcpyOptionsInit1_21 {\n    downsizeOnError: boolean;\n\n    /**\n     * Send device name and size at start of video stream.\n     *\n     * @default true\n     */\n    sendDeviceMeta: boolean;\n\n    /**\n     * Send a `0` byte on start of video stream to detect connection issues\n     *\n     * @default true\n     */\n    sendDummyByte: boolean;\n\n    /**\n     * Implies `sendDeviceMeta: false`, `sendFrameMeta: false` and `sendDummyByte: false`\n     *\n     * @default false\n     */\n    rawVideoStream: boolean;\n}\n\nexport const ScrcpyInjectScrollControlMessage1_22 =\n    new Struct()\n        .fields(ScrcpyInjectScrollControlMessage1_16)\n        .int32(\"buttons\");\n\nexport type ScrcpyInjectScrollControlMessage1_22 = typeof ScrcpyInjectScrollControlMessage1_22[\"TInit\"];\n\nexport class ScrcpyOptions1_22<T extends ScrcpyOptionsInit1_22 = ScrcpyOptionsInit1_22> extends ScrcpyOptions1_21<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_22>) {\n        if (init.rawVideoStream) {\n            // Set implied options for client-side processing\n            init.sendDeviceMeta = false;\n            init.sendFrameMeta = false;\n            init.sendDummyByte = false;\n        }\n\n        super(init);\n    }\n\n    protected override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            downsizeOnError: true,\n            sendDeviceMeta: true,\n            sendDummyByte: true,\n            rawVideoStream: false,\n        };\n    }\n\n    public override createConnection(device: Adb): ScrcpyClientConnection {\n        const options = {\n            ...this.getDefaultValue(),\n            ...this.value,\n        };\n        if (this.value.tunnelForward) {\n            return new ScrcpyClientForwardConnection(device, options);\n        } else {\n            return new ScrcpyClientReverseConnection(device, options);\n        }\n    }\n\n    public override serializeInjectScrollControlMessage(\n        message: ScrcpyInjectScrollControlMessage1_22,\n    ): Uint8Array {\n        return ScrcpyInjectScrollControlMessage1_22.serialize(message);\n    }\n}\n","import { TransformStream } from \"@yume-chan/adb\";\nimport { ScrcpyOptions1_22, type ScrcpyOptionsInit1_22 } from './1_22.js';\nimport type { VideoStreamPacket } from \"./common.js\";\n\nexport interface ScrcpyOptionsInit1_23 extends ScrcpyOptionsInit1_22 {\n    cleanup: boolean;\n}\n\nconst KEYFRAME_PTS = BigInt(1) << BigInt(62);\n\nexport class ScrcpyOptions1_23<T extends ScrcpyOptionsInit1_23 = ScrcpyOptionsInit1_23> extends ScrcpyOptions1_22<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_23>) {\n        super(init);\n    }\n\n    protected override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            cleanup: true,\n        };\n    }\n\n    public override createVideoStreamTransformer(): TransformStream<Uint8Array, VideoStreamPacket> {\n        const superStream = super.createVideoStreamTransformer();\n        return {\n            writable: superStream.writable,\n            readable: superStream.readable.pipeThrough(new TransformStream({\n                transform(packet, controller): void {\n                    if (packet.type !== 'frame') {\n                        controller.enqueue(packet);\n                        return;\n                    }\n\n                    if (packet.pts !== undefined && packet.pts & KEYFRAME_PTS) {\n                        packet.keyframe = true;\n                        packet.pts &= ~KEYFRAME_PTS;\n                    }\n\n                    controller.enqueue(packet);\n                }\n            }))\n        };\n    }\n}\n","import { ScrcpyOptions1_23, type ScrcpyOptionsInit1_23 } from './1_23.js';\n\nexport interface ScrcpyOptionsInit1_24 extends ScrcpyOptionsInit1_23 {\n    powerOn: boolean;\n}\n\nexport class ScrcpyOptions1_24<T extends ScrcpyOptionsInit1_24 = ScrcpyOptionsInit1_24> extends ScrcpyOptions1_23<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_24>) {\n        super(init);\n    }\n\n    protected override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            powerOn: true,\n        };\n    }\n}\n","import { WrapWritableStream, type Adb, type AdbSync } from \"@yume-chan/adb\";\nimport { DEFAULT_SERVER_PATH } from \"./options/index.js\";\n\nexport interface PushServerOptions {\n    path?: string;\n}\n\nexport function pushServer(\n    device: Adb,\n    options: PushServerOptions = {}\n) {\n    const { path = DEFAULT_SERVER_PATH } = options;\n\n    let sync!: AdbSync;\n    return new WrapWritableStream<Uint8Array>({\n        async start() {\n            sync = await device.sync();\n            return sync.write(path);\n        },\n        async close() {\n            await sync.dispose();\n        },\n    });\n}\n"],"names":["window","__NEXT_P","push","cachedValue","SERVER_URL","toString","FetchWithProgress","url","_downloaded","_total","progressEvent","EventEmitter","this","promise","fetch","response","reader","chunks","result","position","chunk","Number","parseInt","headers","get","fire","body","getReader","read","done","value","byteLength","reduce","item","Uint8Array","set","downloaded","total","onProgress","event","fetchServer","catch","e","undefined","clamp","min","max","useClasses","makeStyles","labelRight","marginLeft","video","transformOrigin","SettingItem","observer","definition","settings","onChange","classes","label","Stack","horizontal","verticalAlign","span","description","TooltipHost","content","Icon","className","iconName","Icons","labelExtra","type","TextField","placeholder","key","Dropdown","options","selectedKey","option","Toggle","checked","SpinButton","labelPosition","Position","step","ScrcpyPageState","running","deviceView","rendererContainer","logVisible","log","settingsVisible","demoModeVisible","navigationBarVisible","width","height","rotate","client","encoders","updateEncoders","pushServer","ScrcpyClient","GlobalState","DEFAULT_SERVER_PATH","SCRCPY_SERVER_VERSION","ScrcpyOptions1_24","logLevel","ScrcpyLogLevel","tunnelForward","runInAction","encoderName","includes","decoders","name","Constructor","TinyH264Decoder","decoder","fpsCounterIntervalId","fps","displays","updateDisplays","displayId","connecting","serverTotalSize","serverDownloadedSize","debouncedServerDownloadedSize","serverDownloadSpeed","serverUploadedSize","debouncedServerUploadedSize","serverUploadSpeed","maxSize","bitRate","lockVideoOrientation","ScrcpyVideoOrientation","crop","start","intervalId","serverBuffer","decoderDefinition","Error","setInterval","action","clearInterval","ReadableStream","controller","enqueue","close","pipeThrough","ChunkStream","ADB_SYNC_MAX_PACKET_SIZE","ProgressStream","progress","pipeTo","find","x","lastFrameCount","frameRendered","sendDeviceMeta","sendDummyByte","codecOptions","ignoreDecoderCodecArgs","CodecOptions","profile","maxProfile","level","maxLevel","formatServerArguments","join","stdout","WritableStream","write","line","videoStream","InspectStream","packet","data","croppedWidth","croppedHeight","writable","exit","then","dispose","onClipboardChange","navigator","clipboard","writeText","handleBackPointerDown","button","currentTarget","setPointerCapture","pointerId","pressBackOrTurnOnScreen","AndroidKeyEventAction","handleBackPointerUp","handleHomePointerDown","injectKeyCode","keyCode","AndroidKeyCode","repeat","metaState","handleHomePointerUp","handleAppSwitchPointerDown","handleAppSwitchPointerUp","injectTouch","calculatePointerPosition","clientX","clientY","y","pointerType","BigInt","pointerX","pointerY","pressure","buttons","handlePointerDown","focus","preventDefault","AndroidMotionEventAction","handlePointerMove","handlePointerUp","handleWheel","stopPropagation","injectScroll","scrollX","Math","sign","deltaX","scrollY","deltaY","handleContextMenu","handleKeyDown","code","match","injectText","Backspace","Space","Enter","makeAutoObservable","observable","stop","handleDeviceViewRef","handleRendererContainerRef","autorun","firstChild","remove","appendChild","renderer","VideoDecoder","setTimeout","unshift","WebCodecsDecoder","clearTimeout","element","addEventListener","passive","viewRect","getBoundingClientRect","pointerViewX","pointerViewY","rotatedWidth","state","rotatedHeight","commandBarItems","iconProps","text","onClick","disabled","iconOnly","enterFullscreen","rotateDevice","commandBarFarItems","tooltipHostProps","p","ExternalLink","href","spaceAfter","calloutProps","calloutMaxWidth","settingDefinitions","IconButton","map","length","console","ConnectionDialog","layerHostId","useId","useState","useEffect","setIsClient","isClient","LayerHost","id","style","top","bottom","left","right","margin","pointerEvents","Dialog","hidden","modalProps","layerProps","hostId","dialogContentProps","title","tokens","CommonStackTokens","ProgressIndicator","percentComplete","formatSpeed","progressHidden","NavigationBar","children","verticalFill","horizontalAlign","background","maxWidth","transform","color","onPointerDown","onPointerUp","div","RouteStackProps","Head","CommandBar","items","farItems","grow","styles","root","DeviceView","ref","BottomElement","tabIndex","onPointerMove","onPointerCancel","onKeyDown","onContextMenu","padding","overflow","display","fontFamily","overflowY","whiteSpace","wordWrap","index","DemoModePanel","props","layerHostRef","rootRef","notifyLayersChanged","componentRef","current","ScrcpyControlMessageType","ScrcpySimpleControlMessage","uint8","ScrcpyInjectTouchControlMessage","fields","uint64","uint32","uint16","ScrcpyInjectTextControlMessage","string","lengthField","ScrcpyInjectKeyCodeControlMessage","SplitLinesStream","constructor","super","indexOf","substring","splitLines","ArrayToStream","array","async","Promise","resolve","pull","ConcatStream","streams","advance","ClipboardMessage","static","adb","path","version","control","encoderNameRegex","getOutputEncoderNameRegex","output","displayIdRegex","connection","createConnection","process","initialize","subprocess","spawn","protocols","abortController","pipe","signal","preventCancel","race","getStreams","error","abort","controlStream","kill","_adb","_stdout","_screenWidth","screenWidth","_screenHeight","screenHeight","_videoStream","_controlStreamWriter","clipboardChangeEvent","lastTouchMessage","readable","createVideoStreamTransformer","buffered","getWriter","deserialize","checkControlStream","caller","getControlMessageTypeValue","getControlMessageTypes","message","serialize","InjectKeycode","InjectText","now","Date","Move","HoverMove","InjectTouch","buffer","serializeInjectScrollControlMessage","InjectScroll","serializeBackOrScreenOnControlMessage","BackOrScreenOn","sendSimpleControlMessage","RotateDevice","AndroidCodecProfile","AndroidCodecLevel","worker","workerReady","pendingResolvers","streamId","pictureReadyEvent","TinyH264Wrapper","onPictureReady","addDisposable","handlePictureReady","renderStateId","feed","postMessage","offset","cachedInitializePromise","all","YuvBuffer","default","YuvCanvas","Baseline","Level4","_renderer","_frameRendered","_writable","_yuvCanvas","_initializer","document","createElement","configure","slice","config","attach","encodedWidth","encodedHeight","chromaWidth","chromaHeight","format","cropLeft","cropTop","cropWidth","cropHeight","displayWidth","displayHeight","wrapper","Worker","URL","resolver","createTinyH264Wrapper","uPlaneOffset","vPlaneOffset","frame","lumaPlane","chromaPlane","drawFrame","toHex","padStart","toUpperCase","context","lastFrame","animationFrame","getContext","render","decode","EncodedVideoChunk","keyframe","timestamp","drawImage","requestAnimationFrame","profileIndex","constraintSet","levelIndex","codec","optimizeForLatency","cancelAnimationFrame","delay","time","globalThis","ScrcpyClientConnection","device","ScrcpyClientForwardConnection","createSocket","i","connect","stream","connectAndRetry","releaseLock","connectVideoStream","ScrcpyClientReverseConnection","address","reverse","queue","TransformStream","writer","add","socket","accept","toScrcpyOptionValue","empty","toOptionValue","isScrcpyOptionValue","BitReader","bytePosition","bitPosition","next","decodeExponentialGolombNumber","parse_sequence_parameter_set","nalu","writeIndex","zeroCount","inEmulation","byte","lastZeroCount","subarray","iterateNalu","nal_ref_idc","profile_idc","constraint_set","constraint_set_reader","constraint_set0_flag","constraint_set1_flag","constraint_set2_flag","constraint_set3_flag","constraint_set4_flag","constraint_set5_flag","level_idc","seq_parameter_set_id","chroma_format_idc","seq_scaling_list_present_flag","pic_order_cnt_type","num_ref_frames_in_pic_order_cnt_cycle","offset_for_ref_frame","pic_width_in_mbs_minus1","pic_height_in_map_units_minus1","frame_mbs_only_flag","frame_cropping_flag","frame_crop_left_offset","frame_crop_right_offset","frame_crop_top_offset","frame_crop_bottom_offset","CODEC_OPTION_TYPES","repeatPreviousFrameAfter","maxPtsGapToEncoder","entries","Object","filter","input","replace","toLowerCase","VideoPacket","uint8Array","NO_PTS","ScrcpyBackOrScreenOnEvent1_16","ScrcpyInjectScrollControlMessage1_16","int32","ScrcpyOptions1_16","Verbose","Debug","Initial","Unlocked","getArgumentOrder","getDefaultValue","maxFps","sendFrameMeta","showTouches","stayAwake","defaults","header","deserializeStream","pts","sequenceParameterSet","cropRight","cropBottom","frameData","ExpandNotificationPanel","CollapseNotificationPanel","GetClipboard","SetClipboard","SetScreenPowerMode","Down","ScrcpyBackOrScreenOnEvent1_18","ScrcpyOptions1_18","concat","powerOffOnClose","types","splice","ExpandSettingPanel","ScrcpyOptions1_21","init","clipboardAutosync","pair","ScrcpyInjectScrollControlMessage1_22","ScrcpyOptions1_22","rawVideoStream","downsizeOnError","KEYFRAME_PTS","ScrcpyOptions1_23","cleanup","superStream","powerOn","sync"],"sourceRoot":""}