(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{7232:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return n(913)}])},913:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return it}});var r=n(9957),i=n(7472),o=n(3368),a=n(9405),s=n(4145),c=n(7627),l=n(3766),d=n.n(l),u=n(3470),p=n(7449),h=n(1348),f=n(2451),v=n(9273),g=n(1852),w=n(3444),m=function(e){var t=e.className,n=h.useState((function(){return(0,v.z)()}))[0],r=e.id,i=void 0===r?n:r,o=h.useRef({hostId:i,rootRef:h.useRef(null),notifyLayersChanged:function(){}});return h.useImperativeHandle(e.componentRef,(function(){return o.current})),h.useEffect((function(){(0,w._Y)(i,o.current),(0,w.EQ)(i)}),[]),(0,f.k)((function(){(0,w.nw)(i,o.current),(0,w.EQ)(i)})),h.createElement("div",(0,p.pi)({},e,{className:(0,g.i)("ms-LayerHost",t),ref:o.current.rootRef}))},y=n(8833),b=n(5859),x=n(7199),S=n(8610),k=n(9219),P=n(1906),_=n(9663),C=n(6159),D=n(5943),z=n(7720),E=n(1009),L=n(1173),I=n(3604),T=n(3198),M=n(7076),j=n(3115),V=n(4204),O=n.n(V),N=n(5384),R=n(3282),U=n(5798),H=n(1498);class B{adb;options;constructor(e,t){this.adb=e,this.options=t}initialize(){}dispose(){}}class F extends B{connect(){return this.adb.createSocket("localabstract:scrcpy")}async connectAndRetry(){for(let t=0;t<100;t++)try{return await this.connect()}catch(e){await(0,U.gw)(100)}throw new Error("Can't connect to server after 100 retries")}async connectVideoStream(){const{readable:e}=await this.connectAndRetry();if(this.options.sendDummyByte){const t=e.getReader(),{done:n,value:r}=await t.read();if(n||1!==r.byteLength||0!==r[0])throw new Error("Unexpected response from server");t.releaseLock()}return e}async getStreams(){const e=await this.connectVideoStream();let t;if(this.options.control&&(t=await this.connectAndRetry()),this.options.sendDeviceMeta){const t=e.getReader(),{done:n,value:r}=await t.read();if(n||68!==r.byteLength)throw new Error("Unexpected response from server");t.releaseLock()}return[e,t]}}class A extends B{streams;address;async initialize(){await this.adb.reverse.remove("localabstract:scrcpy").catch((()=>{}));const e=new H.GJ;this.streams=e.readable.getReader();const t=e.writable.getWriter();this.address=await this.adb.reverse.add("localabstract:scrcpy","tcp:27183",(e=>(t.write(e),!0)))}async accept(){return(await this.streams.read()).value}async getStreams(){const{readable:e}=await this.accept();let t;if(this.options.control&&(t=await this.accept()),this.options.sendDeviceMeta){const t=e.getReader(),{done:n,value:r}=await t.read();if(n||68!==r.byteLength)throw new Error("Unexpected response from server");t.releaseLock()}return[e,t]}dispose(){this.adb.reverse.remove(this.address)}}class W extends class extends class{raw;get value(){return this.raw.value}set value(e){this.raw.value=e}constructor(e){this.raw=e}getDefaultValue(){return this.raw.getDefaultValue()}formatServerArguments(){return this.raw.formatServerArguments()}getOutputEncoderNameRegex(){return this.raw.getOutputEncoderNameRegex()}createVideoStreamTransformer(){return this.raw.createVideoStreamTransformer()}getControlMessageTypes(){return this.raw.getControlMessageTypes()}serializeBackOrScreenOnControlMessage(e){return this.raw.serializeBackOrScreenOnControlMessage(e)}serializeInjectScrollControlMessage(e){return this.raw.serializeInjectScrollControlMessage(e)}}{createConnection(e){const t={control:!0,sendDummyByte:!0,sendDeviceMeta:!0};return this.value.tunnelForward?new F(e,t):new A(e,t)}}{createConnection(e){const t={...this.getDefaultValue(),...this.value};return this.value.tunnelForward?new F(e,t):new A(e,t)}}var Z,G,J,q=n(6041);!function(e){e[e.InjectKeyCode=0]="InjectKeyCode",e[e.InjectText=1]="InjectText",e[e.InjectTouch=2]="InjectTouch",e[e.InjectScroll=3]="InjectScroll",e[e.BackOrScreenOn=4]="BackOrScreenOn",e[e.ExpandNotificationPanel=5]="ExpandNotificationPanel",e[e.ExpandSettingPanel=6]="ExpandSettingPanel",e[e.CollapseNotificationPanel=7]="CollapseNotificationPanel",e[e.GetClipboard=8]="GetClipboard",e[e.SetClipboard=9]="SetClipboard",e[e.SetScreenPowerMode=10]="SetScreenPowerMode",e[e.RotateDevice=11]="RotateDevice"}(Z=Z||(Z={})),function(e){e[e.Down=0]="Down",e[e.Up=1]="Up"}(G=G||(G={})),function(e){e[e.Home=3]="Home",e[e.Back=4]="Back",e[e.VolumeUp=24]="VolumeUp",e[e.VolumeDown=25]="VolumeDown",e[e.A=29]="A",e[e.B=30]="B",e[e.C=31]="C",e[e.D=32]="D",e[e.E=33]="E",e[e.F=34]="F",e[e.G=35]="G",e[e.H=36]="H",e[e.I=37]="I",e[e.J=38]="J",e[e.K=39]="K",e[e.L=40]="L",e[e.M=41]="M",e[e.N=42]="N",e[e.O=43]="O",e[e.P=44]="P",e[e.Q=45]="Q",e[e.R=46]="R",e[e.S=47]="S",e[e.T=48]="T",e[e.U=49]="U",e[e.V=50]="V",e[e.W=51]="W",e[e.X=52]="X",e[e.Y=53]="Y",e[e.Z=54]="Z",e[e.Tab=61]="Tab",e[e.Space=62]="Space",e[e.Enter=66]="Enter",e[e.Delete=67]="Delete",e[e.VolumeMute=164]="VolumeMute",e[e.AppSwitch=187]="AppSwitch"}(J=J||(J={}));const K=(new q.ZP).uint8("type",Z.InjectKeyCode).uint8("action",(0,q.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState"),Y=(new q.ZP).uint8("type",Z.InjectText).uint32("length").string("text",{lengthField:"length"});var X;!function(e){e[e.Down=0]="Down",e[e.Up=1]="Up",e[e.Move=2]="Move",e[e.Cancel=3]="Cancel",e[e.Outside=4]="Outside",e[e.PointerDown=5]="PointerDown",e[e.PointerUp=6]="PointerUp",e[e.HoverMove=7]="HoverMove",e[e.Scroll=8]="Scroll",e[e.HoverEnter=9]="HoverEnter",e[e.HoverExit=10]="HoverExit",e[e.ButtonPress=11]="ButtonPress",e[e.ButtonRelease=12]="ButtonRelease"}(X=X||(X={}));const $=(new q.ZP).uint8("type",Z.InjectTouch).uint8("action",(0,q.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").uint16("pressure").uint32("buttons"),Q=(new q.ZP).uint8("type",Z.RotateDevice);var ee;!function(e){e[e.Off=0]="Off",e[e.Normal=2]="Normal"}(ee=ee||(ee={}));const te=(new q.ZP).uint8("type",Z.SetScreenPowerMode).uint8("mode",(0,q.W$)());class ne{options;types;writer;constructor(e,t){this.options=t,this.types=t.getControlMessageTypes(),this.writer=e.getWriter()}getTypeValue(e){const t=this.types.indexOf(e);if(-1===t)throw new Error("Not supported");return t}injectKeyCode(e){return this.writer.write(K.serialize({...e,type:this.getTypeValue(Z.InjectKeyCode)}))}injectText(e){return this.writer.write(Y.serialize({text:e,type:this.getTypeValue(Z.InjectText)}))}injectTouch(e){return this.writer.write($.serialize({...e,type:this.getTypeValue(Z.InjectTouch)}))}injectScroll(e){return this.writer.write(this.options.serializeInjectScrollControlMessage({...e,type:this.getTypeValue(Z.InjectScroll)}))}async backOrScreenOn(e){const t=this.options.serializeBackOrScreenOnControlMessage({action:e,type:this.getTypeValue(Z.BackOrScreenOn)});if(t)return await this.writer.write(t)}setScreenPowerMode(e){return this.writer.write(te.serialize({mode:e,type:this.getTypeValue(Z.SetScreenPowerMode)}))}rotateDevice(){return this.writer.write(Q.serialize({type:this.getTypeValue(Z.RotateDevice)}))}close(){return this.writer.close()}}var re;!function(e){e[e.Clipboard=0]="Clipboard",e[e.AckClipboard=1]="AckClipboard"}(re=re||(re={}));const ie=(new q.ZP).uint32("length").string("content",{lengthField:"length"}).extra({type:re.Clipboard});class oe extends H.pC{constructor(){super((async e=>{if(0===(await e.read(1))[0])return await ie.deserialize(e);throw new Error("unknown control message type")}))}}const ae={repeatPreviousFrameAfter:"long",maxPtsGapToEncoder:"long"};class se{value;constructor(e){this.value=e}toOptionValue(){const e=Object.entries(this.value).filter((([e,t])=>void 0!==t));if(0!==e.length)return e.map((([e,t])=>{const n=ae[e];return`${r=e,r.replace(/([A-Z])/g,"-$1").toLowerCase()}${n?`:${n}`:""}=${t}`;var r})).join(",")}}const ce="/data/local/tmp/scrcpy-server.jar";function le(e,t){return function(e){return"object"===typeof e&&null!==e&&"function"===typeof e.toOptionValue}(e)&&(e=e.toOptionValue()),void 0===e?t:`${e}`}class de{buffer;bytePosition=0;bitPosition=0;constructor(e){this.buffer=e}read(e){let t=0;for(let n=0;n<e;n+=1)t=t<<1|this.next();return t}next(){const e=this.buffer[this.bytePosition]>>7-this.bitPosition&1;return this.bitPosition+=1,8===this.bitPosition&&(this.bytePosition+=1,this.bitPosition=0),e}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}}function ue(e){for(const t of function*(e){let t=-1,n=0,r=0,i=!1;for(const o of e){if(e[n]=o,n+=1,i){if(o>3)throw new Error("Invalid data");i=!1;continue}if(0==o){r+=1;continue}const a=r;if(r=0,-1===t){if(a>=2&&1===o){n=0,t=0;continue}throw new Error("Invalid data")}if(!(a<2))if(1!==o){if(a>2)throw new Error("Invalid data");switch(o){case 2:throw new Error("Invalid data");case 3:n-=1,i=!0}}else n-=a+1,yield e.subarray(t,n),t=n}if(i||0!==r)throw new Error("Invalid data");yield e.subarray(t,n)}(new Uint8Array(e))){const e=new de(t);if(0!==e.next())throw new Error("Invalid data");const n=e.read(2);if(7!==e.read(5))continue;if(0===n)throw new Error("Invalid data");const r=e.read(8),i=e.read(8),o=new de(new Uint8Array([i])),a=!!o.next(),s=!!o.next(),c=!!o.next(),l=!!o.next(),d=!!o.next(),u=!!o.next();if(0!==o.read(2))throw new Error("Invalid data");const p=e.read(8),h=e.decodeExponentialGolombNumber();if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||139===r||134===r){const t=e.decodeExponentialGolombNumber();3===t&&e.next(),e.decodeExponentialGolombNumber(),e.decodeExponentialGolombNumber(),e.next();if(!!e.next()){const n=[];for(let r=0;r<(3!==t?8:12);r++)n[r]=!!e.next(),n[r]}}e.decodeExponentialGolombNumber();const f=e.decodeExponentialGolombNumber();if(0===f)e.decodeExponentialGolombNumber();else if(1===f){e.next(),e.decodeExponentialGolombNumber(),e.decodeExponentialGolombNumber();const t=e.decodeExponentialGolombNumber(),n=[];for(let r=0;r<t;r++)n[r]=e.decodeExponentialGolombNumber()}e.decodeExponentialGolombNumber(),e.next();const v=e.decodeExponentialGolombNumber(),g=e.decodeExponentialGolombNumber(),w=e.next();w||e.next(),e.next();const m=!!e.next();let y,b,x,S;m?(y=e.decodeExponentialGolombNumber(),b=e.decodeExponentialGolombNumber(),x=e.decodeExponentialGolombNumber(),S=e.decodeExponentialGolombNumber()):(y=0,b=0,x=0,S=0);e.next();return{profile_idc:r,constraint_set:i,constraint_set0_flag:a,constraint_set1_flag:s,constraint_set2_flag:c,constraint_set3_flag:l,constraint_set4_flag:d,constraint_set5_flag:u,level_idc:p,seq_parameter_set_id:h,pic_width_in_mbs_minus1:v,pic_height_in_map_units_minus1:g,frame_mbs_only_flag:w,frame_cropping_flag:m,frame_crop_left_offset:y,frame_crop_right_offset:b,frame_crop_top_offset:x,frame_crop_bottom_offset:S}}throw new Error("Invalid data")}var pe,he;!function(e){e.Verbose="verbose",e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error"}(pe=pe||(pe={})),function(e){e[e.Initial=-2]="Initial",e[e.Unlocked=-1]="Unlocked",e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape",e[e.PortraitFlipped=2]="PortraitFlipped",e[e.LandscapeFlipped=3]="LandscapeFlipped"}(he=he||(he={}));const fe=(new q.ZP).uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),ve=BigInt(1)<<BigInt(63),ge=(new q.ZP).uint8("type",Z.BackOrScreenOn),we=(new q.ZP).uint8("type",Z.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class me{value;constructor(e){new.target===me&&e.logLevel===pe.Verbose&&(e.logLevel=pe.Debug),new.target===me&&e.lockVideoOrientation===he.Initial&&(e.lockVideoOrientation=he.Unlocked),this.value=e}getArgumentOrder(){return["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions","encoderName"]}getDefaultValue(){return{logLevel:pe.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:he.Unlocked,tunnelForward:!1,crop:"-",sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new se({}),encoderName:"-"}}formatServerArguments(){const e=this.getDefaultValue();return this.getArgumentOrder().map((t=>le(this.value[t]||e[t],"-")))}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder-name '(.*?)'/}createVideoStreamTransformer(){if(!1===this.value.sendFrameMeta)return new H.GJ({transform(e,t){t.enqueue({type:"frame",data:e})}});let e,t=new H.gL(fe);return{writable:t.writable,readable:t.readable.pipeThrough(new H.GJ({transform(t,n){if(t.pts===ve){const r=ue(t.data.slice().buffer),{profile_idc:i,constraint_set:o,level_idc:a,pic_width_in_mbs_minus1:s,pic_height_in_map_units_minus1:c,frame_mbs_only_flag:l,frame_crop_left_offset:d,frame_crop_right_offset:u,frame_crop_top_offset:p,frame_crop_bottom_offset:h}=r,f=16*(s+1),v=(c+1)*(2-l)*16,g=2*d,w=2*u,m=2*p,y=2*h,b=f-g-w,x=v-m-y;return e=t.data,void n.enqueue({type:"configuration",data:{profileIndex:i,constraintSet:o,levelIndex:a,encodedWidth:f,encodedHeight:v,cropLeft:g,cropRight:w,cropTop:m,cropBottom:y,croppedWidth:b,croppedHeight:x}})}let r;e?(r=new Uint8Array(e.byteLength+t.data.byteLength),r.set(e),r.set(t.data,e.byteLength),e=void 0):r=t.data,n.enqueue({type:"frame",pts:t.pts,data:r})}}))}}getControlMessageTypes(){return[Z.InjectKeyCode,Z.InjectText,Z.InjectTouch,Z.InjectScroll,Z.BackOrScreenOn,Z.ExpandNotificationPanel,Z.CollapseNotificationPanel,Z.GetClipboard,Z.SetClipboard,Z.SetScreenPowerMode,Z.RotateDevice]}serializeBackOrScreenOnControlMessage(e){if(e.action===G.Down)return ge.serialize(e)}serializeInjectScrollControlMessage(e){return we.serialize(e)}}const ye=(new q.ZP).fields(ge).uint8("action",(0,q.W$)());class be extends me{constructor(e){super(e)}getArgumentOrder(){return super.getArgumentOrder().concat(["powerOffOnClose"])}getDefaultValue(){return{...super.getDefaultValue(),powerOffOnClose:!1}}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder '(.*?)'/}getControlMessageTypes(){const e=super.getControlMessageTypes();return e.splice(6,0,Z.ExpandSettingPanel),e}serializeBackOrScreenOnControlMessage(e){return ye.serialize(e)}}class xe extends be{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),clipboardAutosync:!0}}formatServerArguments(){return Object.entries(this.value).map((([e,t])=>[e,le(t,void 0)])).filter((e=>void 0!==e[1])).map((([e,t])=>{return`${n=e,n.replace(/([A-Z])/g,"_$1").toLowerCase()}=${t}`;var n}))}}const Se=(new q.ZP).fields(we).int32("buttons");class ke extends xe{constructor(e){e.rawVideoStream&&(e.sendDeviceMeta=!1,e.sendFrameMeta=!1,e.sendDummyByte=!1),super(e)}getDefaultValue(){return{...super.getDefaultValue(),downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0,rawVideoStream:!1}}serializeInjectScrollControlMessage(e){return Se.serialize(e)}}const Pe=BigInt(1)<<BigInt(62);class _e extends ke{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),cleanup:!0}}createVideoStreamTransformer(){const e=super.createVideoStreamTransformer();return{writable:e.writable,readable:e.readable.pipeThrough(new H.GJ({transform(e,t){"frame"===e.type?(void 0!==e.pts&&e.pts&Pe&&(e.keyframe=!0,e.pts&=~Pe),t.enqueue(e)):t.enqueue(e)}}))}}}class Ce extends _e{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),powerOn:!0}}}class De extends H.Pz{array;index=0;constructor(e){super({start:async()=>{await Promise.resolve(),this.array=e},pull:e=>{this.index<this.array.length?(e.enqueue(this.array[this.index]),this.index+=1):e.close()}})}}class ze extends H.Pz{streams;index=0;reader;constructor(...e){super({start:async t=>{await Promise.resolve(),this.streams=e,this.advance(t)},pull:async e=>{const t=await this.reader.read();t.done?this.advance(e):e.enqueue(t.value)}})}advance(e){this.index<this.streams.length?(this.reader=this.streams[this.index].getReader(),this.index+=1):e.close()}}class Ee{static pushServer(e,t=ce){let n;return new H.BF({start:async()=>(n=await e.sync(),n.write(t)),async close(){await n.dispose()}})}static async start(e,t,n,r){const i=r.createConnection(e);let o;try{await i.initialize(),o=await e.subprocess.spawn([`CLASSPATH=${t}`,"app_process","/","com.genymobile.scrcpy.Server",n,...r.formatServerArguments()],{protocols:[N.vf]});const a=o.stdout.pipeThrough(new H.xU).pipeThrough(new H.Jb("\n")),s=[],c=new H.HS,l=a.pipeTo(new H.Vj({write(e){s.push(e)}}),{signal:c.signal,preventCancel:!0}).catch((()=>{})),d=await Promise.race([o.exit,i.getStreams()]);if("number"===typeof d){const e=new Error("scrcpy server exited prematurely");throw e.output=s,e}c.abort(),await l;const[u,p]=d;return new Ee(r,o,new ze(new De(s),a),u,p)}catch(a){throw await(o?.kill()),a}finally{i.dispose()}}static async getEncoders(e,t,n,r){r.value.encoderName="_",r.value.control=!1,r.value.sendDeviceMeta=!1,r.value.sendDummyByte=!1;const i=await Ee.start(e,t,n,r),o=r.getOutputEncoderNameRegex(),a=[];return await i.stdout.pipeTo(new H.Vj({write(e){const t=e.match(o);t&&a.push(t[1])}})),a}static async getDisplays(e,t,n,r){r.value.displayId=-1,r.value.control=!1,r.value.sendDeviceMeta=!1,r.value.sendDummyByte=!1;try{await Ee.start(e,t,n,r)}catch(i){if(i instanceof Error){const e=i.output,t=/\s+scrcpy --display (\d+)/,n=[];for(const r of e){const e=r.match(t);e&&n.push(Number.parseInt(e[1],10))}return n}}throw new Error("failed to get displays")}process;_stdout;get stdout(){return this._stdout}get exit(){return this.process.exit}_screenWidth;get screenWidth(){return this._screenWidth}_screenHeight;get screenHeight(){return this._screenHeight}_videoStream;get videoStream(){return this._videoStream}_controlMessageSerializer;get controlMessageSerializer(){return this._controlMessageSerializer}_deviceMessageStream;get deviceMessageStream(){return this._deviceMessageStream}constructor(e,t,n,r,i){this.process=t,this._stdout=n,this._videoStream=r.pipeThrough(e.createVideoStreamTransformer()).pipeThrough(new H.N7((e=>{"configuration"===e.type&&(this._screenWidth=e.data.croppedWidth,this._screenHeight=e.data.croppedHeight)}))),i&&(this._controlMessageSerializer=new ne(i.writable,e),this._deviceMessageStream=i.readable.pipeThrough(new oe))}async close(){await this.process.kill()}}var Le,Ie;let Te;!function(e){e[e.Baseline=1]="Baseline",e[e.Main=2]="Main",e[e.Extended=4]="Extended",e[e.High=8]="High",e[e.High10=16]="High10",e[e.High422=32]="High422",e[e.High444=64]="High444",e[e.ConstrainedBaseline=65536]="ConstrainedBaseline",e[e.ConstrainedHigh=524288]="ConstrainedHigh"}(Le=Le||(Le={})),function(e){e[e.Level1=1]="Level1",e[e.Level1b=2]="Level1b",e[e.Level11=4]="Level11",e[e.Level12=8]="Level12",e[e.Level13=16]="Level13",e[e.Level2=32]="Level2",e[e.Level21=64]="Level21",e[e.Level22=128]="Level22",e[e.Level3=256]="Level3",e[e.Level31=512]="Level31",e[e.Level32=1024]="Level32",e[e.Level4=2048]="Level4",e[e.Level41=4096]="Level41",e[e.Level42=8192]="Level42",e[e.Level5=16384]="Level5",e[e.Level51=32768]="Level51",e[e.Level52=65536]="Level52",e[e.Level6=131072]="Level6",e[e.Level61=262144]="Level61",e[e.Level62=524288]="Level62"}(Ie=Ie||(Ie={}));let Me=!1;const je=[];let Ve=0;const Oe=new Map;class Ne extends R.Xn{streamId;pictureReadyEvent=new R.vp;get onPictureReady(){return this.pictureReadyEvent.event}constructor(e){super(),this.streamId=e,this.addDisposable(function(e,t){return Oe.set(e,t),{dispose(){Oe.delete(e)}}}(e,this.handlePictureReady))}handlePictureReady=e=>{this.pictureReadyEvent.fire(e)};feed(e){Te.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),Te.postMessage({type:"release",renderStateId:this.streamId})}}let Re;function Ue(){return Re||(Re=Promise.all([n.e(273).then(n.t.bind(n,7273,19)),n.e(715).then(n.t.bind(n,9715,19))]).then((([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t})))),Re}class He{maxProfile=Le.Baseline;maxLevel=Ie.Level4;_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}_writable;get writable(){return this._writable}_yuvCanvas;_initializer;constructor(){Ue(),this._renderer=document.createElement("canvas"),this._writable=new H.Vj({write:async e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"frame":if(!this._initializer)throw new Error("Decoder not initialized");(await this._initializer.promise).feed(e.data.slice().buffer)}}})}async configure(e){this.dispose(),this._initializer=new U.hP;const{YuvBuffer:t,YuvCanvas:r}=await Ue();this._yuvCanvas||(this._yuvCanvas=r.attach(this._renderer));const{encodedWidth:i,encodedHeight:o}=e,a=i/2,s=o/2;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;const c=t.format({width:i,height:o,chromaWidth:a,chromaHeight:s,cropLeft:e.cropLeft,cropTop:e.cropTop,cropWidth:e.croppedWidth,cropHeight:e.croppedHeight,displayWidth:e.croppedWidth,displayHeight:e.croppedHeight}),l=await function(){if(Te||(Te=new Worker(n.tu(new URL(n.p+n.u(596),n.b))),Te.addEventListener("message",(e=>{const{data:t}=e;switch(t.type){case"decoderReady":Me=!0;for(const e of je)e.resolve(new Ne(Ve)),Ve+=1;je.length=0;break;case"pictureReady":Oe.get(t.renderStateId)?.(t)}}))),!Me){const e=new U.hP;return je.push(e),e.promise}const e=new Ne(Ve);return Ve+=1,Promise.resolve(e)}();this._initializer.resolve(l);const d=i*o,u=d+a*s;l.onPictureReady((({data:e})=>{this._frameRendered+=1;const n=new Uint8Array(e),r=t.frame(c,t.lumaPlane(c,n,i,0),t.chromaPlane(c,n,a,d),t.chromaPlane(c,n,a,u));this._yuvCanvas.drawFrame(r)}))}dispose(){this._initializer?.promise.then((e=>e.dispose())),this._initializer=void 0}}function Be(e){return e.toString(16).padStart(2,"0").toUpperCase()}class Fe{maxProfile=void 0;maxLevel=void 0;_writable;get writable(){return this._writable}_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}context;decoder;lastFrame;animationFrame=0;constructor(){this._renderer=document.createElement("canvas"),this.context=this._renderer.getContext("2d"),this.decoder=new VideoDecoder({output:e=>{this.lastFrame&&this.lastFrame.close(),this.lastFrame=e,this.animationFrame||this.render()},error(){}}),this._writable=new H.Vj({write:async e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"frame":this.decoder.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:e.data}))}}})}render=()=>{this.lastFrame&&(this._frameRendered+=1,this.context.drawImage(this.lastFrame,0,0),this.lastFrame.close(),this.lastFrame=void 0),this.animationFrame=requestAnimationFrame(this.render)};configure(e){const{profileIndex:t,constraintSet:n,levelIndex:r}=e;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;const i=`avc1.${[t,n,r].map(Be).join("")}`;this.decoder.configure({codec:i,optimizeForLatency:!0})}dispose(){cancelAnimationFrame(this.animationFrame),this.decoder.close()}}var Ae,We="1.24",Ze=n(1361),Ge=n(4937),Je=n(8298),qe=new n.U(n(4439)),Ke=function(){function e(t){(0,i.Z)(this,e),this._downloaded=0,this._total=0,this.progressEvent=new R.vp,this.promise=this.fetch(t)}return e.prototype.fetch=function(e){var t=this;return(0,r.Z)(d().mark((function n(){var r,i,o,a,s,c,l,u,p,h,f,v,g;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,window.fetch(e);case 2:r=n.sent,t._total=Number.parseInt(null!==(i=r.headers.get("Content-Length"))&&void 0!==i?i:"0",10),t.progressEvent.fire([t._downloaded,t._total]),o=r.body.getReader(),a=[];case 8:return n.next=11,o.read();case 11:if(!(s=n.sent).done){n.next=14;break}return n.abrupt("break",19);case 14:a.push(s.value),t._downloaded+=s.value.byteLength,t.progressEvent.fire([t._downloaded,t._total]),n.next=8;break;case 19:for(t._total=a.reduce((function(e,t){return e+t.byteLength}),0),c=new Uint8Array(t._total),l=0,u=!0,p=!1,h=void 0,n.prev=23,f=a[Symbol.iterator]();!(u=(v=f.next()).done);u=!0)g=v.value,c.set(g,l),l+=g.byteLength;n.next=31;break;case 27:n.prev=27,n.t0=n.catch(23),p=!0,h=n.t0;case 31:n.prev=31,n.prev=32,u||null==f.return||f.return();case 34:if(n.prev=34,!p){n.next=37;break}throw h;case 37:return n.finish(34);case 38:return n.finish(31);case 39:return n.abrupt("return",c);case 40:case"end":return n.stop()}}),n,null,[[23,27,31,39],[32,,34,38]])})))()},(0,o.Z)(e,[{key:"downloaded",get:function(){return this._downloaded}},{key:"total",get:function(){return this._total}},{key:"onProgress",get:function(){return this.progressEvent.event}}]),e}();function Ye(e){return Ae||(Ae=new Ke(qe)).promise.catch((function(e){Ae=void 0})),e&&(Ae.onProgress(e),e([Ae.downloaded,Ae.total])),Ae.promise}function Xe(e,t,n){return e<t?t:e>n?n:e}var $e=(0,T.Z)({labelRight:{marginLeft:"4px"},video:{transformOrigin:"center center"}}),Qe=(0,j.Pi)((function(e){var t=e.definition,n=e.settings,r=e.onChange,i=$e(),o=(0,u.jsxs)(y.K,{horizontal:!0,verticalAlign:"center",children:[(0,u.jsx)("span",{children:t.label}),!!t.description&&(0,u.jsx)(b.G,{content:t.description,children:(0,u.jsx)(x.J,{className:i.labelRight,iconName:Je.PJ.Info})}),t.labelExtra]});switch(t.type){case"text":return(0,u.jsx)(S.n,{label:o,placeholder:t.placeholder,value:n[t.key],onChange:function(e,n){return r(t.key,n)}});case"dropdown":return(0,u.jsx)(k.L,{label:o,options:t.options,placeholder:t.placeholder,selectedKey:n[t.key],onChange:function(e,n){return r(t.key,n.key)}});case"toggle":return(0,u.jsx)(P.Z,{label:o,checked:n[t.key],onChange:function(e,n){return r(t.key,n)}});case"number":return(0,u.jsx)(_.k,{label:t.label,labelPosition:C.L.top,min:t.min,max:t.max,step:t.step,value:n[t.key].toString(),onChange:function(e,n){return r(t.key,Number.parseInt(n,10))}})}})),et=function(){function e(){var t=this;(0,i.Z)(this,e),this.running=!1,this.deviceView=null,this.rendererContainer=null,this.logVisible=!1,this.log=[],this.settingsVisible=!1,this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotate=0,this.client=void 0,this.encoders=[];var n=this;this.updateEncoders=(0,r.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.pushServer();case 3:return e.next=5,Ee.getEncoders(Ge.q.device,ce,We,new W(new Ce({logLevel:pe.Debug,tunnelForward:n.settings.tunnelForward})));case 5:t=e.sent,(0,M.z)((function(){n.encoders=t,n.settings.encoderName&&n.encoders.includes(n.settings.encoderName)||(n.settings.encoderName=n.encoders[0])})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),Ge.q.showErrorDialog(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])}))),this.decoders=[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:He}],this.decoder=void 0,this.fpsCounterIntervalId=void 0,this.fps=0,this.displays=[];var o=this;this.updateDisplays=(0,r.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.pushServer();case 3:return e.next=5,Ee.getDisplays(Ge.q.device,ce,We,new W(new Ce({logLevel:pe.Debug,tunnelForward:o.settings.tunnelForward})));case 5:t=e.sent,(0,M.z)((function(){o.displays=t,o.settings.displayId&&o.displays.includes(o.settings.displayId)||(o.settings.displayId=o.displays[0])})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),Ge.q.showErrorDialog(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])}))),this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.settings={maxSize:1080,bitRate:4e6,lockVideoOrientation:he.Unlocked,displayId:0,crop:"",powerOn:!0};var l=this;this.start=(0,r.Z)(d().mark((function e(){var t,n,r,i,o,u,p;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ge.q.device){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,l.settings.decoder){e.next=5;break}throw new Error("No available decoder");case 5:return(0,M.z)((function(){l.serverTotalSize=0,l.serverDownloadedSize=0,l.debouncedServerDownloadedSize=0,l.serverUploadedSize=0,l.debouncedServerUploadedSize=0,l.connecting=!0})),t=setInterval((0,M.aD)((function(){l.serverDownloadSpeed=l.serverDownloadedSize-l.debouncedServerDownloadedSize,l.debouncedServerDownloadedSize=l.serverDownloadedSize})),1e3),e.prev=8,e.next=11,Ye((0,M.aD)((function(e){var t=(0,c.Z)(e,2),n=t[0],r=t[1];l.serverDownloadedSize=n,l.serverTotalSize=r})));case 11:n=e.sent,(0,M.z)((function(){l.serverDownloadSpeed=l.serverDownloadedSize-l.debouncedServerDownloadedSize,l.debouncedServerDownloadedSize=l.serverDownloadedSize}));case 13:return e.prev=13,clearInterval(t),e.finish(13);case 16:return t=setInterval((0,M.aD)((function(){l.serverUploadSpeed=l.serverUploadedSize-l.debouncedServerUploadedSize,l.debouncedServerUploadedSize=l.serverUploadedSize})),1e3),e.prev=17,e.next=20,new H.Pz({start:function(e){e.enqueue(n),e.close()}}).pipeThrough(new H.Cc(N.j4)).pipeThrough(new Je.hK((0,M.aD)((function(e){l.serverUploadedSize=e})))).pipeTo(Ee.pushServer(Ge.q.device));case 20:(0,M.z)((function(){l.serverUploadSpeed=l.serverUploadedSize-l.debouncedServerUploadedSize,l.debouncedServerUploadedSize=l.serverUploadedSize}));case 21:return e.prev=21,clearInterval(t),e.finish(21);case 24:return i=null!==(r=l.decoders.find((function(e){return e.key===l.settings.decoder})))&&void 0!==r?r:l.decoders[0],o=new i.Constructor,(0,M.z)((function(){l.decoder=o;var e=0;l.fpsCounterIntervalId=setInterval((0,M.aD)((function(){l.fps=o.frameRendered-e,e=o.frameRendered})),1e3)})),u=new W(new Ce((0,s.Z)((0,a.Z)({logLevel:pe.Debug},l.settings),{sendDeviceMeta:!1,sendDummyByte:!1,codecOptions:l.settings.ignoreDecoderCodecArgs?void 0:new se({profile:o.maxProfile,level:o.maxLevel})}))),(0,M.z)((function(){l.log=[],l.log.push("[client] Server version: ".concat(We)),l.log.push("[client] Server arguments: ".concat(u.formatServerArguments().join(" ")))})),e.next=32,Ee.start(Ge.q.device,ce,We,u);case 32:if((p=e.sent).stdout.pipeTo(new H.Vj({write:(0,M.aD)((function(e){l.log.push(e)}))})),p.videoStream.pipeThrough(new H.N7((0,M.aD)((function(e){if("configuration"===e.type){var t=e.data,n=t.croppedWidth,r=t.croppedHeight;l.log.push("[client] Video size changed: ".concat(n,"x").concat(r)),l.width=n,l.height=r}})))).pipeTo(o.writable).catch((function(){})),p.exit.then(l.dispose),p.deviceMessageStream.pipeTo(new H.Vj({write:function(e){if(e.type===re.Clipboard)window.navigator.clipboard.writeText(e.content)}})).catch((function(){})),!l.settings.turnScreenOff){e.next=40;break}return e.next=40,p.controlMessageSerializer.setScreenPowerMode(ee.Off);case 40:(0,M.z)((function(){l.client=p,l.running=!0})),e.next=46;break;case 43:e.prev=43,e.t0=e.catch(2),Ge.q.showErrorDialog(e.t0);case 46:return e.prev=46,(0,M.z)((function(){l.connecting=!1})),e.finish(46);case 49:case"end":return e.stop()}}),e,null,[[2,43,46,49],[8,,13,16],[17,,21,24]])}))),this.handleBackPointerDown=function(e){t.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),t.client.controlMessageSerializer.backOrScreenOn(G.Down))},this.handleBackPointerUp=function(e){t.client&&0===e.button&&t.client.controlMessageSerializer.backOrScreenOn(G.Up)},this.handleHomePointerDown=function(e){t.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),t.client.controlMessageSerializer.injectKeyCode({action:G.Down,keyCode:J.Home,repeat:0,metaState:0}))},this.handleHomePointerUp=function(e){t.client&&0===e.button&&t.client.controlMessageSerializer.injectKeyCode({action:G.Up,keyCode:J.Home,repeat:0,metaState:0})};var u=this;this.handleAppSwitchPointerDown=function(){var e=(0,r.Z)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.client){e.next=2;break}return e.abrupt("return");case 2:if(0===t.button){e.next=4;break}return e.abrupt("return");case 4:t.currentTarget.setPointerCapture(t.pointerId),u.client.controlMessageSerializer.injectKeyCode({action:G.Down,keyCode:J.AppSwitch,repeat:0,metaState:0});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var p=this;this.handleAppSwitchPointerUp=function(){var e=(0,r.Z)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p.client){e.next=2;break}return e.abrupt("return");case 2:if(0===t.button){e.next=4;break}return e.abrupt("return");case 4:p.client.controlMessageSerializer.injectKeyCode({action:G.Up,keyCode:J.AppSwitch,repeat:0,metaState:0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.injectTouch=function(e,n){if(t.client){var r=t.calculatePointerPosition(n.clientX,n.clientY),i=r.x,o=r.y;t.client.controlMessageSerializer.injectTouch({action:e,pointerId:"mouse"===n.pointerType?BigInt(-1):BigInt(n.pointerId),screenWidth:t.client.screenWidth,screenHeight:t.client.screenHeight,pointerX:i,pointerY:o,pressure:65535*n.pressure,buttons:n.buttons})}},this.handlePointerDown=function(e){t.rendererContainer.focus(),e.preventDefault(),e.currentTarget.setPointerCapture(e.pointerId),t.injectTouch(X.Down,e)},this.handlePointerMove=function(e){t.injectTouch(0===e.buttons?X.HoverMove:X.Move,e)},this.handlePointerUp=function(e){t.injectTouch(X.Up,e)},this.handleWheel=function(e){if(t.client){e.preventDefault(),e.stopPropagation();var n=t.calculatePointerPosition(e.clientX,e.clientY),r=n.x,i=n.y;t.client.controlMessageSerializer.injectScroll({screenWidth:t.client.screenWidth,screenHeight:t.client.screenHeight,pointerX:r,pointerY:i,scrollX:-Math.sign(e.deltaX),scrollY:-Math.sign(e.deltaY),buttons:0})}},this.handleContextMenu=function(e){e.preventDefault()};var h=this;if(this.handleKeyDown=function(){var e=(0,r.Z)(d().mark((function e(t){var n,r,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h.client){e.next=2;break}return e.abrupt("return");case 2:if(n=t.key,r=t.code,!n.match(/^[!-`{-~]$/i)){e.next=6;break}return h.client.controlMessageSerializer.injectText(n),e.abrupt("return");case 6:(i={Backspace:J.Delete,Space:J.Space,Enter:J.Enter}[r])&&(h.client.controlMessageSerializer.injectKeyCode({action:G.Down,keyCode:i,metaState:0,repeat:0}),h.client.controlMessageSerializer.injectKeyCode({action:G.Up,keyCode:i,metaState:0,repeat:0}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(0,M.ky)(this,{decoders:M.LO.shallow,settings:M.LO.deep,start:!1,stop:M.aD.bound,dispose:M.aD.bound,handleDeviceViewRef:M.aD.bound,handleRendererContainerRef:M.aD.bound,handleBackPointerDown:!1,handleBackPointerUp:!1,handleHomePointerDown:!1,handleHomePointerUp:!1,handleAppSwitchPointerDown:!1,handleAppSwitchPointerUp:!1,calculatePointerPosition:!1,injectTouch:!1,handlePointerDown:!1,handlePointerMove:!1,handlePointerUp:!1,handleWheel:!1,handleContextMenu:!1,handleKeyDown:!1}),(0,M.EH)((function(){if(Ge.q.device){var e=t;(0,M.z)((function(){e.encoders=[],e.settings.encoderName=void 0,e.displays=[],e.settings.displayId=void 0}))}else t.dispose()})),(0,M.EH)((function(){if(t.rendererContainer&&t.decoder){for(;t.rendererContainer.firstChild;)t.rendererContainer.firstChild.remove();t.rendererContainer.appendChild(t.decoder.renderer)}})),(0,M.EH)((function(){t.settings.decoder=t.decoders[0].key})),"function"===typeof window.VideoDecoder){var f=this;setTimeout((0,M.aD)((function(){f.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:Fe})})),0)}}var t=e.prototype;return t.pushServer=function(){return(0,r.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ye();case 2:return t=e.sent,e.next=5,new H.Pz({start:function(e){e.enqueue(t),e.close()}}).pipeTo(Ee.pushServer(Ge.q.device));case 5:case"end":return e.stop()}}),e)})))()},t.stop=function(){var e=this;return(0,r.Z)(d().mark((function t(){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,null===(n=e.client)||void 0===n?void 0:n.close();case 3:e.dispose();case 4:case"end":return t.stop()}}),t)})))()},t.dispose=function(){var e;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,this.fps=0,clearTimeout(this.fpsCounterIntervalId),this.client=void 0,this.running=!1},t.handleDeviceViewRef=function(e){this.deviceView=e},t.handleRendererContainerRef=function(e){var t;this.rendererContainer=e,null===(t=this.rendererContainer)||void 0===t||t.addEventListener("wheel",this.handleWheel,{passive:!1})},t.calculatePointerPosition=function(e,t){var n,r=this.rendererContainer.getBoundingClientRect(),i=Xe((e-r.x)/r.width,0,1),o=Xe((t-r.y)/r.height,0,1);1&this.rotate&&(i=(n=[o,i])[0],o=n[1]);switch(this.rotate){case 1:o=1-o;break;case 2:i=1-i,o=1-o;break;case 3:i=1-i}return{x:i*this.width,y:o*this.height}},(0,o.Z)(e,[{key:"rotatedWidth",get:function(){return 1&tt.rotate?tt.height:tt.width}},{key:"rotatedHeight",get:function(){return 1&tt.rotate?tt.width:tt.height}},{key:"commandBarItems",get:function(){var e=this,t=[];return this.running?t.push({key:"stop",iconProps:{iconName:Je.PJ.Stop},text:"Stop",onClick:this.stop}):t.push({key:"start",disabled:!Ge.q.device,iconProps:{iconName:Je.PJ.Play},text:"Start",onClick:this.start}),t.push({key:"fullscreen",disabled:!this.running,iconProps:{iconName:Je.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:function(){var t;null===(t=e.deviceView)||void 0===t||t.enterFullscreen()}}),t.push({key:"rotateDevice",disabled:!this.running,iconProps:{iconName:Je.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:function(){e.client.controlMessageSerializer.rotateDevice()}},{key:"rotateVideoLeft",disabled:!this.running,iconProps:{iconName:Je.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:function(){e.rotate-=1,e.rotate<0&&(e.rotate=3)}},{key:"rotateVideoRight",disabled:!this.running,iconProps:{iconName:Je.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:function(){e.rotate=e.rotate+1&3}}),t.push({key:"turnScreenOff",disabled:!this.running,iconProps:{iconName:Je.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:function(){e.client.controlMessageSerializer.setScreenPowerMode(ee.Off)}},{key:"turnScreenOn",disabled:!this.running,iconProps:{iconName:Je.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:function(){e.client.controlMessageSerializer.setScreenPowerMode(ee.Normal)}}),this.running&&t.push({key:"fps",text:"FPS: ".concat(this.fps),disabled:!0}),t}},{key:"commandBarFarItems",get:function(){var e=this;return[{key:"NavigationBar",iconProps:{iconName:Je.PJ.PanelBottom},checked:this.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,M.aD)((function(){e.navigationBarVisible=!e.navigationBarVisible}))},{key:"Log",iconProps:{iconName:Je.PJ.TextGrammarError},checked:this.logVisible,text:"Log",iconOnly:!0,onClick:(0,M.aD)((function(){e.logVisible=!e.logVisible}))},{key:"Settings",iconProps:{iconName:Je.PJ.Settings},checked:this.settingsVisible,text:"Settings",iconOnly:!0,onClick:(0,M.aD)((function(){e.settingsVisible=!e.settingsVisible}))},{key:"DemoMode",iconProps:{iconName:Je.PJ.Wand},checked:this.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,M.aD)((function(){e.demoModeVisible=!e.demoModeVisible}))},{key:"info",iconProps:{iconName:Je.PJ.Info},iconOnly:!0,tooltipHostProps:{content:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("p",{children:[(0,u.jsx)(Ze.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"developed by Genymobile can display the screen with low latency (1~2 frames) and control the device, all without root access."]}),(0,u.jsx)("p",{children:"This is a TypeScript implementation of the client part. Paired with official pre-built server binary."})]}),calloutProps:{calloutMaxWidth:300}}}]}},{key:"settingDefinitions",get:function(){var e=[];return e.push({key:"powerOn",type:"toggle",label:"Turn device on when starting"},{key:"turnScreenOff",type:"toggle",label:"Turn screen off when starting"},{key:"stayAwake",type:"toggle",label:"Stay awake (if plugged in)"},{key:"powerOffOnClose",type:"toggle",label:"Turn device off when exiting"}),e.push({key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,u.jsx)(D.h,{iconProps:{iconName:Je.PJ.ArrowClockwise},disabled:!Ge.q.device,text:"Refresh",onClick:this.updateDisplays}),options:this.displays.map((function(e){return{key:e,text:e.toString()}}))}),e.push({key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),e.push({key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50}),e.push({key:"bitRate",type:"number",label:"Max Bit Rate",min:100,max:1e8,step:100}),e.push({key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:he.Unlocked,text:"Unlocked"},{key:he.Initial,text:"Current"},{key:he.Portrait,text:"Portrait"},{key:he.Landscape,text:"Landscape"},{key:he.PortraitFlipped,text:"Portrait (Flipped)"},{key:he.LandscapeFlipped,text:"Landscape (Flipped)"}]}),e.push({key:"encoderName",type:"dropdown",label:"Encoder",placeholder:"Press refresh to update available encoders",labelExtra:(0,u.jsx)(D.h,{iconProps:{iconName:Je.PJ.ArrowClockwise},disabled:!Ge.q.device,text:"Refresh",onClick:this.updateEncoders}),options:this.encoders.map((function(e){return{key:e,text:e}}))}),this.decoders.length>1&&e.push({key:"decoder",type:"dropdown",label:"Decoder",options:this.decoders.map((function(e){return{key:e.key,text:e.name,data:e}}))}),e.push({key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore decoder's codec arguments",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({key:"tunnelForward",type:"toggle",label:"Use forward connection",description:"Android before version 9 has a bug that prevents reverse tunneling when using ADB over WiFi."}),e}}]),e}(),tt=new et,nt=(0,j.Pi)((function(){var e=(0,I.M)("layerHost"),t=(0,h.useState)(!1),n=t[0],r=t[1];return(0,h.useEffect)((function(){r(!0)}),[]),n?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(m,{id:e,style:{position:"absolute",top:0,bottom:0,left:0,right:0,margin:0,pointerEvents:"none"}}),(0,u.jsx)(z.V,{hidden:!tt.connecting,modalProps:{layerProps:{hostId:e}},dialogContentProps:{title:"Connecting..."},children:(0,u.jsxs)(y.K,{tokens:Je.WT,children:[(0,u.jsx)(E.Y,{label:"1. Downloading scrcpy server...",percentComplete:tt.serverTotalSize?tt.serverDownloadedSize/tt.serverTotalSize:void 0,description:(0,Je.CY)(tt.debouncedServerDownloadedSize,tt.serverTotalSize,tt.serverDownloadSpeed)}),(0,u.jsx)(E.Y,{label:"2. Pushing scrcpy server to device...",progressHidden:0===tt.serverTotalSize||tt.serverDownloadedSize!==tt.serverTotalSize,percentComplete:tt.serverUploadedSize/tt.serverTotalSize,description:(0,Je.CY)(tt.debouncedServerUploadedSize,tt.serverTotalSize,tt.serverUploadSpeed)}),(0,u.jsx)(E.Y,{label:"3. Starting scrcpy server on device...",progressHidden:0===tt.serverTotalSize||tt.serverUploadedSize!==tt.serverTotalSize})]})})]}):null})),rt=(0,j.Pi)((function(e){var t=e.className,n=e.style,r=e.children;return tt.navigationBarVisible?(0,u.jsxs)(y.K,{className:t,verticalFill:!0,horizontalAlign:"center",style:(0,a.Z)({height:"40px",background:"#999"},n),children:[r,(0,u.jsxs)(y.K,{verticalFill:!0,horizontal:!0,style:{width:"100%",maxWidth:300},horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,u.jsx)(D.h,{iconProps:{iconName:Je.PJ.Play},style:{transform:"rotate(180deg)",color:"white"},onPointerDown:tt.handleBackPointerDown,onPointerUp:tt.handleBackPointerUp}),(0,u.jsx)(D.h,{iconProps:{iconName:Je.PJ.Circle},style:{color:"white"},onPointerDown:tt.handleHomePointerDown,onPointerUp:tt.handleHomePointerUp}),(0,u.jsx)(D.h,{iconProps:{iconName:Je.PJ.Stop},style:{color:"white"},onPointerDown:tt.handleAppSwitchPointerDown,onPointerUp:tt.handleAppSwitchPointerUp})]})]}):(0,u.jsx)("div",{className:t,style:n,children:r})})),it=(0,j.Pi)((function(){var e=$e();return(0,u.jsxs)(y.K,(0,s.Z)((0,a.Z)({},Je.LE),{children:[(0,u.jsx)(O(),{children:(0,u.jsx)("title",{children:"Scrcpy - Android Web Toolbox"})}),(0,u.jsx)(L.X,{items:tt.commandBarItems,farItems:tt.commandBarFarItems}),(0,u.jsxs)(y.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,u.jsx)(Ze.wM,{ref:tt.handleDeviceViewRef,width:tt.rotatedWidth,height:tt.rotatedHeight,BottomElement:rt,children:(0,u.jsx)("div",{ref:tt.handleRendererContainerRef,tabIndex:-1,className:e.video,style:{width:tt.width,height:tt.height,transform:"translate(".concat((tt.rotatedWidth-tt.width)/2,"px, ").concat((tt.rotatedHeight-tt.height)/2,"px) rotate(").concat(90*tt.rotate,"deg)")},onPointerDown:tt.handlePointerDown,onPointerMove:tt.handlePointerMove,onPointerUp:tt.handlePointerUp,onPointerCancel:tt.handlePointerUp,onKeyDown:tt.handleKeyDown,onContextMenu:tt.handleContextMenu})}),(0,u.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:tt.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:tt.log.map((function(e,t){return(0,u.jsx)("div",{children:e},t)}))}),(0,u.jsxs)("div",{style:{padding:12,overflow:"hidden auto",display:tt.settingsVisible?"block":"none",width:300},children:[(0,u.jsx)("div",{children:"Changes will take effect on next connection"}),tt.settingDefinitions.map((function(e){return(0,u.jsx)(Qe,{definition:e,settings:tt.settings,onChange:(0,M.aD)((function(e,t){return tt.settings[e]=t}))},e.key)}))]}),(0,u.jsx)(Ze.bq,{style:{display:tt.demoModeVisible?"block":"none"}}),(0,u.jsx)(nt,{})]})]}))}))},4439:function(e,t,n){"use strict";e.exports=n.p+"static/chunks/scrcpy-server.d406f4d14066a1d3"}},function(e){e.O(0,[455,774,888,179],(function(){return t=7232,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=scrcpy-73154cc52f4c0c96.js.map