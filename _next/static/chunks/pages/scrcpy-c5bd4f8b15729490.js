(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{9305:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return r(7410)}])},4612:function(e,t,r){"use strict";r.d(t,{X:function(){return o}});var i=r(8584),n=r(4120);function o(){let[e,t]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e)return;let t=e.parentElement,r=t.style.flexGrow;return t.style.flexGrow="1",()=>{t.style.flexGrow=r}},[e]),(0,i.jsx)("div",{ref:t})}},7410:function(e,t,r){"use strict";let i,n,o;r.r(t),r.d(t,{default:function(){return rU}});var a,s,l,d,c,u,h,p,m,f,g,y,v,b,w,S,x,L,_,k,E,C,P,D,T,A,M,N,z,O,R,F,I,U,H,j,V,K,B,G,W=r(8584),Y=r(3285),Z=r(5383),X=r(7557),q=r(4812),J=r(6201),$=r(2760),Q=r(958),ee=r(5171),et=r(4071),er=r(84);function*ei(e){let t=-1,r=0,i=!1;for(let n=0;n<e.length;n+=1){let o=e[n];if(i){if(o>3)throw Error("Invalid data");i=!1;continue}if(0===o){r+=1;continue}let a=r;if(r=0,-1===t){if(a>=2&&1===o){t=n+1;continue}throw Error("Invalid data")}if(!(a<2)){if(1===o){yield e.subarray(t,n-a),t=n+1;continue}if(a>2)throw Error("Invalid data");switch(o){case 2:throw Error("Invalid data");case 3:i=!0}}}if(i)throw Error("Invalid data");yield e.subarray(t,e.length)}(a=E||(E={}))[a.Main8=1]="Main8",a[a.Main10=2]="Main10",a[a.Main10Hdr10=4096]="Main10Hdr10",a[a.Main10Hdr10Plus=8192]="Main10Hdr10Plus",(s=C||(C={}))[s.Level2=1]="Level2",s[s.Level21=2]="Level21",s[s.Level22=4]="Level22",s[s.Level23=8]="Level23",s[s.Level3=16]="Level3",s[s.Level31=32]="Level31",s[s.Level32=64]="Level32",s[s.Level33=128]="Level33",s[s.Level4=256]="Level4",s[s.Level41=512]="Level41",s[s.Level42=1024]="Level42",s[s.Level43=2048]="Level43",s[s.Level5=4096]="Level5",s[s.Level51=8192]="Level51",s[s.Level52=16384]="Level52",s[s.Level53=32768]="Level53",s[s.Level6=65536]="Level6",s[s.Level61=131072]="Level61",s[s.Level62=262144]="Level62",s[s.Level63=524288]="Level63",s[s.Level7=1048576]="Level7",s[s.Level71=2097152]="Level71",s[s.Level72=4194304]="Level72",s[s.Level73=8388608]="Level73";class en{_nalu;_byteLength;_stopBitIndex;_zeroCount=0;_bytePosition=-1;_bitPosition=-1;_byte=0;get byteLength(){return this._byteLength}get stopBitIndex(){return this._stopBitIndex}get bytePosition(){return this._bytePosition}get bitPosition(){return this._bitPosition}get ended(){return this._bytePosition===this._byteLength&&this._bitPosition===this._stopBitIndex}constructor(e){this._nalu=e;for(let t=e.length-1;t>=0;t-=1){if(0===this._nalu[t])continue;let r=e[t];for(let e=0;e<8;e+=1)if((r>>e&1)==1){this._byteLength=t,this._stopBitIndex=e,this.readByte();return}}throw Error("End bit not found")}readByte(){if(this._byte=this._nalu[this._bytePosition],2===this._zeroCount&&3===this._byte){this._zeroCount=0,this._bytePosition+=1,this.readByte();return}0===this._byte?this._zeroCount+=1:this._zeroCount=0}next(){if(-1===this._bitPosition&&(this._bitPosition=7,this._bytePosition+=1,this.readByte()),this._bytePosition===this._byteLength&&this._bitPosition===this._stopBitIndex)throw Error("Bit index out of bounds");let e=this._byte>>this._bitPosition&1;return this._bitPosition-=1,e}read(e){if(e>32)throw Error("Read length too large");let t=0;for(let r=0;r<e;r+=1)t=t<<1|this.next();return t}skip(e){for(let t=0;t<e;t+=1)this.next()}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}peek(e){let{_zeroCount:t,_bytePosition:r,_bitPosition:i,_byte:n}=this,o=this.read(e);return Object.assign(this,{_zeroCount:t,_bytePosition:r,_bitPosition:i,_byte:n}),o}readBytes(e){let t=new Uint8Array(e);for(let r=0;r<e;r+=1)t[r]=this.read(8);return t}peekBytes(e){let{_zeroCount:t,_bytePosition:r,_bitPosition:i,_byte:n}=this,o=this.readBytes(e);return Object.assign(this,{_zeroCount:t,_bytePosition:r,_bitPosition:i,_byte:n}),o}}function eo(e){let t,r;for(let i of ei(e)){let e=31&i[0];switch(e){case 7:if(t=i,r)return{sequenceParameterSet:t,pictureParameterSet:r};break;case 8:if(r=i,t)return{sequenceParameterSet:t,pictureParameterSet:r}}}throw Error("Invalid data")}function ea(e){let{sequenceParameterSet:t,pictureParameterSet:r}=eo(e),{profile_idc:i,constraint_set:n,level_idc:o,pic_width_in_mbs_minus1:a,pic_height_in_map_units_minus1:s,frame_mbs_only_flag:l,frame_crop_left_offset:d,frame_crop_right_offset:c,frame_crop_top_offset:u,frame_crop_bottom_offset:h}=function(e){let t,r,i,n;let o=new en(e);if(0!==o.next())throw Error("Invalid data");let a=o.read(2),s=o.read(5);if(7!==s||0===a)throw Error("Invalid data");let l=o.read(8),d=o.peek(8),c=!!o.next(),u=!!o.next(),h=!!o.next(),p=!!o.next(),m=!!o.next(),f=!!o.next();if(0!==o.read(2))throw Error("Invalid data");let g=o.read(8),y=o.decodeExponentialGolombNumber();if(100===l||110===l||122===l||244===l||44===l||83===l||86===l||118===l||128===l||138===l||139===l||134===l){let e=o.decodeExponentialGolombNumber();3===e&&o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber(),o.next();let t=!!o.next();if(t){let t=[];for(let r=0;r<(3!==e?8:12);r+=1)t[r]=!!o.next(),t[r]}}o.decodeExponentialGolombNumber();let v=o.decodeExponentialGolombNumber();if(0===v)o.decodeExponentialGolombNumber();else if(1===v){o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber();let e=o.decodeExponentialGolombNumber(),t=[];for(let r=0;r<e;r+=1)t[r]=o.decodeExponentialGolombNumber()}o.decodeExponentialGolombNumber(),o.next();let b=o.decodeExponentialGolombNumber(),w=o.decodeExponentialGolombNumber(),S=o.next();S||o.next(),o.next();let x=!!o.next();return x?(t=o.decodeExponentialGolombNumber(),r=o.decodeExponentialGolombNumber(),i=o.decodeExponentialGolombNumber(),n=o.decodeExponentialGolombNumber()):(t=0,r=0,i=0,n=0),o.next(),{profile_idc:l,constraint_set:d,constraint_set0_flag:c,constraint_set1_flag:u,constraint_set2_flag:h,constraint_set3_flag:p,constraint_set4_flag:m,constraint_set5_flag:f,level_idc:g,seq_parameter_set_id:y,pic_width_in_mbs_minus1:b,pic_height_in_map_units_minus1:w,frame_mbs_only_flag:S,frame_cropping_flag:x,frame_crop_left_offset:t,frame_crop_right_offset:r,frame_crop_top_offset:i,frame_crop_bottom_offset:n}}(t),p=(a+1)*16,m=(s+1)*(2-l)*16,f=2*d,g=2*c,y=2*u,v=2*h;return{pictureParameterSet:r,sequenceParameterSet:t,profileIndex:i,constraintSet:n,levelIndex:o,encodedWidth:p,encodedHeight:m,cropLeft:f,cropRight:g,cropTop:y,cropBottom:v,croppedWidth:p-f-g,croppedHeight:m-y-v}}function es(e){let t,r,i,n,o,a,s,l;let d=new en(e),c=d.read(4),u=!!d.next(),h=!!d.next(),p=d.read(6),m=d.read(3),f=!!d.next();d.skip(16);let g=ec(d,!0,m),y=!!d.next(),v=[],b=[],w=[];for(let e=y?0:m;e<=m;e+=1)v[e]=d.decodeExponentialGolombNumber(),b[e]=d.decodeExponentialGolombNumber(),w[e]=d.decodeExponentialGolombNumber();let S=d.read(6),x=d.decodeExponentialGolombNumber(),L=[];for(let e=1;e<=x;e+=1){L[e]=[];for(let t=0;t<=S;t+=1)L[e][t]=!!d.next()}let _=!!d.next();if(_){t=d.read(32),r=d.read(32),(i=!!d.next())&&(n=d.decodeExponentialGolombNumber()),o=d.decodeExponentialGolombNumber(),a=[],s=[!0],l=[];for(let e=0;e<o;e+=1)a[e]=d.decodeExponentialGolombNumber(),e>0&&(s[e]=!!d.next()),l[e]=function(e,t,r){let i,n,o,a,s,l,d,c,u,h,p,m,f;t&&(i=!!e.next(),n=!!e.next(),(i||n)&&((o=!!e.next())&&(a=e.read(8),s=e.read(5),l=!!e.next(),d=e.read(5)),c=e.read(4),u=e.read(4),o&&(h=e.read(4)),p=e.read(5),m=e.read(5),f=e.read(5)));let g=[],y=[],v=[],b=[],w=[],S=[],x=[];for(let t=0;t<=r;t+=1){var L,_;g[t]=!!e.next(),g[t]||(y[t]=!!e.next()),y[t]?v[t]=e.decodeExponentialGolombNumber():b[t]=!!e.next(),b[t]||(w[t]=e.decodeExponentialGolombNumber()),i&&(S[t]=eu(e,t,(L=w[t])+1)),n&&(x[t]=eu(e,t,(_=w[t])+1))}return{nal_hrd_parameters_present_flag:i,vcl_hrd_parameters_present_flag:n,sub_pic_hrd_params_present_flag:o,tick_divisor_minus2:a,du_cpb_removal_delay_increment_length_minus1:s,sub_pic_cpb_params_in_pic_timing_sei_flag:l,dpb_output_delay_du_length_minus1:d,bit_rate_scale:c,cpb_size_scale:u,cpb_size_du_scale:h,initial_cpb_removal_delay_length_minus1:p,au_cpb_removal_delay_length_minus1:m,dpb_output_delay_length_minus1:f,fixed_pic_rate_general_flag:g,fixed_pic_rate_within_cvs_flag:y,elemental_duration_in_tc_minus1:v,low_delay_hrd_flag:b,cpb_cnt_minus1:w,nalHrdParameters:S,vclHrdParameters:x}}(d,s[e],m)}let k=!!d.next();return{vps_video_parameter_set_id:c,vps_base_layer_internal_flag:u,vps_base_layer_available_flag:h,vps_max_layers_minus1:p,vps_max_sub_layers_minus1:m,vps_temporal_id_nesting_flag:f,profileTierLevel:g,vps_sub_layer_ordering_info_present_flag:y,vps_max_dec_pic_buffering_minus1:v,vps_max_num_reorder_pics:b,vps_max_latency_increase_plus1:w,vps_max_layer_id:S,vps_num_layer_sets_minus1:x,layer_id_included_flag:L,vps_timing_info_present_flag:_,vps_num_units_in_tick:t,vps_time_scale:r,vps_poc_proportional_to_timing_flag:i,vps_num_ticks_poc_diff_one_minus1:n,vps_num_hrd_parameters:o,hrd_layer_set_idx:a,cprms_present_flag:s,hrdParameters:l,vps_extension_flag:k}}function el(e){let t,r,i,n,o,a,s,l,d,c,u,h,p,m,f,g,y,v,b,w,S,x,L,_,k,E,C;let P=new en(e),D=P.read(4),T=P.read(3),A=!!P.next(),M=ec(P,!0,T),N=P.decodeExponentialGolombNumber(),z=P.decodeExponentialGolombNumber();3===z&&(t=!!P.next());let O=P.decodeExponentialGolombNumber(),R=P.decodeExponentialGolombNumber(),F=!!P.next();F&&(r=P.decodeExponentialGolombNumber(),i=P.decodeExponentialGolombNumber(),n=P.decodeExponentialGolombNumber(),o=P.decodeExponentialGolombNumber());let I=P.decodeExponentialGolombNumber(),U=P.decodeExponentialGolombNumber(),H=P.decodeExponentialGolombNumber(),j=!!P.next();for(let e=j?0:T;e<=T;e+=1){a=[],s=[],l=[];for(let e=0;e<=T;e+=1)a[e]=P.decodeExponentialGolombNumber(),s[e]=P.decodeExponentialGolombNumber(),l[e]=P.decodeExponentialGolombNumber()}let V=P.decodeExponentialGolombNumber(),K=P.decodeExponentialGolombNumber(),B=P.decodeExponentialGolombNumber(),G=P.decodeExponentialGolombNumber(),W=P.decodeExponentialGolombNumber(),Y=P.decodeExponentialGolombNumber(),Z=!!P.next();Z&&(d=!!P.next())&&(c=function(e){let t=[];for(let r=0;r<4;r+=1){t[r]=[];for(let i=0;i<6;i+=3===r?3:1){let n=!!e.next();if(n){let n=8,o=Math.min(64,1<<4+(r<<1));if(r>1){let t=e.decodeExponentialGolombNumber();n=t+8}t[r][i]=[];for(let a=0;a<o;a+=1){let o=e.decodeExponentialGolombNumber();n=(n+o+256)%256,t[r][i][a]=n}}else e.decodeExponentialGolombNumber()}}return t}(P));let X=!!P.next(),q=!!P.next(),J=!!P.next();J&&(u=P.read(4),h=P.read(4),p=P.read(4),m=P.read(4),f=!!P.next());let $=P.decodeExponentialGolombNumber(),Q=[];for(let e=0;e<$;e+=1)Q[e]=function(e,t,r,i){let n=!1;0!==t&&(n=!!e.next());let o=0,a=!1,s=0,l=[],d=[],c=0,u=0,h=[],p=[],m=[],f=[];if(n){t===r&&(o=e.decodeExponentialGolombNumber()),a=!!e.next(),s=e.decodeExponentialGolombNumber();let n=t-(o+1),g=i[n],y=g.num_negative_pics+g.num_positive_pics;for(let t=0;t<=y;t+=1)l[t]=!!e.next(),l[t]?d[t]=!0:d[t]=!!e.next();let v=(1-2*Number(a))*(s+1),b=[],w=[],S=[],x=[],L=0;for(let e=0;e<g.num_negative_pics;e+=1)L-=g.delta_poc_s0_minus1[e]+1,b[e]=L;L=0;for(let e=0;e<g.num_positive_pics;e+=1)L+=g.delta_poc_s1_minus1[e]+1,w[e]=L;let _=0;if(g.num_positive_pics>0)for(let e=g.num_positive_pics-1;e>=0;e-=1)(L=w[e]+v)<0&&d[g.num_negative_pics+e]&&(S[_]=L,p[_]=l[g.num_negative_pics+e],_+=1);v<0&&d[y]&&(S[_]=v,p[_]=l[y],_+=1);for(let e=0;e<g.num_negative_pics;e+=1)(L=b[e]+v)<0&&d[e]&&(S[_]=L,p[_]=l[e],_+=1);c=_;let k=0;for(_=0;_<c;_+=1){let e=S[_];h[_]=-(e-k-1),k=e}if(_=0,g.num_negative_pics>0)for(let e=g.num_negative_pics-1;e>=0;e-=1)(L=b[e]+v)>0&&d[e]&&(x[_]=L,f[_]=l[e],_+=1);v>0&&d[y]&&(x[_]=v,f[_]=l[y],_+=1);for(let e=0;e<g.num_positive_pics;e+=1)(L=w[e]+v)>0&&d[g.num_negative_pics+e]&&(x[_]=L,f[_]=l[g.num_negative_pics+e],_+=1);for(u=_,k=0,_=0;_<u;_+=1){let e=x[_];m[_]=e-k-1,k=e}}else{c=e.decodeExponentialGolombNumber(),u=e.decodeExponentialGolombNumber();for(let t=0;t<c;t+=1)h[t]=e.decodeExponentialGolombNumber(),p[t]=!!e.next();for(let t=0;t<u;t+=1)m[t]=e.decodeExponentialGolombNumber(),f[t]=!!e.next()}return{stRpsIdx:t,num_short_term_ref_pic_sets:r,inter_ref_pic_set_prediction_flag:n,delta_idx_minus1:o,delta_rps_sign:a,abs_delta_rps_minus1:s,used_by_curr_pic_flag:l,use_delta_flag:d,num_negative_pics:c,num_positive_pics:u,delta_poc_s0_minus1:h,used_by_curr_pic_s0_flag:p,delta_poc_s1_minus1:m,used_by_curr_pic_s1_flag:f}}(P,e,$,Q);let ee=!!P.next();if(ee){g=P.decodeExponentialGolombNumber(),y=[],v=[];for(let e=0;e<g;e+=1)y[e]=P.read(H+4),v[e]=!!P.next()}let et=!!P.next(),er=!!P.next(),ei=!!P.next();ei&&(b=function(e){let t,r,i,n,o,a,s,l,d,c,u,h,p,m,f,g,y,v,b,w,S,x,L,_,k,E,C,P,D;let T=!!e.next();T&&255===(t=e.read(8))&&(r=e.read(16),i=e.read(16));let A=!!e.next();A&&(n=!!e.next());let M=!!e.next();M&&(o=e.read(3),a=!!e.next(),(s=!!e.next())&&(l=e.read(8),d=e.read(8),c=e.read(8)));let N=!!e.next();N&&(u=e.decodeExponentialGolombNumber(),h=e.decodeExponentialGolombNumber());let z=!!e.next(),O=!!e.next(),R=!!e.next(),F=!!e.next();F&&(p=e.decodeExponentialGolombNumber(),m=e.decodeExponentialGolombNumber(),f=e.decodeExponentialGolombNumber(),g=e.decodeExponentialGolombNumber());let I=!!e.next();if(I&&(y=e.read(32),v=e.read(32),(b=!!e.next())&&(w=e.decodeExponentialGolombNumber()),S=!!e.next()))throw Error("Not implemented");let U=!!e.next();return U&&(x=!!e.next(),L=!!e.next(),_=!!e.next(),k=e.decodeExponentialGolombNumber(),E=e.decodeExponentialGolombNumber(),C=e.decodeExponentialGolombNumber(),P=e.decodeExponentialGolombNumber(),D=e.decodeExponentialGolombNumber()),{aspect_ratio_info_present_flag:T,aspect_ratio_idc:t,sar_width:r,sar_height:i,overscan_info_present_flag:A,overscan_appropriate_flag:n,video_signal_type_present_flag:M,video_format:o,video_full_range_flag:a,colour_description_present_flag:s,colour_primaries:l,transfer_characteristics:d,matrix_coeffs:c,chroma_loc_info_present_flag:N,chroma_sample_loc_type_top_field:u,chroma_sample_loc_type_bottom_field:h,neutral_chroma_indication_flag:z,field_seq_flag:O,frame_field_info_present_flag:R,default_display_window_flag:F,def_disp_win_left_offset:p,def_disp_win_right_offset:m,def_disp_win_top_offset:f,def_disp_win_bottom_offset:g,vui_timing_info_present_flag:I,vui_num_units_in_tick:y,vui_time_scale:v,vui_poc_proportional_to_timing_flag:b,vui_num_ticks_poc_diff_one_minus1:w,vui_hrd_parameters_present_flag:S,bitstream_restriction_flag:U,tiles_fixed_structure_flag:x,motion_vectors_over_pic_boundaries_flag:L,restricted_ref_pic_lists_flag:_,min_spatial_segmentation_idc:k,max_bytes_per_pic_denom:E,max_bits_per_min_cu_denom:C,log2_max_mv_length_horizontal:P,log2_max_mv_length_vertical:D}}(P));let eo=!!P.next();if(eo&&(w=!!P.next(),S=!!P.next(),x=!!P.next(),L=!!P.next(),_=P.read(4)),w||(S&&(k=function(e){let t=!!e.next();return{inter_view_mv_vert_constraint_flag:t}}(P)),x&&(E=function(e){let t=[],r=[];t[0]=!!e.next(),r[0]=!!e.next();let i=e.decodeExponentialGolombNumber(),n=!!e.next(),o=!!e.next(),a=!!e.next(),s=!!e.next();t[1]=!!e.next(),r[1]=!!e.next();let l=!!e.next(),d=e.decodeExponentialGolombNumber(),c=!!e.next(),u=!!e.next(),h=!!e.next(),p=!!e.next(),m=!!e.next();return{iv_di_mc_enabled_flag:t,iv_mv_scal_enabled_flag:r,log2_ivmc_sub_pb_size_minus3:i,iv_res_pred_enabled_flag:n,depth_ref_enabled_flag:o,vsp_mc_enabled_flag:a,dbbp_enabled_flag:s,tex_mc_enabled_flag:l,log2_texmc_sub_pb_size_minus3:d,intra_contour_enabled_flag:c,intra_dc_only_wedge_enabled_flag:u,cqt_cu_part_pred_enabled_flag:h,inter_dc_only_enabled_flag:p,skip_intra_enabled_flag:m}}(P)),L))throw Error("Not implemented");if(_){C=[];let e=0;for(;!P.ended;)C[e]=!!P.next(),e+=1}return{sps_video_parameter_set_id:D,sps_max_sub_layers_minus1:T,sps_temporal_id_nesting_flag:A,profileTierLevel:M,sps_seq_parameter_set_id:N,chroma_format_idc:z,separate_colour_plane_flag:t,pic_width_in_luma_samples:O,pic_height_in_luma_samples:R,conformance_window_flag:F,conf_win_left_offset:r,conf_win_right_offset:i,conf_win_top_offset:n,conf_win_bottom_offset:o,bit_depth_luma_minus8:I,bit_depth_chroma_minus8:U,log2_max_pic_order_cnt_lsb_minus4:H,sps_sub_layer_ordering_info_present_flag:j,sps_max_dec_pic_buffering_minus1:a,sps_max_num_reorder_pics:s,sps_max_latency_increase_plus1:l,log2_min_luma_coding_block_size_minus3:V,log2_diff_max_min_luma_coding_block_size:K,log2_min_luma_transform_block_size_minus2:B,log2_diff_max_min_luma_transform_block_size:G,max_transform_hierarchy_depth_inter:W,max_transform_hierarchy_depth_intra:Y,scaling_list_enabled_flag:Z,sps_scaling_list_data_present_flag:d,scalingListData:c,amp_enabled_flag:X,sample_adaptive_offset_enabled_flag:q,pcm_enabled_flag:J,pcm_sample_bit_depth_luma_minus1:u,pcm_sample_bit_depth_chroma_minus1:h,log2_min_pcm_luma_coding_block_size_minus3:p,log2_diff_max_min_pcm_luma_coding_block_size:m,pcm_loop_filter_disabled_flag:f,num_short_term_ref_pic_sets:$,shortTermRefPicSets:Q,long_term_ref_pics_present_flag:ee,num_long_term_ref_pics_sps:g,lt_ref_pic_poc_lsb_sps:y,used_by_curr_pic_lt_sps_flag:v,sps_temporal_mvp_enabled_flag:et,strong_intra_smoothing_enabled_flag:er,vui_parameters_present_flag:ei,vuiParameters:b,sps_extension_present_flag:eo,sps_range_extension_flag:w,sps_multilayer_extension_flag:S,sps_3d_extension_flag:x,sps_scc_extension_flag:L,sps_extension_4bits:_,spsMultilayerExtension:k,sps3dExtension:E,sps_extension_data_flag:C}}function ed(e){let t,r,i,n,o,a,s,l,d,c,u;let h=e.read(2),p=!!e.next(),m=e.read(5),f=e.peekBytes(4),g=[];for(let t=0;t<32;t+=1)g[t]=!!e.next();let y=e.peekBytes(6),v=!!e.next(),b=!!e.next(),w=!!e.next(),S=!!e.next();return 4===m||g[4]||5===m||g[5]||6===m||g[6]||7===m||g[7]||8===m||g[8]||9===m||g[9]||10===m||g[10]||11===m||g[11]?(t=!!e.next(),r=!!e.next(),i=!!e.next(),n=!!e.next(),o=!!e.next(),a=!!e.next(),s=!!e.next(),l=!!e.next(),d=!!e.next(),5===m||g[5]||9===m||g[9]||10===m||g[10]||11===m||g[11]?(c=!!e.next(),e.skip(33)):e.skip(34)):2===m||g[2]?(e.skip(7),l=!!e.next(),e.skip(35)):e.skip(43),1===m||g[1]||2===m||g[2]||3===m||g[3]||4===m||g[4]||5===m||g[5]||9===m||g[9]||11===m||g[11]?u=!!e.next():e.skip(1),{profile_space:h,tier_flag:p,profile_idc:m,profileCompatibilitySet:f,profile_compatibility_flag:g,constraintSet:y,progressive_source_flag:v,interlaced_source_flag:b,non_packed_constraint_flag:w,frame_only_constraint_flag:S,max_12bit_constraint_flag:t,max_10bit_constraint_flag:r,max_8bit_constraint_flag:i,max_422chroma_constraint_flag:n,max_420chroma_constraint_flag:o,max_monochrome_constraint_flag:a,intra_constraint_flag:s,one_picture_only_constraint_flag:l,lower_bit_rate_constraint_flag:d,max_14bit_constraint_flag:c,inbld_flag:u}}function ec(e,t,r){let i;t&&(i=ed(e));let n=e.read(8),o=[],a=[];for(let t=0;t<r;t+=1)o[t]=!!e.next(),a[t]=!!e.next();if(r>0)for(let t=r;t<8;t+=1)e.read(2);let s=[],l=[];for(let t=0;t<r;t+=1)o[t]&&(s[t]=ed(e)),a[t]&&(l[t]=e.read(8));return{generalProfileTier:i,general_level_idc:n,sub_layer_profile_present_flag:o,sub_layer_level_present_flag:a,subLayerProfileTier:s,sub_layer_level_idc:l}}function eu(e,t,r){let i=[],n=[],o=[];for(let a=0;a<r;a+=1)i[a]=e.decodeExponentialGolombNumber(),n[a]=e.decodeExponentialGolombNumber(),t>0&&(o[a]=!!e.next());return{bit_rate_value_minus1:i,cpb_size_value_minus1:n,cpb_size_du_value_minus1:[],bit_rate_du_value_minus1:[],cbr_flag:o}}function eh(e){let t,r,i;let n=0;for(let o of ei(e)){let e=function(e){let t=new en(e);if(0!==t.next())throw Error("Invalid NALU header");let r=t.read(6),i=t.read(6),n=t.read(3);return{nal_unit_type:r,nuh_layer_id:i,nuh_temporal_id_plus1:n}}(o),a={...e,data:o,rbsp:o.subarray(2)};switch(e.nal_unit_type){case 32:t=a;break;case 33:r=a;break;case 34:i=a;break;default:continue}if(3===(n+=1))return{videoParameterSet:t,sequenceParameterSet:r,pictureParameterSet:i}}throw Error("Invalid data")}function ep(e){let{videoParameterSet:t,sequenceParameterSet:r,pictureParameterSet:i}=eh(e),{profileTierLevel:{generalProfileTier:{profile_space:n,tier_flag:o,profile_idc:a,profileCompatibilitySet:s,constraintSet:l},general_level_idc:d}}=es(t.rbsp),{chroma_format_idc:c,pic_width_in_luma_samples:u,pic_height_in_luma_samples:h,conf_win_left_offset:p=0,conf_win_right_offset:m=0,conf_win_top_offset:f=0,conf_win_bottom_offset:g=0}=el(r.rbsp),y=function(e){switch(e){case 0:case 3:return 1;case 1:case 2:return 2;default:throw Error("Invalid chroma_format_idc")}}(c),v=function(e){switch(e){case 0:case 2:case 3:return 1;case 1:return 2;default:throw Error("Invalid chroma_format_idc")}}(c);return{videoParameterSet:t,sequenceParameterSet:r,pictureParameterSet:i,generalProfileSpace:n,generalProfileIndex:a,generalProfileCompatibilitySet:s,generalTierFlag:o,generalLevelIndex:d,generalConstraintSet:l,encodedWidth:u,encodedHeight:h,cropLeft:p,cropRight:m,cropTop:f,cropBottom:g,croppedWidth:u-y*(p+m),croppedHeight:h-v*(f+g)}}(l=P||(P={}))[l.Baseline=1]="Baseline",l[l.Main=2]="Main",l[l.Extended=4]="Extended",l[l.High=8]="High",l[l.High10=16]="High10",l[l.High422=32]="High422",l[l.High444=64]="High444",l[l.ConstrainedBaseline=65536]="ConstrainedBaseline",l[l.ConstrainedHigh=524288]="ConstrainedHigh",(d=D||(D={}))[d.Level1=1]="Level1",d[d.Level1b=2]="Level1b",d[d.Level11=4]="Level11",d[d.Level12=8]="Level12",d[d.Level13=16]="Level13",d[d.Level2=32]="Level2",d[d.Level21=64]="Level21",d[d.Level22=128]="Level22",d[d.Level3=256]="Level3",d[d.Level31=512]="Level31",d[d.Level32=1024]="Level32",d[d.Level4=2048]="Level4",d[d.Level41=4096]="Level41",d[d.Level42=8192]="Level42",d[d.Level5=16384]="Level5",d[d.Level51=32768]="Level51",d[d.Level52=65536]="Level52",d[d.Level6=131072]="Level6",d[d.Level61=262144]="Level61",d[d.Level62=524288]="Level62",(c=T||(T={}))[c.Main=1]="Main",c[c.Main10=2]="Main10",c[c.MainStill=4]="MainStill",c[c.Main10Hdr10=4096]="Main10Hdr10",c[c.Main10Hdr10Plus=8192]="Main10Hdr10Plus",(u=A||(A={}))[u.MainTierLevel1=1]="MainTierLevel1",u[u.HighTierLevel1=2]="HighTierLevel1",u[u.MainTierLevel2=4]="MainTierLevel2",u[u.HighTierLevel2=8]="HighTierLevel2",u[u.MainTierLevel21=16]="MainTierLevel21",u[u.HighTierLevel21=32]="HighTierLevel21",u[u.MainTierLevel3=64]="MainTierLevel3",u[u.HighTierLevel3=128]="HighTierLevel3",u[u.MainTierLevel31=256]="MainTierLevel31",u[u.HighTierLevel31=512]="HighTierLevel31",u[u.MainTierLevel4=1024]="MainTierLevel4",u[u.HighTierLevel4=2048]="HighTierLevel4",u[u.MainTierLevel41=4096]="MainTierLevel41",u[u.HighTierLevel41=8192]="HighTierLevel41",u[u.MainTierLevel5=16384]="MainTierLevel5",u[u.HighTierLevel5=32768]="HighTierLevel5",u[u.MainTierLevel51=65536]="MainTierLevel51",u[u.HighTierLevel51=131072]="HighTierLevel51",u[u.MainTierLevel52=262144]="MainTierLevel52",u[u.HighTierLevel52=524288]="HighTierLevel52",u[u.MainTierLevel6=1048576]="MainTierLevel6",u[u.HighTierLevel6=2097152]="HighTierLevel6",u[u.MainTierLevel61=4194304]="MainTierLevel61",u[u.HighTierLevel61=8388608]="HighTierLevel61",u[u.MainTierLevel62=16777216]="MainTierLevel62",u[u.HighTierLevel62=33554432]="HighTierLevel62";var em=r(4959);let ef=new em.AU().uint8("type");(h=M||(M={}))[h.Down=0]="Down",h[h.Up=1]="Up",h[h.Move=2]="Move",h[h.Cancel=3]="Cancel",h[h.Outside=4]="Outside",h[h.PointerDown=5]="PointerDown",h[h.PointerUp=6]="PointerUp",h[h.HoverMove=7]="HoverMove",h[h.Scroll=8]="Scroll",h[h.HoverEnter=9]="HoverEnter",h[h.HoverExit=10]="HoverExit",h[h.ButtonPress=11]="ButtonPress",h[h.ButtonRelease=12]="ButtonRelease",(p=N||(N={}))[p.Primary=1]="Primary",p[p.Secondary=2]="Secondary",p[p.Tertiary=4]="Tertiary",p[p.Back=8]="Back",p[p.Forward=16]="Forward",p[p.StylusPrimary=32]="StylusPrimary",p[p.StylusSecondary=64]="StylusSecondary",(m=z||(z={})).Mouse=-1n,m.Finger=-2n,m.VirtualMouse=-3n,m.VirtualFinger=-4n,(f=O||(O={}))[f.InjectKeyCode=0]="InjectKeyCode",f[f.InjectText=1]="InjectText",f[f.InjectTouch=2]="InjectTouch",f[f.InjectScroll=3]="InjectScroll",f[f.BackOrScreenOn=4]="BackOrScreenOn",f[f.ExpandNotificationPanel=5]="ExpandNotificationPanel",f[f.ExpandSettingPanel=6]="ExpandSettingPanel",f[f.CollapseNotificationPanel=7]="CollapseNotificationPanel",f[f.GetClipboard=8]="GetClipboard",f[f.SetClipboard=9]="SetClipboard",f[f.SetScreenPowerMode=10]="SetScreenPowerMode",f[f.RotateDevice=11]="RotateDevice";class eg{types;constructor(e){this.types=e.controlMessageTypes}get(e){let t=this.types.indexOf(e);if(-1===t)throw Error("Not supported");return t}fillMessageType(e,t){return e.type=this.get(t),e}}class ey{lastHoverMessage;process(e){let t=[];return this.lastHoverMessage&&this.lastHoverMessage.pointerId!==e.pointerId&&(t.push({...this.lastHoverMessage,action:M.Up}),this.lastHoverMessage=void 0),e.action===M.HoverMove&&(this.lastHoverMessage=e),e.type=O.InjectTouch,t.push(e),t}}(g=R||(R={}))[g.Down=0]="Down",g[g.Up=1]="Up",(y=F||(F={}))[y.AltOn=2]="AltOn",y[y.AltLeftOn=16]="AltLeftOn",y[y.AltRightOn=32]="AltRightOn",y[y.ShiftOn=1]="ShiftOn",y[y.ShiftLeftOn=64]="ShiftLeftOn",y[y.ShiftRightOn=128]="ShiftRightOn",y[y.CtrlOn=4096]="CtrlOn",y[y.CtrlLeftOn=8192]="CtrlLeftOn",y[y.CtrlRightOn=16384]="CtrlRightOn",y[y.MetaOn=65536]="MetaOn",y[y.MetaLeftOn=131072]="MetaLeftOn",y[y.MetaRightOn=262144]="MetaRightOn",y[y.CapsLockOn=1048576]="CapsLockOn",y[y.NumLockOn=2097152]="NumLockOn",y[y.ScrollLockOn=4194304]="ScrollLockOn",(v=I||(I={}))[v.AndroidHome=3]="AndroidHome",v[v.AndroidBack=4]="AndroidBack",v[v.AndroidCall=5]="AndroidCall",v[v.AndroidEndCall=6]="AndroidEndCall",v[v.Digit0=7]="Digit0",v[v.Digit1=8]="Digit1",v[v.Digit2=9]="Digit2",v[v.Digit3=10]="Digit3",v[v.Digit4=11]="Digit4",v[v.Digit5=12]="Digit5",v[v.Digit6=13]="Digit6",v[v.Digit7=14]="Digit7",v[v.Digit8=15]="Digit8",v[v.Digit9=16]="Digit9",v[v.Star=17]="Star",v[v.Pound=18]="Pound",v[v.ArrowUp=19]="ArrowUp",v[v.ArrowDown=20]="ArrowDown",v[v.ArrowLeft=21]="ArrowLeft",v[v.ArrowRight=22]="ArrowRight",v[v.AndroidDPadCenter=23]="AndroidDPadCenter",v[v.VolumeUp=24]="VolumeUp",v[v.VolumeDown=25]="VolumeDown",v[v.Power=26]="Power",v[v.AndroidCamera=27]="AndroidCamera",v[v.Clear=28]="Clear",v[v.KeyA=29]="KeyA",v[v.KeyB=30]="KeyB",v[v.KeyC=31]="KeyC",v[v.KeyD=32]="KeyD",v[v.KeyE=33]="KeyE",v[v.KeyF=34]="KeyF",v[v.KeyG=35]="KeyG",v[v.KeyH=36]="KeyH",v[v.KeyI=37]="KeyI",v[v.KeyJ=38]="KeyJ",v[v.KeyK=39]="KeyK",v[v.KeyL=40]="KeyL",v[v.KeyM=41]="KeyM",v[v.KeyN=42]="KeyN",v[v.KeyO=43]="KeyO",v[v.KeyP=44]="KeyP",v[v.KeyQ=45]="KeyQ",v[v.KeyR=46]="KeyR",v[v.KeyS=47]="KeyS",v[v.KeyT=48]="KeyT",v[v.KeyU=49]="KeyU",v[v.KeyV=50]="KeyV",v[v.KeyW=51]="KeyW",v[v.KeyX=52]="KeyX",v[v.KeyY=53]="KeyY",v[v.KeyZ=54]="KeyZ",v[v.Comma=55]="Comma",v[v.Period=56]="Period",v[v.AltLeft=57]="AltLeft",v[v.AltRight=58]="AltRight",v[v.ShiftLeft=59]="ShiftLeft",v[v.ShiftRight=60]="ShiftRight",v[v.Tab=61]="Tab",v[v.Space=62]="Space",v[v.AndroidSymbol=63]="AndroidSymbol",v[v.AndroidExplorer=64]="AndroidExplorer",v[v.AndroidEnvelope=65]="AndroidEnvelope",v[v.Enter=66]="Enter",v[v.Backspace=67]="Backspace",v[v.Backquote=68]="Backquote",v[v.Minus=69]="Minus",v[v.Equal=70]="Equal",v[v.BracketLeft=71]="BracketLeft",v[v.BracketRight=72]="BracketRight",v[v.Backslash=73]="Backslash",v[v.Semicolon=74]="Semicolon",v[v.Quote=75]="Quote",v[v.Slash=76]="Slash",v[v.At=77]="At",v[v.AndroidNum=78]="AndroidNum",v[v.AndroidHeadsetHook=79]="AndroidHeadsetHook",v[v.AndroidFocus=80]="AndroidFocus",v[v.Plus=81]="Plus",v[v.ContextMenu=82]="ContextMenu",v[v.AndroidNotification=83]="AndroidNotification",v[v.AndroidSearch=84]="AndroidSearch",v[v.PageUp=92]="PageUp",v[v.PageDown=93]="PageDown",v[v.Escape=111]="Escape",v[v.Delete=112]="Delete",v[v.ControlLeft=113]="ControlLeft",v[v.ControlRight=114]="ControlRight",v[v.CapsLock=115]="CapsLock",v[v.ScrollLock=116]="ScrollLock",v[v.MetaLeft=117]="MetaLeft",v[v.MetaRight=118]="MetaRight",v[v.AndroidFunction=119]="AndroidFunction",v[v.PrintScreen=120]="PrintScreen",v[v.Pause=121]="Pause",v[v.Home=122]="Home",v[v.End=123]="End",v[v.Insert=124]="Insert",v[v.AndroidForward=125]="AndroidForward",v[v.F1=131]="F1",v[v.F2=132]="F2",v[v.F3=133]="F3",v[v.F4=134]="F4",v[v.F5=135]="F5",v[v.F6=136]="F6",v[v.F7=137]="F7",v[v.F8=138]="F8",v[v.F9=139]="F9",v[v.F10=140]="F10",v[v.F11=141]="F11",v[v.F12=142]="F12",v[v.NumLock=143]="NumLock",v[v.Numpad0=144]="Numpad0",v[v.Numpad1=145]="Numpad1",v[v.Numpad2=146]="Numpad2",v[v.Numpad3=147]="Numpad3",v[v.Numpad4=148]="Numpad4",v[v.Numpad5=149]="Numpad5",v[v.Numpad6=150]="Numpad6",v[v.Numpad7=151]="Numpad7",v[v.Numpad8=152]="Numpad8",v[v.Numpad9=153]="Numpad9",v[v.NumpadDivide=154]="NumpadDivide",v[v.NumpadMultiply=155]="NumpadMultiply",v[v.NumpadSubtract=156]="NumpadSubtract",v[v.NumpadAdd=157]="NumpadAdd",v[v.NumpadDecimal=158]="NumpadDecimal",v[v.NumpadComma=159]="NumpadComma",v[v.NumpadEnter=160]="NumpadEnter",v[v.NumpadEquals=161]="NumpadEquals",v[v.NumpadLeftParen=162]="NumpadLeftParen",v[v.NumpadRightParen=163]="NumpadRightParen",v[v.VolumeMute=164]="VolumeMute",v[v.AndroidAppSwitch=187]="AndroidAppSwitch",v[v.AndroidCut=277]="AndroidCut",v[v.AndroidCopy=278]="AndroidCopy",v[v.AndroidPaste=279]="AndroidPaste";let ev=new em.ZP().uint8("type").uint8("action",(0,em.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState"),eb=new em.ZP().uint8("type").uint32("length").string("text",{lengthField:"length"});(b=U||(U={}))[b.Off=0]="Off",b[b.Normal=2]="Normal";let ew=new em.ZP().uint8("type").uint8("mode",(0,em.W$)());class eS{_options;_typeValues;_scrollController;constructor(e){this._options=e,this._typeValues=new eg(e),this._scrollController=e.createScrollController()}injectKeyCode(e){return ev.serialize(this._typeValues.fillMessageType(e,O.InjectKeyCode))}injectText(e){return eb.serialize({text:e,type:this._typeValues.get(O.InjectText)})}injectTouch(e){return this._options.serializeInjectTouchControlMessage(this._typeValues.fillMessageType(e,O.InjectTouch))}injectScroll(e){return this._scrollController.serializeScrollMessage(this._typeValues.fillMessageType(e,O.InjectScroll))}backOrScreenOn(e){return this._options.serializeBackOrScreenOnControlMessage({action:e,type:this._typeValues.get(O.BackOrScreenOn)})}setScreenPowerMode(e){return ew.serialize({mode:e,type:this._typeValues.get(O.SetScreenPowerMode)})}rotateDevice(){return ef.serialize({type:this._typeValues.get(O.RotateDevice)})}}var ex=r(9509);class eL{_writer;_serializer;constructor(e,t){this._writer=e,this._serializer=new eS(t)}async write(e){await ex.ConsumableWritableStream.write(this._writer,e)}async injectKeyCode(e){await this.write(this._serializer.injectKeyCode(e))}async injectText(e){await this.write(this._serializer.injectText(e))}async injectTouch(e){await this.write(this._serializer.injectTouch(e))}async injectScroll(e){let t=this._serializer.injectScroll(e);t&&await this.write(t)}async backOrScreenOn(e){let t=this._serializer.backOrScreenOn(e);t&&await this.write(t)}async setScreenPowerMode(e){await this.write(this._serializer.setScreenPowerMode(e))}async rotateDevice(){await this.write(this._serializer.rotateDevice())}releaseLock(){this._writer.releaseLock()}async close(){await this._writer.close()}}(w=H||(H={}))[w.Clipboard=0]="Clipboard",w[w.AckClipboard=1]="AckClipboard";let e_=new em.ZP().uint64("sequence").extra({type:H.AckClipboard}),ek=new em.ZP().uint32("length").string("content",{lengthField:"length"}).extra({type:H.Clipboard});class eE extends ex.BufferedTransformStream{constructor(){super(async e=>{try{let t=await e.readExactly(1);switch(t[0]){case H.Clipboard:return await ek.deserialize(e);case H.AckClipboard:return await e_.deserialize(e);default:throw Error("Unsupported control message type")}}catch(e){if(e instanceof em.tb)throw new em.oU;if(e instanceof em.oU)throw new em.hy;throw e}})}}let eC={repeatPreviousFrameAfter:"long",maxPtsGapToEncoder:"long"};class eP{value;constructor(e={}){this.value=e}toOptionValue(){let e=Object.entries(this.value).filter(([,e])=>void 0!==e);if(0!==e.length)return e.map(([e,t])=>{let r=eC[e];return`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}${r?`:${r}`:""}=${t}`}).join(",")}}function eD(e,t,r){return e<t?t:e>r?r:e}let eT=new em.Pl({size:2,signed:!1,deserialize(e,t){let r=em.ek.Uint16.deserialize(e,t);return 65535===r?1:r/65536},serialize(e,t,r,i){r=1===(r=eD(r,-1,1))?65535:65536*r,em.ek.Uint16.serialize(e,t,r,i)}});(S=j||(j={})).Debug="debug",S.Info="info",S.Warn="warn",S.Error="error",(x=V||(V={}))[x.Unlocked=-1]="Unlocked",x[x.Portrait=0]="Portrait",x[x.Landscape=1]="Landscape",x[x.PortraitFlipped=2]="PortraitFlipped",x[x.LandscapeFlipped=3]="LandscapeFlipped";let eA=[O.InjectKeyCode,O.InjectText,O.InjectTouch,O.InjectScroll,O.BackOrScreenOn,O.ExpandNotificationPanel,O.CollapseNotificationPanel,O.GetClipboard,O.SetClipboard,O.SetScreenPowerMode,O.RotateDevice],eM=new em.ZP().uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),eN=1n<<63n,ez=new em.ZP().uint8("type").uint8("action",(0,em.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",eT).uint32("buttons"),eO=new em.ZP().uint8("type").uint32("length").string("content",{lengthField:"length"});(L=K||(K={}))[L.H264=1748121140]="H264",L[L.H265=1748121141]="H265",L[L.AV1=6387249]="AV1";class eR{static OPUS=new eR("opus",1869641075,"audio/opus","opus");static AAC=new eR("aac",6381923,"audio/aac","mp4a.66");static RAW=new eR("raw",7496055,"audio/raw","1");optionValue;metadataValue;mimeType;webCodecId;constructor(e,t,r,i){this.optionValue=e,this.metadataValue=t,this.mimeType=r,this.webCodecId=i}toOptionValue(){return this.optionValue}}let eF="/data/local/tmp/scrcpy-server.jar";function eI(e,t){var r;return"object"==typeof(r=e)&&null!==r&&"toOptionValue"in r&&"function"==typeof r.toOptionValue&&(e=e.toOptionValue()),void 0===e?t:String(e)}class eU{_base;get controlMessageTypes(){return this._base.controlMessageTypes}value;constructor(e,t){this._base=e,this.value=t}setListEncoders(){this._base.setListEncoders()}setListDisplays(){this._base.setListDisplays()}parseEncoder(e){return this._base.parseEncoder(e)}parseDisplay(e){return this._base.parseDisplay(e)}parseVideoStreamMetadata(e){return this._base.parseVideoStreamMetadata(e)}parseAudioStreamMetadata(e){return this._base.parseAudioStreamMetadata(e)}createMediaStreamTransformer(){return this._base.createMediaStreamTransformer()}serializeInjectTouchControlMessage(e){return this._base.serializeInjectTouchControlMessage(e)}serializeBackOrScreenOnControlMessage(e){return this._base.serializeBackOrScreenOnControlMessage(e)}serializeSetClipboardControlMessage(e){return this._base.serializeSetClipboardControlMessage(e)}createScrollController(){return this._base.createScrollController()}}let eH=new em.ZP().uint8("type").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class ej{accumulatedX=0;accumulatedY=0;processMessage(e){this.accumulatedX+=e.scrollX,this.accumulatedY+=e.scrollY;let t=0,r=0;if(this.accumulatedX>=1?(t=1,this.accumulatedX=0):this.accumulatedX<=-1&&(t=-1,this.accumulatedX=0),this.accumulatedY>=1?(r=1,this.accumulatedY=0):this.accumulatedY<=-1&&(r=-1,this.accumulatedY=0),0!==t||0!==r)return e.scrollX=t,e.scrollY=r,e}serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eH.serialize(t)}}class eV{static DEFAULTS={logLevel:j.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:V.Unlocked,tunnelForward:!1,crop:void 0,sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new eP};static SERIALIZE_ORDER=["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions"];static serialize(e,t){return t.map(t=>eI(e[t],"-"))}static async parseCString(e,t){let r=(0,em.FO)(await e.readExactly(t));return r.substring(0,r.indexOf("\x00"))}static async parseUint16BE(e){let t=await e.readExactly(em.ek.Uint16.size);return em.ek.Uint16.deserialize(t,!1)}static async parseUint32BE(e){let t=await e.readExactly(em.ek.Uint32.size);return em.ek.Uint32.deserialize(t,!1)}value;defaults=eV.DEFAULTS;controlMessageTypes=eA;constructor(e){this.value={...eV.DEFAULTS,...e}}serialize(){return eV.serialize(this.value,eV.SERIALIZE_ORDER)}setListEncoders(){throw Error("Not supported")}setListDisplays(){this.value.displayId=-1}parseEncoder(){throw Error("Not supported")}parseDisplay(e){let t=e.match(/\s+scrcpy --display (\d+)/);if(t)return{id:Number.parseInt(t[1],10)}}parseVideoStreamMetadata(e){return(async()=>{let t=new ex.BufferedReadableStream(e),r={codec:K.H264};return r.deviceName=await eV.parseCString(t,64),r.width=await eV.parseUint16BE(t),r.height=await eV.parseUint16BE(t),{stream:t.release(),metadata:r}})()}parseAudioStreamMetadata(){throw Error("Not supported")}createMediaStreamTransformer(){if(!this.value.sendFrameMeta)return new ex.TransformStream({transform(e,t){t.enqueue({type:"data",data:e})}});let e=new ex.StructDeserializeStream(eM);return{writable:e.writable,readable:e.readable.pipeThrough(new ex.TransformStream({transform(e,t){if(e.pts===eN){t.enqueue({type:"configuration",data:e.data});return}t.enqueue({type:"data",pts:e.pts,data:e.data})}}))}}serializeInjectTouchControlMessage(e){return ez.serialize(e)}serializeBackOrScreenOnControlMessage(e){if(e.action===R.Down)return ef.serialize(e)}serializeSetClipboardControlMessage(e){return eO.serialize(e)}createScrollController(){return new ej}}class eK extends eU{static DEFAULTS={...eV.DEFAULTS,encoderName:void 0};static SERIALIZE_ORDER=[...eV.SERIALIZE_ORDER,"encoderName"];static parseEncoder(e,t){let r=e.match(t);if(r)return{type:"video",name:r[1]}}get defaults(){return eK.DEFAULTS}constructor(e){super(new eV(e),{...eK.DEFAULTS,...e})}serialize(){return eV.serialize(this.value,eK.SERIALIZE_ORDER)}setListEncoders(){this.value.encoderName="_"}parseEncoder(e){return eK.parseEncoder(e,/\s+scrcpy --encoder-name '(.*?)'/)}}(_=B||(B={})).Verbose="verbose",_.Debug="debug",_.Info="info",_.Warn="warn",_.Error="error",(k=G||(G={}))[k.Initial=-2]="Initial",k[k.Unlocked=-1]="Unlocked",k[k.Portrait=0]="Portrait",k[k.Landscape=1]="Landscape",k[k.PortraitFlipped=2]="PortraitFlipped",k[k.LandscapeFlipped=3]="LandscapeFlipped";let eB=new em.ZP().concat(ef).uint8("action",(0,em.W$)()),eG=eA.slice();eG.splice(6,0,O.ExpandSettingPanel);let eW={[B.Verbose]:j.Debug,[B.Debug]:j.Debug,[B.Info]:j.Info,[B.Warn]:j.Warn,[B.Error]:j.Error},eY={[G.Initial]:V.Unlocked,[G.Unlocked]:V.Unlocked,[G.Portrait]:V.Portrait,[G.Landscape]:V.Landscape,[G.PortraitFlipped]:V.PortraitFlipped,[G.LandscapeFlipped]:V.LandscapeFlipped};class eZ extends eU{static DEFAULTS={...eK.DEFAULTS,logLevel:B.Debug,lockVideoOrientation:G.Unlocked,powerOffOnClose:!1};static SERIALIZE_ORDER=[...eK.SERIALIZE_ORDER,"powerOffOnClose"];get defaults(){return eZ.DEFAULTS}get controlMessageTypes(){return eG}constructor(e){let t={...eZ.DEFAULTS,...e};super(new eK({...e,logLevel:eW[t.logLevel],lockVideoOrientation:eY[t.lockVideoOrientation]}),t)}serialize(){return eV.serialize(this.value,eZ.SERIALIZE_ORDER)}parseEncoder(e){return eK.parseEncoder(e,/\s+scrcpy --encoder '(.*?)'/)}serializeBackOrScreenOnControlMessage(e){return eB.serialize(e)}}let eX=new em.ZP().uint8("type").uint64("sequence").int8("paste",(0,em.W$)()).uint32("length").string("content",{lengthField:"length"});class eq extends eU{static DEFAULTS={...eZ.DEFAULTS,clipboardAutosync:!0};static serialize(e,t){let r=[];for(let[i,n]of Object.entries(e)){let e=eI(n,void 0);if(!e)continue;let o=eI(t[i],void 0);e!=o&&r.push(`${i.replace(/([A-Z])/g,"_$1").toLowerCase()}=${e}`)}return r}get defaults(){return eq.DEFAULTS}constructor(e){super(new eZ(e),{...eq.DEFAULTS,...e})}serialize(){return eq.serialize(this.value,this.defaults)}serializeSetClipboardControlMessage(e){return eX.serialize(e)}}let eJ=new em.ZP().concat(eH).int32("buttons");class e$ extends ej{serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eJ.serialize(t)}}class eQ extends eU{static DEFAULTS={...eq.DEFAULTS,downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0};get defaults(){return eQ.DEFAULTS}constructor(e){super(new eq(e),{...eQ.DEFAULTS,...e})}parseVideoStreamMetadata(e){return this.value.sendDeviceMeta?this._base.parseVideoStreamMetadata(e):{stream:e,metadata:{codec:K.H264}}}serialize(){return eq.serialize(this.value,this.defaults)}createScrollController(){return new e$}}let e0=1n<<62n;class e1 extends eU{static DEFAULTS={...eQ.DEFAULTS,cleanup:!0};get defaults(){return e1.DEFAULTS}constructor(e){super(new eQ(e),{...e1.DEFAULTS,...e})}serialize(){return eq.serialize(this.value,this.defaults)}createMediaStreamTransformer(){let e=this._base.createMediaStreamTransformer();return{writable:e.writable,readable:e.readable.pipeThrough(new ex.TransformStream({transform(e,t){if("data"!==e.type){t.enqueue(e);return}void 0!==e.pts&&e.pts&e0&&(e.keyframe=!0,e.pts&=~e0),t.enqueue(e)}}))}}}class e2 extends eU{static DEFAULTS={...e1.DEFAULTS,powerOn:!0};get defaults(){return e2.DEFAULTS}constructor(e){super(new e1(e),{...e2.DEFAULTS,...e})}serialize(){return eq.serialize(this.value,this.defaults)}}let e3=new em.Pl({size:2,signed:!0,deserialize(e,t){let r=em.ek.Int16.deserialize(e,t);return 32767===r?1:r/32768},serialize(e,t,r,i){r=1===(r=eD(r,-1,1))?32767:32768*r,em.ek.Int16.serialize(e,t,r,i)}}),e6=new em.ZP().uint8("type",O.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("scrollX",e3).field("scrollY",e3).int32("buttons");class e4{serializeScrollMessage(e){return e6.serialize(e)}}class e8 extends eU{get defaults(){return e2.DEFAULTS}constructor(e){super(new e2(e),{...e2.DEFAULTS,...e})}serialize(){return eq.serialize(this.value,this.defaults)}createScrollController(){return new e4}}let e5=new em.ZP().uint8("type").uint8("action",(0,em.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",eT).uint32("actionButton").uint32("buttons");class e7{static NONE=new e7(-1);static random(){return new e7(2147483648*Math.random()|0)}value;constructor(e){this.value=e}toOptionValue(){if(!(this.value<0))return this.value.toString(16)}}class e9 extends eU{static DEFAULTS={...function(e,t){let r={};for(let i in e)t.includes(i)||(r[i]=e[i]);return r}(e2.DEFAULTS,["bitRate","codecOptions","encoderName"]),scid:e7.NONE,videoCodec:"h264",videoBitRate:8e6,videoCodecOptions:new eP,videoEncoder:"",audio:!0,audioCodec:"opus",audioBitRate:128e3,audioCodecOptions:new eP,audioEncoder:"",listEncoders:!1,listDisplays:!1,sendCodecMeta:!0};get defaults(){return e9.DEFAULTS}constructor(e){super(new e8(e),{...e9.DEFAULTS,...e})}serialize(){return eq.serialize(this.value,this.defaults)}setListEncoders(){this.value.listEncoders=!0}setListDisplays(){this.value.listDisplays=!0}parseEncoder(e){let t=e.match(/\s+--video-codec=(.*)\s+--video-encoder='(.*)'/);return t?{type:"video",codec:t[1],name:t[2]}:(t=e.match(/\s+--audio-codec=(.*)\s+--audio-encoder='(.*)'/))?{type:"audio",codec:t[1],name:t[2]}:void 0}parseDisplay(e){let t=e.match(/\s+--display=(\d+)\s+\((.*?)\)/);if(t){let e={id:Number.parseInt(t[1],10)};return"size unknown"!==t[2]&&(e.resolution=t[2]),e}}parseVideoStreamMetadata(e){let{sendDeviceMeta:t,sendCodecMeta:r}=this.value;if(!t&&!r){let t;switch(this.value.videoCodec){case"h264":t=K.H264;break;case"h265":t=K.H265;break;case"av1":t=K.AV1}return{stream:e,metadata:{codec:t}}}return(async()=>{let i,n,o,a;let s=new ex.BufferedReadableStream(e);if(t&&(i=await eV.parseCString(s,64)),r)n=await eV.parseUint32BE(s),o=await eV.parseUint32BE(s),a=await eV.parseUint32BE(s);else switch(this.value.videoCodec){case"h264":n=K.H264;break;case"h265":n=K.H265;break;case"av1":n=K.AV1}return{stream:s.release(),metadata:{deviceName:i,codec:n,width:o,height:a}}})()}parseAudioStreamMetadata(e){return(async()=>{let t;let r=new ex.BufferedReadableStream(e),i=await r.readExactly(em.ek.Uint32.size),n=em.ek.Uint32.deserialize(i,!1);switch(n){case 0:return{type:"disabled"};case 1:return{type:"errored"}}if(this.value.sendCodecMeta){let e;switch(n){case eR.OPUS.metadataValue:e=eR.OPUS;break;case eR.AAC.metadataValue:e=eR.AAC;break;case eR.RAW.metadataValue:e=eR.RAW;break;default:throw Error(`Unknown audio codec metadata value: ${n}`)}return{type:"success",codec:e,stream:r.release()}}switch(this.value.audioCodec){case"opus":t=eR.OPUS;break;case"aac":t=eR.AAC;break;case"raw":t=eR.RAW}return{type:"success",codec:t,stream:new ex.PushReadableStream(async e=>{await e.enqueue(i);let t=r.release(),n=t.getReader();for(;;){let{done:t,value:r}=await n.read();if(t)break;await e.enqueue(r)}})}})()}serializeInjectTouchControlMessage(e){return e5.serialize(e)}}class te extends eU{static DEFAULTS={...e9.DEFAULTS,video:!0,audioSource:"output"};get defaults(){return te.DEFAULTS}constructor(e){super(new e9(e),{...te.DEFAULTS,...e})}serialize(){return eq.serialize(this.value,this.defaults)}}let tt=B,tr=G;class ti extends te{}function tn(e){return e.toString(16).padStart(2,"0").toUpperCase()}function to(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}class ta{static isSupported(){return void 0!==globalThis.VideoDecoder}static capabilities={h264:{},h265:{}};_codec;get codec(){return this._codec}_writable;get writable(){return this._writable}_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}_frameSkipped=0;get frameSkipped(){return this._frameSkipped}context;decoder;_config;currentFrameRendered=!1;animationFrameId=0;constructor(e){this._codec=e,this._renderer=document.createElement("canvas"),this.context=this._renderer.getContext("2d"),this.decoder=new VideoDecoder({output:e=>{this.currentFrameRendered?this._frameSkipped+=1:(this.currentFrameRendered=!0,this._frameRendered+=1),this.context.drawImage(e,0,0),e.close()},error(e){}}),this._writable=new ex.WritableStream({write:e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"data":this.decode(e)}}}),this.onFramePresented()}onFramePresented=()=>{this.currentFrameRendered=!1,this.animationFrameId=requestAnimationFrame(this.onFramePresented)};configure(e){switch(this._codec){case K.H264:{let{profileIndex:t,constraintSet:r,levelIndex:i,croppedWidth:n,croppedHeight:o}=ea(e);this._renderer.width=n,this._renderer.height=o;let a=`avc1.${[t,r,i].map(tn).join("")}`;this.decoder.configure({codec:a,optimizeForLatency:!0});break}case K.H265:{let{generalProfileSpace:t,generalProfileIndex:r,generalProfileCompatibilitySet:i,generalTierFlag:n,generalLevelIndex:o,generalConstraintSet:a,croppedWidth:s,croppedHeight:l}=ep(e);this._renderer.width=s,this._renderer.height=l;let d=["hev1",["","A","B","C"][t]+r.toString(),to(i,0).toString(16),(n?"H":"L")+o.toString(),to(a,0).toString(16).toUpperCase(),to(a,4).toString(16).toUpperCase()].join(".");this.decoder.configure({codec:d,optimizeForLatency:!0})}}this._config=e}decode(e){let t;"configured"===this.decoder.state&&(void 0!==this._config?((t=new Uint8Array(this._config.byteLength+e.data.byteLength)).set(this._config,0),t.set(e.data,this._config.byteLength),this._config=void 0):t=e.data,this.decoder.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:t})))}dispose(){cancelAnimationFrame(this.animationFrameId),"closed"!==this.decoder.state&&this.decoder.close()}}var ts=r(7614),tl=r(536),td=r(882),tc=r.n(td),tu=r(4120),th=r(5093),tp=r(9446),tm=r(1463),tf=r(9823),tg=r(4612),ty=r(9861);let tv={[K.H264]:"V_MPEG4/ISO/AVC",[K.H265]:"V_MPEGH/ISO/HEVC",[K.AV1]:"V_AV1"},tb={[eR.RAW.mimeType]:"A_PCM/INT/LIT",[eR.AAC.mimeType]:"A_AAC",[eR.OPUS.mimeType]:"A_OPUS"};class tw{addVideoChunk(e){-1===this._firstTimestamp&&(this._firstTimestamp=Number(e.pts));let t=function(e){let t=[],r=0;for(let i of ei(e))t.push(i),r+=i.byteLength+4;let i=new Uint8Array(r),n=0;for(let e of t)i[n]=e.byteLength>>24,i[n+1]=e.byteLength>>16,i[n+2]=e.byteLength>>8,i[n+3]=255&e.byteLength,i.set(e,n+4),n+=4+e.byteLength;return i}(e.data);this.muxer.addVideoChunkRaw(t,e.keyframe?"key":"delta",Number(e.pts)-this._firstTimestamp,this.configurationWritten?void 0:{decoderConfig:{codec:"",description:this.videoCodecDescription}}),this.configurationWritten=!0}addVideoPacket(e){if(!this.videoMetadata)throw Error("videoMetadata must be set");try{if("configuration"===e.type){switch(this.videoMetadata.codec){case K.H264:{let{sequenceParameterSet:t,pictureParameterSet:r}=eo(e.data);this.videoCodecDescription=function(e,t){let r=new Uint8Array(11+e.byteLength+t.byteLength);return r[0]=1,r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=255,r[5]=225,r[6]=e.byteLength>>8,r[7]=255&e.byteLength,r.set(e,8),r[8+e.byteLength]=1,r[9+e.byteLength]=t.byteLength>>8,r[10+e.byteLength]=255&t.byteLength,r.set(t,11+e.byteLength),r}(t,r),this.configurationWritten=!1;break}case K.H265:{let{videoParameterSet:t,sequenceParameterSet:r,pictureParameterSet:i}=eh(e.data);this.videoCodecDescription=function(e,t,r){let{profileTierLevel:{generalProfileTier:{profile_space:i,tier_flag:n,profile_idc:o,profileCompatibilitySet:a,constraintSet:s},general_level_idc:l},vps_max_layers_minus1:d,vps_temporal_id_nesting_flag:c}=es(e.rbsp),{chroma_format_idc:u,bit_depth_luma_minus8:h,bit_depth_chroma_minus8:p,vuiParameters:{min_spatial_segmentation_idc:m=0}={}}=el(t.rbsp),f=new Uint8Array(38+e.data.length+t.data.length+r.data.length);f[0]=1,f[1]=i<<6|Number(n)<<5|o,f[2]=a[0],f[3]=a[1],f[4]=a[2],f[5]=a[3],f[6]=s[0],f[7]=s[1],f[8]=s[2],f[9]=s[3],f[10]=s[4],f[11]=s[5],f[12]=l,f[13]=240|m>>8,f[14]=m,f[15]=252,f[16]=252|u,f[17]=248|h,f[18]=248|p,f[19]=0,f[20]=0,f[21]=d+1<<3|Number(c)<<2|3,f[22]=3;let g=23;for(let i of[e,t,r])f[g]=i.nal_unit_type,f[g+=1]=0,f[g+=1]=1,f[g+=1]=i.data.length>>8,f[g+=1]=i.data.length,g+=1,f.set(i.data,g),g+=i.data.length;return f}(t,r,i),this.configurationWritten=!1}}return}if(!0===e.keyframe&&(this._packetsFromLastKeyframe.length=0),this._packetsFromLastKeyframe.push({type:"video",packet:e}),!this.muxer)return;this.addVideoChunk(e)}catch(e){console.error(e)}}addAudioChunk(e){if(-1===this._firstTimestamp)return;let t=Number(e.pts)-this._firstTimestamp;!(t<0)&&this.muxer&&this.muxer.addAudioChunkRaw(e.data,"key",t)}addAudioPacket(e){this._packetsFromLastKeyframe.push({type:"audio",packet:e}),this.addAudioChunk(e)}start(){var e,t;if(!this.videoMetadata)throw Error("videoMetadata must be set");this.running=!0;let r={target:new ty.ArrayBufferTarget,type:"matroska",firstTimestampBehavior:"permissive",video:{codec:tv[this.videoMetadata.codec],width:null!==(e=this.videoMetadata.width)&&void 0!==e?e:0,height:null!==(t=this.videoMetadata.height)&&void 0!==t?t:0}};if(this.audioCodec&&(r.audio={codec:tb[this.audioCodec.mimeType],sampleRate:48e3,numberOfChannels:2,bitDepth:this.audioCodec===eR.RAW?16:void 0}),this.muxer=new ty.Muxer(r),this._packetsFromLastKeyframe.length>0)for(let{type:e,packet:t}of this._packetsFromLastKeyframe)"video"===e?this.addVideoChunk(t):this.addAudioChunk(t)}stop(){if(!this.muxer)return;this.muxer.finalize();let e=this.muxer.target.buffer,t=new Date,r=(0,tf.yH)("Recording ".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0")," ").concat(t.getHours().toString().padStart(2,"0"),"-").concat(t.getMinutes().toString().padStart(2,"0"),"-").concat(t.getSeconds().toString().padStart(2,"0"),".mkv")),i=r.getWriter();i.write(new Uint8Array(e)),i.close(),this.muxer=void 0,this.configurationWritten=!1,this.running=!1}constructor(){this.running=!1,this.configurationWritten=!1,this._firstTimestamp=-1,this._packetsFromLastKeyframe=[]}}let tS=(0,ts.ky)({recorder:new tw,recording:!1,intervalId:-1,hours:0,minutes:0,seconds:0});(0,ts.U5)(()=>tS.recording,e=>{e?tS.intervalId=globalThis.setInterval((0,ts.aD)(()=>{tS.seconds+=1,tS.seconds>=60&&(tS.seconds=0,tS.minutes+=1),tS.minutes>=60&&(tS.minutes=0,tS.hours+=1)}),1e3):(globalThis.clearInterval(tS.intervalId),tS.intervalId=-1,tS.hours=0,tS.minutes=0,tS.seconds=0)});var tx=r(7215),tL=r(7856);class t_ extends Error{output;constructor(e){super("scrcpy server exited prematurely"),this.output=e}}class tk{static async pushServer(e,t,r=eF){let i=await e.sync();try{await i.write({filename:r,file:t})}finally{await i.dispose()}}static async start(e,t,r,i){let n,o;try{try{n=i.createConnection(e),await n.initialize()}catch(t){if(t instanceof tx.AdbReverseNotSupportedError)i.tunnelForwardOverride=!0,n=i.createConnection(e),await n.initialize();else throw n=void 0,t}o=await e.subprocess.spawn([`CLASSPATH=${t}`,"app_process","/","com.genymobile.scrcpy.Server",r,...i.serialize()],{protocols:[tx.AdbSubprocessNoneProtocol]});let a=o.stdout.pipeThrough(new ex.DecodeUtf8Stream).pipeThrough(new ex.SplitStringStream("\n")),s=[],l=new ex.AbortController,d=a.pipeTo(new ex.WritableStream({write(e){s.push(e)}}),{signal:l.signal,preventCancel:!0}).catch(e=>{if(!l.signal.aborted)throw e}),c=await Promise.race([o.exit.then(()=>{throw new t_(s)}),n.getStreams()]);return l.abort(),await d,new tk({options:i,process:o,stdout:function(...e){return new ex.PushReadableStream(async t=>{for(let r of e){let e=r.getReader();for(;;){let{done:r,value:i}=await e.read();if(r)break;await t.enqueue(i)}}})}(new ex.PushReadableStream(async e=>{for(let t of s)await e.enqueue(t)}),a),videoStream:c.video,audioStream:c.audio,controlStream:c.control})}catch(e){throw await o?.kill(),e}finally{n?.dispose()}}static async getEncoders(e,t,r,i){return i.setListEncoders(),await i.getEncoders(e,t,r)}static async getDisplays(e,t,r,i){return i.setListDisplays(),await i.getDisplays(e,t,r)}_options;_process;_stdout;get stdout(){return this._stdout}get exit(){return this._process.exit}_screenWidth;get screenWidth(){return this._screenWidth}_screenHeight;get screenHeight(){return this._screenHeight}_videoStream;get videoStream(){return this._videoStream}_audioStream;get audioStream(){return this._audioStream}_controlMessageWriter;get controlMessageWriter(){return this._controlMessageWriter}_deviceMessageStream;get deviceMessageStream(){return this._deviceMessageStream}constructor({options:e,process:t,stdout:r,videoStream:i,audioStream:n,controlStream:o}){this._options=e,this._process=t,this._stdout=r,this._videoStream=i?this.createVideoStream(i):void 0,this._audioStream=n?this.createAudioStream(n):void 0,o&&(this._controlMessageWriter=new eL(o.writable.getWriter(),e),this._deviceMessageStream=o.readable.pipeThrough(new eE))}async createVideoStream(e){let{stream:t,metadata:r}=await this._options.parseVideoStreamMetadata(e);return{stream:t.pipeThrough(this._options.createMediaStreamTransformer()).pipeThrough(new ex.InspectStream(e=>{if("configuration"===e.type)switch(r.codec){case K.H264:{let{croppedWidth:t,croppedHeight:r}=ea(e.data);this._screenWidth=t,this._screenHeight=r;break}case K.H265:{let{croppedWidth:t,croppedHeight:r}=ep(e.data);this._screenWidth=t,this._screenHeight=r}}})),metadata:r}}async createAudioStream(e){let t=await this._options.parseAudioStreamMetadata(e);switch(t.type){case"disabled":case"errored":return t;case"success":return{...t,stream:t.stream.pipeThrough(this._options.createMediaStreamTransformer())};default:throw Error(`Unexpected audio metadata type ${t.type}`)}}async close(){await this._process.kill()}}var tE=r(2918);class tC{adb;options;socketName;constructor(e,t){this.adb=e,this.options=t,this.socketName=this.getSocketName()}initialize(){}getSocketName(){let e="localabstract:scrcpy";return void 0!==this.options.scid&&this.options.scid>=0&&(e+="_"+this.options.scid.toString(16).padStart(8,"0")),e}dispose(){}}class tP extends tC{_disposed=!1;connect(){return this.adb.createSocket(this.socketName)}async connectAndRetry(e){for(let t=0;!this._disposed&&t<100;t+=1)try{let t=await this.connect();if(e){let e=new ex.BufferedReadableStream(t.readable);return await e.readExactly(1),{readable:e.release(),writable:t.writable}}return t}catch(e){await (0,tE.delay)(100)}throw Error("Can't connect to server after 100 retries")}async getStreams(){let{sendDummyByte:e}=this.options,t={};if(this.options.video){let r=await this.connectAndRetry(e);t.video=r.readable,e=!1}if(this.options.audio){let r=await this.connectAndRetry(e);t.audio=r.readable,e=!1}if(this.options.control){let r=await this.connectAndRetry(e);e=!1,t.control=r}return t}dispose(){this._disposed=!0}}class tD extends tC{streams;address;async initialize(){await this.adb.reverse.remove(this.socketName).catch(e=>{if(e instanceof tx.AdbReverseNotSupportedError)throw e});let e=new ex.TransformStream;this.streams=e.readable.getReader();let t=e.writable.getWriter();this.address=await this.adb.reverse.add(this.socketName,e=>{t.write(e)})}async accept(){return(await this.streams.read()).value}async getStreams(){let e={};if(this.options.video){let t=await this.accept();e.video=t.readable}if(this.options.audio){let t=await this.accept();e.audio=t.readable}if(this.options.control){let t=await this.accept();e.control=t}return e}dispose(){this.adb.reverse.remove(this.address).catch(tx.NOOP)}}class tT extends eU{get defaults(){return this._base.defaults}tunnelForwardOverride=!1;constructor(e){super(e,e.value)}serialize(){return this._base.serialize()}}class tA extends tT{static createConnection(e,t,r){return r?new tP(e,t):new tD(e,t)}static async getEncoders(e,t,r,i){let n=await tk.start(e,t,r,i),o=[];return await n.stdout.pipeTo(new ex.WritableStream({write:e=>{let t=i.parseEncoder(e);t&&o.push(t)}})),o}static async getDisplays(e,t,r,i){try{let n=await tk.start(e,t,r,i);await n.close()}catch(e){if(e instanceof t_){let t=[];for(let r of e.output){let e=i.parseDisplay(r);e&&t.push(e)}return t}}throw Error("failed to get displays")}getEncoders(e,t,r){return tA.getEncoders(e,t,r,this)}getDisplays(e,t,r){return tA.getDisplays(e,t,r,this)}createConnection(e){return tA.createConnection(e,{scid:-1,video:!0,audio:!1,control:!0,sendDummyByte:!0},this.tunnelForwardOverride||this.value.tunnelForward)}}class tM extends tT{static async getEncoders(e,t,r,i){try{let n=await tk.start(e,t,r,i);await n.close()}catch(e){if(e instanceof t_){let t=[];for(let r of e.output){let e=i.parseEncoder(r);e&&t.push(e)}return t}}throw Error("Unexpected error")}async getEncoders(e,t,r){return tM.getEncoders(e,t,r,this)}getDisplays(e,t,r){return tA.getDisplays(e,t,r,this)}createConnection(e){return tA.createConnection(e,{scid:this.value.scid.value,video:!0,audio:this.value.audio,control:this.value.control,sendDummyByte:this.value.sendDummyByte},this.tunnelForwardOverride||this.value.tunnelForward)}}class tN extends tM{}let tz=new r.U(r(2821));class tO{_context;_worklet;_buffer=[];constructor(e){this._context=new AudioContext({latencyHint:"interactive",sampleRate:e})}feed(e){if(void 0===this._worklet){this._buffer.push(e);return}this.feedCore(this._worklet,e)}async start(){for(let e of(await this._context.audioWorklet.addModule(new r.U(r(1598))),this._worklet=new AudioWorkletNode(this._context,this.sourceName,{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this._worklet.connect(this._context.destination),this._buffer))this.feedCore(this._worklet,e);this._buffer.length=0}async stop(){this._worklet?.disconnect(),this._worklet=void 0,await this._context.close()}}class tR extends tO{sourceName="int16-source-processor";feedCore(e,t){(0!==t.byteOffset||t.byteLength!==t.buffer.byteLength)&&(t=t.slice());let{buffer:r}=t;e.port.postMessage([r],[r])}}class tF extends tO{sourceName="float32-source-processor";feedCore(e,t){(0!==t.byteOffset||t.byteLength!==t.buffer.byteLength)&&(t=t.slice());let{buffer:r}=t;e.port.postMessage([r],[r])}}class tI extends tO{sourceName="float32-planer-source-processor";feedCore(e,t){let r=t.map(e=>((0!==e.byteOffset||e.byteLength!==e.buffer.byteLength)&&(e=e.slice()),e.buffer));e.port.postMessage(r,r)}}var tU=r(3399);class tH extends ex.TransformStream{constructor(e){let t;super({start(e){t=new AudioDecoder({error(t){console.log("audio decoder error: ",t),e.error(t)},output(t){e.enqueue(Array.from({length:2},(e,r)=>{let i={format:"f32-planar",planeIndex:r},n=new Float32Array(t.allocationSize(i)/Float32Array.BYTES_PER_ELEMENT);return t.copyTo(n,i),n}))}})},transform(r){switch(r.type){case"configuration":t.configure({...e,description:r.data});break;case"data":t.decode(new EncodedAudioChunk({data:r.data,type:"key",timestamp:0}))}},async flush(){await t.flush()}})}}class tj extends ex.TransformStream{constructor(e){let t;super({start(r){(t=new AudioDecoder({error(e){console.log("audio decoder error: ",e),r.error(e)},output(e){let t={format:"f32",planeIndex:0},i=new Float32Array(e.allocationSize(t)/Float32Array.BYTES_PER_ELEMENT);e.copyTo(i,t),r.enqueue(i)}})).configure(e)},transform(e){switch(e.type){case"configuration":break;case"data":if(0===e.data.length)break;t.decode(new EncodedAudioChunk({type:"key",timestamp:0,data:e.data}))}},async flush(){await t.flush()}})}}var tV=r(6882);class tK{get downloaded(){return this._downloaded}get total(){return this._total}get onProgress(){return this.progressEvent.event}async fetch(e){var t;let r=await globalThis.fetch(e);this._total=Number.parseInt(null!==(t=r.headers.get("Content-Length"))&&void 0!==t?t:"0",10),this.progressEvent.fire([this._downloaded,this._total]);let i=r.body.getReader(),n=[];for(;;){let e=await i.read();if(e.done)break;n.push(e.value),this._downloaded+=e.value.byteLength,this.progressEvent.fire([this._downloaded,this._total])}this._total=n.reduce((e,t)=>e+t.byteLength,0);let o=new Uint8Array(this._total),a=0;for(let e of n)o.set(e,a),a+=e.byteLength;return o}constructor(e){this._downloaded=0,this._total=0,this.progressEvent=new tV.vp,this.promise=this.fetch(e)}}function tB(e){return i||(i=new tK(tz)).promise.catch(()=>{i=void 0}),e&&(i.onProgress(e),e([i.downloaded,i.total])),i.promise}var tG=r(6768);class tW{setModifier(e,t){switch(e){case I.ControlLeft:this._controlLeft=t;break;case I.ControlRight:this._controlRight=t;break;case I.ShiftLeft:this._shiftLeft=t;break;case I.ShiftRight:this._shiftRight=t;break;case I.AltLeft:this._altLeft=t;break;case I.AltRight:this._altRight=t;break;case I.MetaLeft:this._metaLeft=t;break;case I.MetaRight:this._metaRight=t;break;case I.CapsLock:t&&(this._capsLock=!this._capsLock);break;case I.NumLock:t&&(this._numLock=!this._numLock)}}getMetaState(){let e=0;return this._altLeft&&(e|=F.AltOn|F.AltLeftOn),this._altRight&&(e|=F.AltOn|F.AltRightOn),this._shiftLeft&&(e|=F.ShiftOn|F.ShiftLeftOn),this._shiftRight&&(e|=F.ShiftOn|F.ShiftRightOn),this._controlLeft&&(e|=F.CtrlOn|F.CtrlLeftOn),this._controlRight&&(e|=F.CtrlOn|F.CtrlRightOn),this._metaLeft&&(e|=F.MetaOn|F.MetaLeftOn),this._metaRight&&(e|=F.MetaOn|F.MetaRightOn),this._capsLock&&(e|=F.CapsLockOn),this._numLock&&(e|=F.NumLockOn),e}async down(e){var t;let r=I[e];r&&(this.setModifier(r,!0),this._keys.add(r),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:R.Down,keyCode:r,metaState:this.getMetaState(),repeat:0})))}async up(e){var t;let r=I[e];r&&(this.setModifier(r,!1),this._keys.delete(r),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:R.Up,keyCode:r,metaState:this.getMetaState(),repeat:0})))}async reset(){for(let e of(this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._keys))this.up(I[e]);this._keys.clear()}dispose(){}constructor(e){this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._capsLock=!1,this._numLock=!0,this._keys=new Set,this.client=e}}class tY{static async register(e){let t=await tG.qG.register(e,0,tG.XC.DESCRIPTOR);return new tY(t)}async down(e){let t=tG.sm[e];t&&(this.hidKeyboard.down(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async up(e){let t=tG.sm[e];t&&(this.hidKeyboard.up(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async reset(){this.hidKeyboard.reset(),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport())}async dispose(){await this.aoaKeyboard.unregister()}constructor(e){this.hidKeyboard=new tG.XC,this.aoaKeyboard=e}}var tZ=r(6870),tX=r(1995),tq=r(917),tJ=r(5604),t$=r(3944),tQ=r(2829),t0=r(3209),t1=r(6645);let t2=!1,t3=[],t6=0,t4=new Map;class t8 extends tV.Xn{streamId;pictureReadyEvent=new tV.vp;get onPictureReady(){return this.pictureReadyEvent.event}constructor(e){var t;super(),this.streamId=e,this.addDisposable((t=this.handlePictureReady,t4.set(e,t),{dispose(){t4.delete(e)}}))}handlePictureReady=e=>{this.pictureReadyEvent.fire(e)};feed(e){n.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),n.postMessage({type:"release",renderStateId:this.streamId})}}let t5=()=>{};function t7(){return o||(o=Promise.all([r.e(720).then(r.t.bind(r,9720,19)),r.e(312).then(r.t.bind(r,7312,19))]).then(([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t}))),o}class t9{static capabilities={h264:{maxProfile:P.Baseline,maxLevel:D.Level4}};_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}_frameSkipped=0;get frameSkipped(){return this._frameSkipped}_writable;get writable(){return this._writable}_yuvCanvas;_initializer;constructor(){t7(),this._renderer=document.createElement("canvas"),this._writable=new ex.WritableStream({write:async e=>{switch(e.type){case"configuration":await this.configure(e.data);break;case"data":{if(!this._initializer)throw Error("Decoder not configured");let t=await this._initializer.promise;t.feed(e.data.slice().buffer)}}}})}async configure(e){this.dispose(),this._initializer=new tE.PromiseResolver;let{YuvBuffer:t,YuvCanvas:i}=await t7();this._yuvCanvas||(this._yuvCanvas=i.attach(this._renderer));let{encodedWidth:o,encodedHeight:a,croppedWidth:s,croppedHeight:l,cropLeft:d,cropTop:c}=ea(e),u=o/2,h=a/2,p=t.format({width:o,height:a,chromaWidth:u,chromaHeight:h,cropLeft:d,cropTop:c,cropWidth:s,cropHeight:l,displayWidth:s,displayHeight:l}),m=await function(){if(n||(n=new Worker(r.tu(new URL(r.p+r.u(363),r.b)))).addEventListener("message",({data:e})=>{switch(e.type){case"decoderReady":for(let e of(t2=!0,t3))e.resolve(new t8(t6)),t6+=1;t3.length=0;break;case"pictureReady":t4.get(e.renderStateId)?.(e)}}),!t2){let e=new tE.PromiseResolver;return t3.push(e),e.promise}let e=new t8(t6);return t6+=1,Promise.resolve(e)}();this._initializer.resolve(m);let f=o*a,g=f+u*h;m.onPictureReady(({data:e})=>{this._frameRendered+=1;let r=new Uint8Array(e),i=t.frame(p,t.lumaPlane(p,r,o,0),t.chromaPlane(p,r,u,f),t.chromaPlane(p,r,u,g));this._yuvCanvas.drawFrame(i)}),m.feed(e.slice().buffer)}dispose(){this._initializer?.promise.then(e=>e.dispose()).catch(t5),this._initializer=void 0}}let re=(0,et.Z)({labelRight:{marginLeft:"4px"},item:{width:"100%",maxWidth:"300px"}}),rt=(0,tl.Pi)(function(e){let{definition:t,value:r,onChange:i}=e,n=re(),o=(0,W.jsxs)(X.K,{horizontal:!0,verticalAlign:"center",children:[(0,W.jsx)("span",{children:t.label}),!!t.description&&(0,W.jsx)(tZ.G,{content:t.description,children:(0,W.jsx)(tX.J,{className:n.labelRight,iconName:tf.PJ.Info})}),t.labelExtra]});switch(t.type){case"text":return(0,W.jsx)(tq.n,{className:n.item,label:o,placeholder:t.placeholder,value:r,onChange:(e,r)=>i(t,r)});case"dropdown":return(0,W.jsx)(tJ.L,{className:n.item,label:o,options:t.options,placeholder:t.placeholder,selectedKey:r,onChange:(e,r)=>i(t,r.key)});case"toggle":return(0,W.jsx)(t$.Z,{label:o,checked:r,disabled:t.disabled,onChange:(e,r)=>i(t,r)});case"number":return(0,W.jsx)(tQ.k,{className:n.item,label:t.label,labelPosition:t0.L.top,min:t.min,max:t.max,step:t.step,value:r.toString(),onChange:(e,r)=>i(t,Number.parseInt(r,10))})}}),rr={maxSize:1080,videoBitRate:4e6,videoCodec:"h264",lockVideoOrientation:tr.Unlocked,displayId:0,crop:"",powerOn:!0,audio:!0,audioCodec:"aac"},ri=(0,ts.ky)({displays:[],encoders:[],decoders:[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:t9}],settings:rr,clientSettings:{}},{decoders:ts.LO.shallow,settings:ts.LO.deep,clientSettings:ts.LO.deep}),rn="/data/local/tmp/.tango.json";(0,ts.EH)(()=>{tU.d.adb&&((async()=>{let e=await tU.d.adb.sync();try{let t=new ex.GatherStringStream;await e.read(rn).pipeThrough(new ex.DecodeUtf8Stream).pipeTo(t);let r=JSON.parse(t.result);(0,ts.z)(()=>{ri.settings={...rr,...r.settings},ri.clientSettings=r.clientSettings})}catch(e){if(!(e instanceof tx.AdbSyncError))throw e}finally{await e.dispose()}})(),(0,ts.z)(()=>{ri.encoders=[],ri.displays=[],ri.settings.displayId=void 0}))}),(0,ts.EH)(()=>{ri.clientSettings.decoder=ri.decoders[0].key});let ro=(0,ts.Fl)(()=>{let e=[];return e.push({group:"settings",key:"powerOn",type:"toggle",label:"Wake device up on start"},{group:"clientSettings",key:"turnScreenOff",type:"toggle",label:"Turn screen off during mirroring"},{group:"settings",key:"stayAwake",type:"toggle",label:"Stay awake during mirroring (if plugged in)"},{group:"settings",key:"powerOffOnClose",type:"toggle",label:"Turn device off on stop"}),e.push({group:"settings",key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,W.jsx)(t1.h,{iconProps:{iconName:tf.PJ.ArrowClockwise},disabled:!tU.d.adb,text:"Refresh",onClick:async()=>{try{await ra.pushServer();let e=await tk.getDisplays(tU.d.adb,eF,"2.1",new tN(new ti({logLevel:tt.Debug})));(0,ts.z)(()=>{if(ri.displays=e,!ri.settings.displayId||!ri.displays.some(e=>e.id===ri.settings.displayId)){var t;ri.settings.displayId=null===(t=ri.displays[0])||void 0===t?void 0:t.id}})}catch(e){tU.d.showErrorDialog(e)}}}),options:ri.displays.map(e=>({key:e.id,text:"".concat(e.id).concat(e.resolution?" (".concat(e.resolution,")"):"")}))}),e.push({group:"settings",key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),e.push({group:"settings",key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50},{group:"settings",key:"videoBitRate",type:"number",label:"Max Video Bitrate (bps)",min:100,max:1e8,step:100},{group:"settings",key:"videoCodec",type:"dropdown",label:"Video Codec",options:[{key:"h264",text:"H.264"},{key:"h265",text:"H.265"}]},{group:"settings",key:"videoEncoder",type:"dropdown",label:"Video Encoder",placeholder:0===ri.encoders.length?"Press refresh button to update encoder list":"(default)",labelExtra:(0,W.jsx)(t1.h,{iconProps:{iconName:tf.PJ.ArrowClockwise},disabled:!tU.d.adb,text:"Refresh",onClick:async()=>{try{await ra.pushServer();let e=await tk.getEncoders(tU.d.adb,eF,"2.1",new tN(new ti({logLevel:tt.Debug})));(0,ts.z)(()=>{ri.encoders=e})}catch(e){tU.d.showErrorDialog(e)}}}),options:ri.encoders.filter(e=>"video"===e.type&&(!e.codec||e.codec===ri.settings.videoCodec)).map(e=>({key:e.name,text:e.name}))}),e.push({group:"settings",key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:tr.Unlocked,text:"Unlocked"},{key:tr.Initial,text:"Current"},{key:tr.Portrait,text:"Portrait"},{key:tr.Landscape,text:"Landscape"},{key:tr.PortraitFlipped,text:"Portrait (Flipped)"},{key:tr.LandscapeFlipped,text:"Landscape (Flipped)"}]}),ri.decoders.length>1&&e.push({group:"clientSettings",key:"decoder",type:"dropdown",label:"Video Decoder",options:ri.decoders.map(e=>({key:e.key,text:e.name,data:e}))}),e.push({group:"clientSettings",key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore video decoder's codec options",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({group:"settings",key:"audio",type:"toggle",label:"Forward Audio (Requires Android 11)"},{group:"settings",key:"audioCodec",type:"dropdown",label:"Audio Codec",options:[{key:"raw",text:"Raw"},{key:"aac",text:"AAC"},{key:"opus",text:"Opus"}]},{group:"settings",key:"audioEncoder",type:"dropdown",placeholder:0===ri.encoders.length?"Press refresh button to update encoder list":"(default)",label:"Audio Encoder",labelExtra:(0,W.jsx)(t1.h,{iconProps:{iconName:tf.PJ.ArrowClockwise},disabled:!tU.d.adb,text:"Refresh",onClick:async()=>{try{await ra.pushServer();let e=await tk.getEncoders(tU.d.adb,eF,"2.1",new tN(new ti({logLevel:tt.Debug})));(0,ts.z)(()=>{ri.encoders=e})}catch(e){tU.d.showErrorDialog(e)}}}),options:ri.encoders.filter(e=>"audio"===e.type&&e.codec===ri.settings.audioCodec).map(e=>({key:e.name,text:e.name}))}),e});(0,ts.EH)(()=>{if(0===ri.encoders.length){ri.settings.videoEncoder="",ri.settings.audioEncoder="";return}let e=ri.encoders.filter(e=>"video"===e.type&&e.codec===ri.settings.videoCodec);ri.settings.videoEncoder&&e.every(e=>e.name!==ri.settings.videoEncoder)&&(ri.settings.videoEncoder="");let t=ri.encoders.filter(e=>"audio"===e.type&&e.codec===ri.settings.audioCodec);ri.settings.audioEncoder&&t.every(e=>e.name!==ri.settings.audioEncoder)&&(ri.settings.audioEncoder="")});let ra=new class{get rotatedWidth(){return 1&ra.rotation?ra.height:ra.width}get rotatedHeight(){return 1&ra.rotation?ra.width:ra.height}async pushServer(){let e=await tB();await tk.pushServer(tU.d.adb,new ex.ReadableStream({start(t){t.enqueue(new ex.Consumable(e)),t.close()}}))}async stop(){var e;await (null===(e=this.client)||void 0===e?void 0:e.close()),this.dispose()}dispose(){var e,t,r;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,tS.recording&&(tS.recorder.stop(),tS.recording=!1),null===(t=this.keyboard)||void 0===t||t.dispose(),this.keyboard=void 0,null===(r=this.audioPlayer)||void 0===r||r.stop(),this.audioPlayer=void 0,this.fps="0",clearTimeout(this.fpsCounterIntervalId),this.isFullScreen&&(document.exitFullscreen(),this.isFullScreen=!1),this.client=void 0,this.running=!1}setFullScreenContainer(e){this.fullScreenContainer=e}setRendererContainer(e){this.rendererContainer=e}clientPositionToDevicePosition(e,t){let r=this.rendererContainer.getBoundingClientRect(),i=eD((e-r.x)/r.width,0,1),n=eD((t-r.y)/r.height,0,1);switch(1&this.rotation&&([i,n]=[n,i]),this.rotation){case 1:n=1-n;break;case 2:i=1-i,n=1-n;break;case 3:i=1-i}return{x:i*this.width,y:n*this.height}}constructor(){this.running=!1,this.fullScreenContainer=null,this.rendererContainer=null,this.isFullScreen=!1,this.logVisible=!1,this.log=[],this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotation=0,this.client=void 0,this.hoverHelper=void 0,this.keyboard=void 0,this.audioPlayer=void 0,this.decoder=void 0,this.fpsCounterIntervalId=void 0,this.fps="0",this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.start=async()=>{if(tU.d.adb)try{var e,t;let r;if(!ri.clientSettings.decoder)throw Error("No available decoder");(0,ts.z)(()=>{this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.connecting=!0});let i=setInterval((0,ts.aD)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize}),1e3);try{r=await tB((0,ts.aD)(e=>{let[t,r]=e;this.serverDownloadedSize=t,this.serverTotalSize=r})),(0,ts.z)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize})}finally{clearInterval(i)}i=setInterval((0,ts.aD)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize}),1e3);try{await tk.pushServer(tU.d.adb,new ex.ReadableStream({start(e){e.enqueue(new ex.Consumable(r)),e.close()}}).pipeThrough(new ex.DistributionStream(tx.ADB_SYNC_MAX_PACKET_SIZE)).pipeThrough(new tf.hK((0,ts.aD)(e=>{this.serverUploadedSize=e})))),(0,ts.z)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize})}finally{clearInterval(i)}let n=null!==(t=ri.decoders.find(e=>e.key===ri.clientSettings.decoder))&&void 0!==t?t:ri.decoders[0],o=new eP;if(!ri.clientSettings.ignoreDecoderCodecArgs){let e=n.Constructor.capabilities[ri.settings.videoCodec];e&&(o.value.profile=e.maxProfile,o.value.level=e.maxLevel)}let a=new tN(new ti({...ri.settings,logLevel:tt.Debug,scid:e7.random(),sendDeviceMeta:!1,sendDummyByte:!1,videoCodecOptions:o}));(0,ts.z)(()=>{this.log=[],this.log.push("[client] Server version: ".concat("2.1")),this.log.push("[client] Server arguments: ".concat(a.serialize().join(" ")))});let s=await tk.start(tU.d.adb,eF,"2.1",a);s.stdout.pipeTo(new ex.WritableStream({write:(0,ts.aD)(e=>{this.log.push(e)})}));let l=await tU.d.adb.sync();try{await l.write({filename:rn,file:new ex.ReadableStream({start(e){e.enqueue(new ex.Consumable((0,tx.encodeUtf8)(JSON.stringify({settings:ri.settings,clientSettings:ri.clientSettings})))),e.close()}})})}finally{l.dispose()}tS.recorder=new tw,s.videoStream.then(e=>{let{stream:t,metadata:r}=e;(0,ts.z)(()=>{tS.recorder.videoMetadata=r});let i=new n.Constructor(r.codec);(0,ts.z)(()=>{this.decoder=i;let e=0,t=0;this.fpsCounterIntervalId=setInterval((0,ts.aD)(()=>{let r=i.frameRendered-e,n=i.frameSkipped-t;this.fps="".concat(r).concat(n?"+".concat(n," skipped"):""),e=i.frameRendered,t=i.frameSkipped}),1e3)});let o=0n,a=new ex.InspectStream(e=>{if(tS.recorder.addVideoPacket(e),"configuration"===e.type){let t,i;switch(r.codec){case K.H264:({croppedWidth:t,croppedHeight:i}=ea(e.data));break;case K.H265:({croppedWidth:t,croppedHeight:i}=ep(e.data));break;default:throw Error("Codec not supported")}(0,ts.z)(()=>{this.log.push("[client] Video size changed: ".concat(t,"x").concat(i)),this.width=t,this.height=i})}else if(e.keyframe&&void 0!==e.pts){if(o){let t=Number(e.pts-o)/1e3|0;(0,ts.z)(()=>{this.log.push("[client] Keyframe interval: ".concat(t,"ms"))})}o=e.pts}});t.pipeThrough(a).pipeTo(i.writable)}),null===(e=s.audioStream)||void 0===e||e.then(async e=>{switch(e.type){case"disabled":(0,ts.z)(()=>this.log.push("[client] Demuxer audio: stream explicitly disabled by the device"));return;case"errored":(0,ts.z)(()=>this.log.push("[client] Demuxer audio: stream configuration error on the device"));return;case"success":break;default:throw Error("Unexpected audio metadata type ".concat(e.type))}let[t,r]=e.stream.tee();switch(e.codec){case eR.RAW:{let e=new tR(48e3);this.audioPlayer=e,r.pipeTo(new ex.WritableStream({write:t=>{e.feed(new Int16Array(t.data.buffer,t.data.byteOffset,t.data.byteLength/Int16Array.BYTES_PER_ELEMENT))}})),await this.audioPlayer.start();break}case eR.OPUS:{let t=new tF(48e3);this.audioPlayer=t,r.pipeThrough(new tj({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new ex.WritableStream({write:e=>{t.feed(e)}})),await t.start();break}case eR.AAC:{let t=new tI(48e3);this.audioPlayer=t,r.pipeThrough(new tH({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new ex.WritableStream({write:e=>{t.feed(e)}})),await t.start();break}default:throw Error("Unsupported audio codec ".concat(e.codec.optionValue))}(0,ts.z)(()=>{tS.recorder.audioCodec=e.codec}),t.pipeTo(new ex.WritableStream({write:e=>{"data"===e.type&&tS.recorder.addAudioPacket(e)}}))}),s.exit.then(this.dispose),s.deviceMessageStream.pipeTo(new ex.WritableStream({write(e){e.type===H.Clipboard&&globalThis.navigator.clipboard.writeText(e.content)}})),ri.clientSettings.turnScreenOff&&await s.controlMessageWriter.setScreenPowerMode(U.Off),(0,ts.z)(()=>{this.client=s,this.hoverHelper=new ey,this.running=!0});let d=tU.d.device;d instanceof tL.Of?this.keyboard=await tY.register(d.raw):this.keyboard=new tW(s)}catch(e){tU.d.showErrorDialog(e)}finally{(0,ts.z)(()=>{this.connecting=!1})}},(0,ts.ky)(this,{start:!1,stop:ts.aD.bound,dispose:ts.aD.bound,setFullScreenContainer:ts.aD.bound,setRendererContainer:ts.aD.bound,clientPositionToDevicePosition:!1}),(0,ts.EH)(()=>{tU.d.adb||this.dispose()}),"object"==typeof document&&document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(0,ts.z)(()=>{this.isFullScreen=!1})}),(0,ts.EH)(()=>{if(this.rendererContainer&&this.decoder){for(;this.rendererContainer.firstChild;)this.rendererContainer.firstChild.remove();this.rendererContainer.appendChild(this.decoder.renderer)}})}},rs=(0,ts.Fl)(()=>{let e=[];return e.push({key:"stop",iconProps:{iconName:tf.PJ.Stop},text:"Stop",onClick:ra.stop}),e.push(tS.recording?{key:"Record",iconProps:{iconName:tf.PJ.Record,style:{color:"red"}},text:"".concat(tS.hours?"".concat(tS.hours,":"):"").concat(tS.minutes.toString().padStart(2,"0"),":").concat(tS.seconds.toString().padStart(2,"0")),onClick:(0,ts.aD)(()=>{ra.fullScreenContainer.focus(),tS.recorder.stop(),tS.recording=!1})}:{key:"Record",disabled:!ra.running,iconProps:{iconName:tf.PJ.Record},text:"Record",onClick:(0,ts.aD)(()=>{ra.fullScreenContainer.focus(),tS.recorder.start(),tS.recording=!0})}),e.push({key:"fullscreen",disabled:!ra.running,iconProps:{iconName:tf.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:(0,ts.aD)(()=>{ra.fullScreenContainer.focus(),ra.fullScreenContainer.requestFullscreen(),ra.isFullScreen=!0})}),e.push({key:"volumeUp",disabled:!ra.running,iconProps:{iconName:tf.PJ.Speaker2},iconOnly:!0,text:"Volume Up",onClick:async()=>{var e,t;ra.fullScreenContainer.focus(),await (null===(e=ra.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.VolumeUp,repeat:0,metaState:0})),await (null===(t=ra.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.VolumeUp,repeat:0,metaState:0}))}},{key:"volumeDown",disabled:!ra.running,iconProps:{iconName:tf.PJ.Speaker1},iconOnly:!0,text:"Volume Down",onClick:async()=>{var e,t;ra.fullScreenContainer.focus(),await (null===(e=ra.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.VolumeDown,repeat:0,metaState:0})),await (null===(t=ra.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.VolumeDown,repeat:0,metaState:0}))}},{key:"volumeMute",disabled:!ra.running,iconProps:{iconName:tf.PJ.SpeakerOff},iconOnly:!0,text:"Toggle Mute",onClick:async()=>{var e,t;ra.fullScreenContainer.focus(),await (null===(e=ra.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.VolumeMute,repeat:0,metaState:0})),await (null===(t=ra.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.VolumeMute,repeat:0,metaState:0}))}}),e.push({key:"rotateDevice",disabled:!ra.running,iconProps:{iconName:tf.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:()=>{ra.fullScreenContainer.focus(),ra.client.controlMessageWriter.rotateDevice()}},{key:"rotateVideoLeft",disabled:!ra.running,iconProps:{iconName:tf.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:(0,ts.aD)(()=>{ra.fullScreenContainer.focus(),ra.rotation-=1,ra.rotation<0&&(ra.rotation=3)})},{key:"rotateVideoRight",disabled:!ra.running,iconProps:{iconName:tf.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:(0,ts.aD)(()=>{ra.fullScreenContainer.focus(),ra.rotation=ra.rotation+1&3})}),e.push({key:"turnScreenOff",disabled:!ra.running,iconProps:{iconName:tf.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:()=>{ra.fullScreenContainer.focus(),ra.client.controlMessageWriter.setScreenPowerMode(U.Off)}},{key:"turnScreenOn",disabled:!ra.running,iconProps:{iconName:tf.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:()=>{ra.fullScreenContainer.focus(),ra.client.controlMessageWriter.setScreenPowerMode(U.Normal)}}),ra.running&&e.push({key:"fps",text:"FPS: ".concat(ra.fps),disabled:!0}),e.push({key:"spacer",onRender:()=>(0,W.jsx)(tg.X,{})},{key:"separator",disabled:!0,itemType:tp.n.Divider}),e.push({key:"NavigationBar",iconProps:{iconName:tf.PJ.PanelBottom},canCheck:!0,checked:ra.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,ts.aD)(()=>{ra.navigationBarVisible=!ra.navigationBarVisible})},{key:"Log",iconProps:{iconName:tf.PJ.TextGrammarError},canCheck:!0,checked:ra.logVisible,text:"Log",iconOnly:!0,onClick:(0,ts.aD)(()=>{ra.logVisible=!ra.logVisible})},{key:"DemoMode",iconProps:{iconName:tf.PJ.Wand},canCheck:!0,checked:ra.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,ts.aD)(()=>{ra.demoModeVisible=!ra.demoModeVisible})}),e}),rl=(0,tl.Pi)(function(){return(0,W.jsx)(tm.X,{items:rs.get()})});var rd=r(4401);let rc=(0,et.Z)({container:{height:"40px",backgroundColor:"#999"},bar:{width:"100%",maxWidth:"300px"},icon:{color:"white"},back:{transform:"rotate(180deg)"}});function ru(e){return!!ra.client&&0===e.button&&(ra.fullScreenContainer.focus(),e.currentTarget.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation(),!0)}function rh(e){return!!ra.client&&0===e.button}function rp(e){ru(e)&&ra.client.controlMessageWriter.backOrScreenOn(R.Down)}function rm(e){rh(e)&&ra.client.controlMessageWriter.backOrScreenOn(R.Up)}function rf(e){ru(e)&&ra.client.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.AndroidHome,repeat:0,metaState:0})}function rg(e){rh(e)&&ra.client.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.AndroidHome,repeat:0,metaState:0})}function ry(e){ru(e)&&ra.client.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.AndroidAppSwitch,repeat:0,metaState:0})}function rv(e){rh(e)&&ra.client.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.AndroidAppSwitch,repeat:0,metaState:0})}let rb=(0,tl.Pi)(function(e){let{className:t,style:r,children:i}=e,n=rc();return ra.navigationBarVisible?(0,W.jsxs)(X.K,{className:(0,rd.z)(n.container,t),verticalFill:!0,horizontalAlign:"center",style:r,children:[i,(0,W.jsxs)(X.K,{className:n.bar,verticalFill:!0,horizontal:!0,horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,W.jsx)(t1.h,{className:(0,rd.z)(n.back,n.icon),iconProps:{iconName:tf.PJ.Play},onPointerDown:rp,onPointerUp:rm}),(0,W.jsx)(t1.h,{className:n.icon,iconProps:{iconName:tf.PJ.Circle},onPointerDown:rf,onPointerUp:rg}),(0,W.jsx)(t1.h,{className:n.icon,iconProps:{iconName:tf.PJ.Stop},onPointerDown:ry,onPointerUp:rv})]})]}):(0,W.jsx)("div",{className:t,style:r,children:i})}),rw=(0,et.Z)({video:{transformOrigin:"center center",touchAction:"none"}});function rS(e){if(!ra.client)return;ra.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation();let{x:t,y:r}=ra.clientPositionToDevicePosition(e.clientX,e.clientY);ra.client.controlMessageWriter.injectScroll({screenWidth:ra.client.screenWidth,screenHeight:ra.client.screenHeight,pointerX:t,pointerY:r,scrollX:-e.deltaX/100,scrollY:-e.deltaY/100,buttons:0})}let rx=[N.Primary,N.Tertiary,N.Secondary,N.Back,N.Forward];function rL(e,t){let r;if(!ra.client)return;let{pointerType:i}=t;r="mouse"===i?z.Finger:BigInt(t.pointerId);let{x:n,y:o}=ra.clientPositionToDevicePosition(t.clientX,t.clientY),a=ra.hoverHelper.process({action:e,pointerId:r,screenWidth:ra.client.screenWidth,screenHeight:ra.client.screenHeight,pointerX:n,pointerY:o,pressure:t.pressure,actionButton:rx[t.button],buttons:t.buttons});for(let e of a)ra.client.controlMessageWriter.injectTouch(e)}function r_(e){ra.client&&(ra.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation(),e.currentTarget.setPointerCapture(e.pointerId),rL(M.Down,e))}function rk(e){ra.client&&(e.preventDefault(),e.stopPropagation(),rL(0===e.buttons?M.HoverMove:M.Move,e))}function rE(e){ra.client&&(e.preventDefault(),e.stopPropagation(),rL(M.Up,e))}function rC(e){ra.client&&(e.preventDefault(),e.stopPropagation(),rL(M.HoverExit,e),rL(M.Up,e))}function rP(e){e.preventDefault()}function rD(){let e=rw(),[t,r]=(0,tu.useState)(null);return(0,tu.useEffect)(()=>{if(ra.setRendererContainer(t),t)return t.addEventListener("wheel",rS,{passive:!1}),()=>{t.removeEventListener("wheel",rS)}},[t]),(0,W.jsx)("div",{ref:r,className:e.video,style:{width:ra.width,height:ra.height,transform:"translate(".concat((ra.rotatedWidth-ra.width)/2,"px, ").concat((ra.rotatedHeight-ra.height)/2,"px) rotate(").concat(90*ra.rotation,"deg)")},onPointerDown:r_,onPointerMove:rk,onPointerUp:rE,onPointerCancel:rE,onPointerLeave:rC,onContextMenu:rP})}let rT=(e,t,r,i,n)=>{(0,tu.useEffect)(()=>{let n="function"==typeof e?e():e;return n.addEventListener(t,r,i),()=>n.removeEventListener(t,r,i)},n)},rA=tu.useLayoutEffect;Symbol("UNINITIALIZED");let rM="undefined"!=typeof localStorage?function(e,t){var r;let[i,n]=(0,tu.useState)(()=>localStorage.getItem(e)||t);rT(globalThis,"storage",()=>n(null!==(r=localStorage.getItem(e))&&void 0!==r?r:t),{passive:!0},[e,t]);let o=function(e){let t=function(e){let t=(0,tu.useRef)(e);return rA(()=>{t.current=e},[e]),t}(e);return function(e){let t=(0,tu.useRef)(e);return t.current}(function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return t.current(...r)})}(t=>{n(t),localStorage.setItem(e,t)});return[i,o]}:(e,t)=>[t,()=>{}],rN=(0,et.Z)({layerHost:{position:"absolute",top:0,bottom:0,left:0,right:0,pointerEvents:"none",...er.q5.margin(0)},fullScreenContainer:{flexGrow:1,display:"flex",flexDirection:"column",backgroundColor:"black",":focus-visible":{...er.q5.outline("0")}},fullScreenStatusBar:{display:"flex",color:"white",columnGap:"12px",...er.q5.padding("8px","20px")},spacer:{flexGrow:1}}),rz=(0,tl.Pi)(()=>{let e=rN(),t=(0,ee.M)("layerHost"),[r,i]=(0,tu.useState)(!1);return((0,tu.useEffect)(()=>{i(!0)},[]),r)?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(Y.Z,{id:t,className:e.layerHost}),(0,W.jsx)(Z.V,{hidden:!ra.connecting,modalProps:{layerProps:{hostId:t}},dialogContentProps:{title:"Connecting..."},children:(0,W.jsxs)(X.K,{tokens:tf.WT,children:[(0,W.jsx)(q.Y,{label:"Downloading scrcpy server...",percentComplete:ra.serverTotalSize?ra.serverDownloadedSize/ra.serverTotalSize:void 0,description:(0,tf.CY)(ra.debouncedServerDownloadedSize,ra.serverTotalSize,ra.serverDownloadSpeed)}),(0,W.jsx)(q.Y,{label:"Pushing scrcpy server to device...",progressHidden:0===ra.serverTotalSize||ra.serverDownloadedSize!==ra.serverTotalSize,percentComplete:ra.serverUploadedSize/ra.serverTotalSize,description:(0,tf.CY)(ra.debouncedServerUploadedSize,ra.serverTotalSize,ra.serverUploadSpeed)}),(0,W.jsx)(q.Y,{label:"Starting scrcpy server on device...",progressHidden:0===ra.serverTotalSize||ra.serverUploadedSize!==ra.serverTotalSize})]})})]}):null});async function rO(e){if(!ra.client)return;e.preventDefault(),e.stopPropagation();let{type:t,code:r}=e;ra.keyboard["keydown"===t?"down":"up"](r)}function rR(){var e;ra.client&&(null===(e=ra.keyboard)||void 0===e||e.reset())}let rF=(0,tl.Pi)(function(e){var t;let{keyboardLockEnabled:r}=e,i=rN(),[n,o]=rM("scrcpy-hint-hidden","false");return r&&ra.isFullScreen&&"true"!==n?(0,W.jsxs)("div",{className:i.fullScreenStatusBar,children:[(0,W.jsx)("div",{children:null===(t=tU.d.device)||void 0===t?void 0:t.serial}),(0,W.jsxs)("div",{children:["FPS: ",ra.fps]}),(0,W.jsx)("div",{className:i.spacer}),(0,W.jsx)("div",{children:"Press and hold ESC to exit full screen"}),(0,W.jsx)(J.r,{onClick:()=>o("true"),children:"Don't show again"})]}):null}),rI=()=>{let e=rN();(0,tu.useEffect)(()=>{1===ri.decoders.length&&ta.isSupported()&&(0,ts.z)(()=>{ri.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:ta})})},[]);let[t,r]=(0,tu.useState)(!1);return(0,tu.useEffect)(()=>{if("keyboard"in navigator)return navigator.keyboard.lock(),r(!0),()=>{navigator.keyboard.unlock()}},[]),(0,tu.useEffect)(()=>(window.addEventListener("blur",rR),()=>{window.removeEventListener("blur",rR)}),[]),(0,W.jsxs)(X.K,{...tf.LE,children:[(0,W.jsx)(tc(),{children:(0,W.jsx)("title",{children:"Scrcpy - Tango"})}),ra.running?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(rl,{}),(0,W.jsxs)(X.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,W.jsxs)("div",{ref:ra.setFullScreenContainer,className:e.fullScreenContainer,tabIndex:0,onKeyDown:rO,onKeyUp:rO,children:[(0,W.jsx)(rF,{keyboardLockEnabled:t}),(0,W.jsx)(th.wM,{width:ra.rotatedWidth,height:ra.rotatedHeight,BottomElement:rb,children:(0,W.jsx)(rD,{})})]}),(0,W.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:ra.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:ra.log.map((e,t)=>(0,W.jsx)("div",{children:e},t))}),(0,W.jsx)(th.bq,{style:{display:ra.demoModeVisible?"block":"none"}})]})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{children:[(0,W.jsx)(th.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"can mirror device display and audio with low latency and control the device, all without root access."]}),(0,W.jsx)("div",{children:"This is a TypeScript re-implementation of the client part. Paired with official pre-built server binary."}),(0,W.jsx)($.v,{align:"start",children:(0,W.jsx)(Q.K,{text:"Start",disabled:!tU.d.adb,onClick:ra.start})}),ro.get().map(e=>(0,W.jsx)(rt,{definition:e,value:ri[e.group][e.key],onChange:(0,ts.aD)((e,t)=>ri[e.group][e.key]=t)},e.key)),(0,W.jsx)(rz,{})]})]})};var rU=(0,tl.Pi)(rI)},1598:function(e,t,r){"use strict";e.exports=r.p+"static/media/worker.d1c3f006.js"},2821:function(e,t,r){"use strict";e.exports=r.p+"static/media/server.e6bec4d3.bin"}},function(e){e.O(0,[542,25,126,774,888,179],function(){return e(e.s=9305)}),_N_E=e.O()}]);
//# sourceMappingURL=scrcpy-c5bd4f8b15729490.js.map